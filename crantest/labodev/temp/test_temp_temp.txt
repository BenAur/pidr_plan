Un formulaire a été soumis avec l’encodage de caractères « windows-1252 » qui ne peut pas encoder tous les caractères Unicode, la saisie de l’utilisateur pourrait donc être corrompue. Pour éviter ce problème, la page pourrait être modifiée pour que le formulaire soit soumis avec l’encodage UTF-8, soit en changeant l’encodage de la page elle-même en UTF-8 soit en spécifiant « accept-charset=utf-8 » dans l’élément formulaire.
Nouveau séjour créé par BOUTIN à partir d'un existant :
Notice: Undefined index: datedeb_sejour_prevu in C:\Users\pgend\Documents\htdocs\crantest_php\edit_individu.php on line 1118
Notice: Undefined index: datefin_sejour_prevu in C:\Users\pgend\Documents\htdocs\crantest_php\edit_individu.php on line 1118

cryptage PJ
-------------------
cadrage impression detailattestation
-------------------
site cran : appeler listeindividupublic,... depuis site 12+
-------------------
listeindividupublic-> listeindividupublic20170527
equipes CRAN
-------------------
A METTRE EN EXPLOIT 
web CRAN : cran_base_php.dwt.php, _const_fonc jusqu'à GetSQLValueString, normal.css 
enleve ref a vm-web-cran sur site web cran :
modif web cran 
- const.php, francais/themes_rech/cid/index.php, francais/cran/sid_index.php
- francais et anglais cran/acces.php
-------------------

table corps : ajouter codelibcorps vc(20) pour ne pas utiliser codes numériques dans les programmes ou faire
un regroupement de codecorps ('04', '05',...) avec un libelle 

imopa
16/05/2017 : 
- bloc Anomalie : manque champs => panneau rouge (résumé thèse, pj...)
- intégration site web : programme au cnrs ou machine 12+
- mail type 
* Assurance ? Carte vitale ?
* Doctorant LUE à rajouter ?
* Vaccinations ?
* Site Ul web et 12+ pour annuaire
carnet_vaccin (deja dans typepjindividu de cran, imopa, lemta)
listes de diffusion
resp equipe
aide_gestionindividus.php : enlever info FSD

lemta
* enlever (2016 2015 2014 2013) 
* ajout utilitaire réservation salles

item listes de diffusion dans menu.
accepter plusieurs . dans un nom de fichier



site demo : enlever pièce d'identité.


A VOIR avec Séverine : apposition visa 'theme'=arrivé par referent => mail
_const_fonc, gestionindividus


vérifier vm-web-cran.uhp-nancy.fr et 195.220.155.4 sur 195.220.155.1 et 4 pour rediriger sur 193.54.21.4

site demo : 
- pj=initialiser avec type de fichier xls, pdf, jpg... enlever accès piece identite
- substituer UL par Univ
- enlever ACOS, ..., IPS


système de prêt : quel contrat emprunte à autre contrat
compare 12+ sifac
Maquette UL - Convention d'accueil d'un chercheur ou enseignant chercheur.doc
Formulaire_creation_agent.doc
cacher piece identite
afficher FSD - de 5 ans : uniquement si datefin_sejour_prevu > t0
---------------------
créer une double sauvegarde de bd et pj : owncloud pas sûr

ne pas repositionner l'écran au niveau de la commande et de laisser sa ligne surlignée en vert

dans mail commande aux users : permettre de se connecter et d'arriver à la page gestioncommandes = ajout &prog=gestioncommandes&codecommande=...

dans txt_recherche, si numéro est donné : choix n° cmd ou miss pour éviter d'avoir à sélectionner le champ n° interne

IMPORTANT : 
contrat : interdire changement orgest si contrat utilisé dans budget
fleche navigateur ou actualiser : ne pas relancer l'envoi déjà soumis
batch de nuit : pas de mail si finsejour+1=deb sejour suivant
ajout d'un code digital pour accès pj + cryptage

A FAIRE  pour plus de lisibilité edit_contrat : corps.codecat='04' à remplacer par codelibcat='DOCTORANT'
A FAIRE  pour plus de lisibilité rajouter une colonne codelibcorps 
A FAIRE gestioncontrats : in_array($row_rs_contrat['codeorggest'],array('004','005','010','014','015','016','019')=trouver un truc pour ne pas avoir de codes explicites
A FAIRE 
$row_rs_commande['codenature']=='06' || $row_rs_commande['codenature']=='12' : salaires
$row_rs_commande['codenature']=='05' || $row_rs_commande['codenature']=='08'  || $row_rs_commande['codenature']=='10' equipement
$row_rs_individu['codenat']!='079'
verif &# dans les données fsd
parametrer table statutvisa => destinataire de mail 
------------------------
Carole : nom maj prenom min 12+ pers. demandeur commande mission. libellé fournisseur = report nom prénom du demandeur => flèche copie
----------------------
Dans la pratique Carole, quand la date fin IEB est dépassée, une icône V (Vivant) est affichée 
automatiquement dans la ligne du contrat : si tu cliques sur ce V il se transforme en A (Archivé)
 avec éventuellement un mail à Monique qui verra elle aussi ce A.
------------------------

_const_fonc_mail_popup : A FAIRE  
verifier que tous les acteurs ont @ mail avant envoi ou laisser envoimail renvoyer une erreur ?
rajouter dans statutvisa les roles sif,... ?
ajouter @mail ACMO,... que si existe dans _const_"labo"
enleve styles/normal.css et images/ 

-----------------lemta---------------------------
labotest_php -> labotest_equipe_php
modifs notees // 20170416
nouveau site dreamweaver, modif constdefauttest : labotest_equipe_php
constdefauttest : $GLOBALS['avecequipe_contrat']=false; $GLOBALS['libcourt_equipe_fr']='Equipe';$GLOBALS['liblong_theme_fr']='Equipe';
constlemtatest : $GLOBALS['avecequipe_contrat']=true;$GLOBALS['libcourt_equipe_fr']='OS';$GLOBALS['liblong_equipe_fr']='Op&eacute;ration scientifique';
edit_contrat, gestioncontrat, detailcontrat OK
gestioncentrefinancier : décommente lignes de création, ajout de Types de crédits UL et CNRS Dotation et contrats
gestioncentrecout = enveloppe : décommente lignes de création, ajout possible de la structure dept/equipe
ATTENTION gestioncentrecout : interdire la modification des enveloppes dept/equipe et ce d'une annee a l'autre => pas de reaffectation possible des enveloppe, dept/equipe
edit_contrateotp : AND ((contrat.codetheme=centrecouttheme.codestructure AND contrat.codeequipe='')
                        OR  (contrat.codeequipe=centrecouttheme.codestructure AND contrat.codeequipe<>''))
gestion_contrateotp
_const_fonc_detail : detailcontrat A FAIRE affichage equipe 

 
bd lemtatest :
table contrat : ajout codeequipe varchar(2)
structure : ajout 25 sif
Ajout manuel bd structureindividu : ajout 25, 00002  25, 00003
Ajout manuel bd site, secrsite, secr
Ajout manuel : INSERT INTO cont_orggesttypecredit (codeorggest, codetypecredit) VALUES ('001', '01'), ('002', '02'); 
creation d'un contrat avec equipe RMN/NS et de deux orgest (UL, CNRS) dans module "contrat". 
utilise gestioncentrefinancier - Types crédits : UL > UL Contrats
utilise gestioncentrecout : UL > UL Contrats-UL Contrats - RMN/NS => centrecouttheme : association centrecout-equipe

budg_contrat_source_vue :
AND contrat.codetheme=centrecouttheme.codestructure
remplacé par 
AND ((contrat.codetheme=centrecouttheme.codestructure AND contrat.codeequipe='')
OR  (contrat.codeequipe=centrecouttheme.codestructure AND contrat.codeequipe<>''))
budg_aci : DELETE FROM budg_aci WHERE 1
budg_eotp_source_vue : OK pas de modif a faire

ajouter rubrique (fluide,...) pour cdes FC
fin d'année = creer la nelle annee, copie missions commandes non traitées n-1 dans n
Céline ne revient jamais sur années précédentes
---------------------
accélère affichage
gestionindividus -> gestionindividus20170504_plusrapide
edit_individu -> edit_individu20170504_plusrapide
confirmer_mail_validation_autorisation_fsd -> confirmer_mail_validation_autorisation_fsd20170504_plusrapide
i/mail.png, i/mail, i/esp.gif, i/esp30.gif, i/esp
nomal.css mc10
---------------------------------------
gestioncommandes_min : inverse deux lignes avec jquery-min dans m(tablerow) = perte doubleclick
utiliser jquery $_get pour envoi données au serveur, changer l'image dans la version mini pour la ligne sur laquelle on est

---------------------------------------


pour avoir tous référents,.... possibles : rajouter une icone à cote de la liste select et lister avec un  script js

crédits IEB
msg fonds cnrs pour agents cnrs+ul + OM CNRS éventuel uploadé au moment de l'envoi. Rien pour les hors labos.
msg fonds UL agents UL
msg fonds UL agents CNRS
message modifiable avec upload OM CNRS éventuel au moment de l'envoi

Vous partez en mission du ... au .... à Ville (Pays). Vous trouverez donc en pièces jointes deux informations importantes.

1 - S'agissant d'une mission à l'étranger, vous avez la possibilité de vous enregistrer sur le service Ariane du ministère
des Affaires étrangères et du Développement international : voir flyer en pièce jointe.

Une fois les données saisies :

- vous recevrez des recommandations de sécurité par courriels si la situation dans le pays le justifie,
- vous serez contacté(e) en cas de crise dans leur pays de destination,
- la personne contact que vous aurez désignée pourra également être prévenue en cas de besoin.

2-  Les Garanties Assurance Mission à l'étranger de l'UL et du CNRS.

---------------------------------------
Undefined index: in E:\www\labotest_php\gestionindividus.php on line 866

site CRAN : look, page de garde, contenu plate-formes (DW : fichier excel formaté qu'un programme remet en forme en HTML)
se fixer une réunion une fois par an avec DW pour vérif. pages
ajouter equipe pour avoir liste des membres/équipe


------------------
export des listes format excel : listepresentpartifutur_emploi_college_xls.php
-------------------
edit_individu -> edit_individu20170404 
si dir these plus là, il doit toujours être affecté
bug si erreur dans emploi : le contenu de l'un passe dans l'autre si on clique sur le crayon de l'autre alors que erreur
-------------------------
batch_de_nuit :
Sauvegardes : 
- bd supprimer une par jour sur 4 semaines, supprimer semaines au bout d'un mois 
- pj : sauvegarder uniquement les nouvelles
- lancer une sauvegarde auto sur le NAS 192.220.155.22
- prevenir 1 semaine avant du départ VJH + le doctorant s'il est considéré en abandon
+ chaque personne partant avec la liste des choses à faire

---------------- 

MB, DW :
initialiser quotités de travail pour permanents, non permanents ? EC quotité 100, ETPT 50 ?
---------------------
enlever liens vers commandes (2016 2015 2014 2013)  pour labos hors cran
enlever items de menuprincipal = parametrer dans _const_xxxx

pour tous labos :

plusieurs eotp : textarea => modif table individuemploi eotp vc(100) edit_individu, alerts.js, 
grade pour tous personnels
enlever liste select Master obtenu ou codediplome_prep=> update individusejour pour cran 
acces login/password pour srh en lecture ?
fleche haut pour remonter dans liste individus
Indiquer la PJ qui manque
visu modif, suppr pour tout sujet : admin_bd, admingestfin, srh, du


---------------------

Modifier aide_gestionindividus.php

Autoriser taille pj < 30Mo pour contrats
diminuer taille piece identite automatiquement si > 1Mo


limiter items de menuprincipal dans _const_"labo" ou bd, voir prog et individuprog A FAIRE
--------------------------


Migration UL :
$GLOBALS['Serveur12+commande'] = array('nom'=>'serveur 12+','lien'=>'http://195.220.155.4/'.$GLOBALS['rep_racine_site12+'].'/formintranetpasswd.php','emailexpediteur'=>'Didier.Wolf@univ-lorraine.fr','emailretour'=>'Carole.Courrier@univ-lorraine.fr');

proteger les PJ !!! mettre un div avec une zone à cliquer OK à mettre en exploit
proteger acces 12+ = div en plus du pwd apres login/pwd -> renvoi sur autre faux site
idem pour phpmyadmin
depuis site web : envoyer un code de nuit par batch ou transferer partie de bd 12+ sur bd web 

a faire : appeler _const_fonc_mail_popup.php : mime_message($tab_params) 
_const_fonct : html_head a ecrire et appeler dans les progs



gestionindividus : 
- decocher "Mes dossiers" si un critère est choisi
- diminuer taille colonnes
edit_individu :
- annee naissance : corriger controle si 2 chiffres=ajout 19 si annee >50, 20 sinon


----
- serait-il possible aussi d'ajouter une cellule à côté de Adresse pers. : Adresse en France
- créer une cellule juste à coté de celle-ci, avec comme intitulé Composante enseignement, ce qui permettra de saisir entité et adresse



ajout _car_speciaux
batch_de_nuit : 
envoi infos intranet aux nouveaux arrivants
suppression des logins/passwords des partis

crypter les fichiers enregistres ? demander un pictogramme pour download ?
separer personnel/contrat VPN du reste ?

pbl caractères &#... pelhivan
prévenir que caractères &#...résiduels dans les champs à la génération
sujet 1007 : uni&#64257;é
double nationalité


verifier que taille totale PJ < 10Mo => diminuer taille fichiers si nécessaire

A modifier edit_mission : adresse pers = adresse pers actuelle+cp+ville+pays
adresse admin= à ne remplir que si lieu ne convient pas
mail relance pièces : 

gestionsujets->gestionsujets20161213 : admin peut modifier tout sujet
Mail : envoi à SRH si sujet affecté à étudiant par référent

edit_sujet
ajouter cases directeur de thèse

A modifier detailsujet : domaine, discipline 
A voir detailindividu : toutes les PJ


afficher le pdf lors de la saisie des sujets pour verif cadrage, caractères

gestionsujet : limiter affichage sujets affectés/abandonnés
sujet : ne pas valider un sujet automatiquement si affectation à un individu => un etat EPV ou champ supplementaire 
confirmer_action_individu : suppression : rappel des raisons de pas de suppression
-------------------------------------------------------------------------

cryptage mots de passe, PJ
https

permettre impression detailindividu
ajouter pj : fiches inscription doctorants

generer un ficher excel d'export des listes
ecrire un prog. pour modification de structureindividu, gesttheme et secrsite

enlever GT des sujets et individus dans les listes
listeindividu

proposer la création d'un séjour de postdoc sur la période restante du contrat en cours.


site cran : faire une redirection cran/francais/event/index.php -> listeevenementpublic
soutenances en provenance de la bd : màj 12+ 2016
site cran listeevenementpublic, detailevenementpublic
site crantest_php :
table individu champs heur_hdr vc(5), lieu_hdr vc(100), titre_hdr vc(300), resume_hdr text
edit_individu : alertes ou interdiction sur checkbox hdr et associe
alerts.js
_const_fonc : chemin d'acces affiche si annuaire, sujet, evenement
_const_fonc : affichage chemin accès
rajouter un lien vers le CRAN,...

edit_individu, edit_sujet
pour referent, encadrants ... afficher les presents durant la période considérée.
 
faire sauvegarde bd et pj sur dossier $pgend

copie commandes/missions année précédente sur courante :

mettre mini pour gest commandes/missions
liste des contrats=trop lent





actualités : liste des soutenances

report auto de FSD -5 ans dans fiche individu
--------------------------
message de nuit : pas de message si fin de séjour contigue à nouveau sejour



couper afrique en afrique et sub-saharienne
---------------------------
mail sujet :dans message saisie sujet manque affectation etudiant et prevenir srh si affecté

---------------------------
crypter pwd pour les + importants
crypter pj
---------------------------------
mettre formintranetwasswd en 2013-> 2015
---------------------------------
if (PHP_VERSION < 6) à modifier

pour MB : présentation sous forme emploi au lieu de sejour, sejour emploi


edit_individu-> edit_individu10160604
corpsmodefinancement 54, 56,  '' 00
contrat/emploi : si employeur autre, ne pas mettre Mode de financement : sur budget CRAN. Rajouter [choix obligatoire] en debut de liste
plutot que choix par defaut

liste des doct ordre alpha dans contrats
pas réutiliser n° dossier zrr si envoi fsd

liste select indivividus ajouter catégorie mission, commande

-------------------------------------
suppr individu => si decl en cours msg husson suppression

gestionindividus -> gestionindividus20160501


edit_contrat
calcul duree contrats en mois pas correcte = proposer duree reelle avec jours à côté
écrire des petits programmes gestion codif qui permettent de modifier des intitulés de codifications type et classif, et de supprimer aussi
------------------------
edit_individu -> edit_individu20160421

dates prévues de séjour remplacées par les dates de séjour tant que l'envoi FSD n'a pas été fait ou si pas besoin 
change dates prevues en reelles avec message alerte
ne pas afficher dates sejour prevu tant que pas de dde fsd ?
double confirmation alerts.js pour creation sejour et creation classeur fsd !!

liste des sejours passes/suivants dans fiche individu
sejours : mettre date debut tout 1er sejour contigu =date deb carriere cran

date d'inscription : faire en sorte que rappel lorsqu'elle n'est pas complétée

nouveau sejour : emplois precedents ne sont pas renseignees
si @email parti et email ='' alors email=@email parti

controle datefin_emploi oblig. si non permanent => fermer tous les emplois qui doivent l'être 


prevenir que dates et dates prevues ne sont plus en phase si changement ?
prevenir que mois pas plein en creation/ajout sejour
indiquer duree pas assez longue selon categorie
pouvoir changer de corps pour srh
 
Amouroux : 
La date FSD du 2014/06/23 mise dans tous ses séjours passés avant 2014 pour l'autorisation 
=> la vérif. -5 ans ne marche pas car séjours passés non contigus

A quoi sert : ?
if($action=='ajouter_sejour')
	{ $row_rs_individu['ajouter_sejour']='';// ???????????
	}
-----------------------------------------

verif. que destinataires presents et ont @ mail dans tous les programmes d'envoi de mail ???
batch de nuit : prevenir que nouveau n'a pas d'@ mail => pas dans les listes de diff.

-----------------------------------------------

gestioncommandes : si ferry se met à la place de chakir en gest d'une commande,
 ni l'un ni l'autre ne peuvent valider

edit_commande : interdire imputation vide sur submit (fait dans alerts.js)
--> nelle version edit_commande20160320_pas_imputation_virtuelle a terminer : 
reste a trouver le bon endroit dans edit_commande pour que le reaffichage soit correct si erreur : credit imputation reelle


-----------------------

date générée automatique en 2000 si on indique que les 2 derniers nombres : dans contrats uniquement ?
-------------------------
------------------------
Mail rh le jour du départ d'un stagiaire pour attestation
rajoute une case "Attestation envoyée" à remplir par Lili
mail au rh, au bout d'une semaine par ex., pour les attestations non envoyées


liste de tous les séjours de tous les gugus 

Modifier _copie_commandes et missions entre base en demandant si crédit OK : changement de n° ou datecommande pas incluse dans imputation choisie l'année précédente ?

eotp 10022 source 2015 = codetypecredit 01 CNRS, codecentrefinancier 05 direction, codecentrecout 00057 CRAN CNRS
correspond à
eotp 10061 codetypecredit 01 CNRS, codecentrefinancier 05 direction, codecentrecout 00057 CRAN CNRS
=> conserver dotation - Direction - CNRS avec meme n° d'une année a l'autre comme dotation - direction - UL

------------------
crantestrapide_php
gestioncommandes function m
// test copier/coller = contient le code de couper/coller une ligne tr en test
	row=document.getElementById("table_results").rows.namedItem(tablerow.id)
	rowcontent=document.getElementById("table_results").rows.namedItem(tablerow.id).innerHTML
	rowindex=document.getElementById("table_results").rows.namedItem(tablerow.id).rowIndex
	document.getElementById("table_results").deleteRow(rowindex);
	tr=document.getElementById("table_results").insertRow(rowindex+2);
	tr.innerHTML=rowcontent;
	for(attr=0;attr<row.attributes.length;attr++)
	{ tr.setAttribute(row.attributes[attr].name, row.attributes[attr].value);
	}	

--------------------
22/03/2016
pbl touche entree dans champ de recherche
gestioncommandes -> gestioncommandes20160222
pbl apres retour de mail rappel EF mission : 
gestioncommandes -> gestioncommandes20160223
annule mise en exploit. gestioncommandes20160219 -> gestioncommandes 
---------------------
24/02/2016
renomme gestioncommandes -> gestioncommandes20160224
modifs...pbl apres une suppression, plus rien affiché : demande... decoches dans gestioncommandes
---------------------
19/03/2016
renomme gestioncommandes -> gestioncommandes20160319
 et reprend gestioncommandes de version cran_php
---------------------

FSD : ne pas reporter commentaire de demande prolongation d'un sejour à l'autre

29/02/2016
gestioncontrats -> gestioncontrats20160229.php



controle_form_fiche_dossier_pers datedeb_sejour='' => datefin_sejour posterieure datedeb_sejour !

edit_individu : ne doit pas réagir à touche entrée pour submit ?

edit_eotp_source_masse.php,gestioneotp_source_masse.php, edit_contrat, gestioncontrats,
edit_contrateotp.php, gestioncontrateotp.php A CORRIGER pour ancre

pbl place sur 195.220.155.4 C:

permettre de changer la catégorie/corps d'une personne avant dde FSD



00654.02 : pas de dates prévues et pas d'employeur => panneau incohérences

Ajout controles FSD

visas 12+ pers 1er : RH, 2e : FSD, 3e : Resp accueil
Le 3ème visa, pour plusieurs candidats sur le même sujet, détruit (ou au moins désaffecte le sujet) les dossiers des autres candidats

edit_mission : possibilité créer et voir commandes à l'intérieur de l'OM

supprimer les fichiers de sauvegarde passés de la bd au fur et à mesure des nouvelles sauvegardes auto.


Mise à niveau apache, php de 12+, cran

2016 : copie de commandes de 2015 pour CC, CLK

gestioncommandes : revoir accès b_cmd_etre_admin_lecteur et polegestion


date et catégorie de la liste select en comm/miss

sujets :
si sujet état pourvu : doit-il etre non supprimable alors que non affecte ?
enlever la notion de pourvu dans edit_individu ? 
ne pas modifier le statut d'un sujet ou alors le faire dans gestionsujet et edit_sujet ?
EXTERIEUR : tenir compte de date_demande_modification_fsd et date_demande_fsd. A priori non.
supprimer le sujet "ne pas affecter ce sujet ?" (verifier qu'il n'est pas affecté) l'enlever des sujets proposés
sujet verrouillé => ne plus l'afficher en proposé et décocher afficher_sujet_proposé ?


Reload et fleches de navigation interdits :
_const_fonc -> _const_fonc20151103
modif en debut de _const_fonc : //PG 20151103
ajout du paramètre time_noreload dans edit_commande, 

Protection contre les erreurs : action=modifier et code...=''
edit_contrateotp,
edit_eotp_source_masse
gestioncentrecout
gestioncentrecout_reel
gestioncentrefinancier
gestioncentrefinancier_reel
gestiondialoguegestion
gestionnature



------------------------------------------
renomme crantest_php -> crantest_php_fsd_renouvellement_20151029
EN COURS : note avec //PG 20151029
edit_individu
Modif de l'aide FSD OK 
images : b_ind_fsd_verrouille_oui et non
confirmer_mail_validation_declaration_fsd.php : switch initial, prolongation,...
------------------------------------------
A FAIRE :
si date modification remplie : affiche zones roses et jaunes FSD
mettre plus d'alertes dans fiche individu pour Lili : 
- si pas de financement, ne pas afficher certains champs (origine financement,...)
- permettre envoi de la dde dans fiche individu, mettre panneau attention : manque... pour attirer l'attention
macro excel = mettre le passwd en parametre =>modif fsd_detailindividu.php, fsd_listeindividu.php + const.php = rajout passwd 

verifier qu'une mission, contrat, sujet, commande n'est pas '' en mode modif lors de l'update

edit_individu :
a faire : warning si les depts du sujet ne sont pas tous associé a un etudiant





pbl OUSSAR : 
fichier excel contient : sujet et titremission+descriptionmission (par copie de son séjour précédent ?)
comment les date prevues = '' !!! voir sauve bd 20151011 ?
verifier que si duree prevue<5j on a bien duree reelle <5j
Rajouter categorie, dates sejour dans listes select mission/commande demandeurs



Attention date_fin_sejour_prevu pour un t0_-5ans_contigu => si dates prevues <> dates et nouveau sejour inclus dans ancien sejour : dde fsd a faire. 
à faire cas t0 mais sejour pas completement couvert
à faire t0 au dela de 5 ans
-> t0=date debut autorisation pour permanents, date deb sejour prevu pour non permanents ?
--------------------
rajouter un indicateur "abandon" thèse
--------------------
Mails : verifier que mail existe et qu'il y a au moins un destinataire


Améliorer suppression individu : 
undefined
interdire suppression individus pour admin_bd si pbl de cohérence

Paramétrage : rajouter const $_GLOBALS : fera apparaitre case à cocher pour que pas de déclaration fsd à faire


vérifier que personne du même nom n'existe à la création.


petit bug apres ecran choix : pas de zrr demander_autorisation if($row_rs_ind['codelibcat']=='STAGIAIRE' && $row_rs_ind['codetypestage']!='01')
-> $row_rs_ind['codetypestage']=''


Mettre nom gestionnaire dans listing batch de nuit
autoriser gestionnaire a deverrouiller sujet
Non supprimpable car undefined

date_autorisation < 5 ans ou datedeb_sejour_prevu de l'autorisation < 5 ans ?
verrouiller dates prevues apres envoi dde fsd : deverrouillable ?

Interdire reload, page prec ou suivante
------------------
A part : avril 2015 : site crantest_no_reload_php
reload interdit : 
modifs notées avec 
edit_fiche_dossier_pers, _const_fonc, function check_reload
------------------

Montant stage=enlever cadre rose ou donner explication
Département sans équipe : lrgp



adresse admin pour les membres par site géographique
enlever liste select ancien etablissement.

 
A FAIRE site DEMO :
- logo universite demo pour detailmission_autorisation_congres, detailattestationstage
- des commentaires contiennent CRAN, CID, ISET,SBS, des infos cran à supprimer
- remplacer les acronymes UL CNRS dans gestioncontrateotp, gestioneotp_source_masse ?
- mise a dispo macro excel => explications+modif host,db,password=demo, phrasemagique
- renommer formintranetpasswd en login_12plus 

Commandes :
Pas de champ bloquant OM : même système que FSD (panneau rouge au lieu de visa)
edition d'un individu : 
sur budget cran cde auto. objet Gratification de stage (ou salaire) du au; fournisseur NOM Prénom. Contrat = imput virt
=> liste des contrats dans edit_individu ?


Permettre de créer une mission a partir de edit_individu ?

A corriger : 
- user peut modifier,... une mission
- edit_sujet : 
  si erreur envoi mail : texte lien retour=validé !!


possibilite changer corps, annuler visa sujet
correction edit_form_fiche_dossier_pers, regles_hs.html

utilité des tables diplome_prep et centrecout_pers : ? 
SELECT *
FROM `individusejour`WHERE codediplome_prep <> ''
centrecout dans emploi
SELECT * FROM `individuemploi` WHERE codecentrecout<>''
-----------------
-----------------
29/04/2015 copie de crantest_php -> crantest_php_20150429_avant_nettoie_cran
Suppression/remplacement de CRAN dans tous les progs php (hors const et cran).
cree crantest_php_nettoie_cran, bd crantest_nettoie_cran: 

mail a @ cran, acmo dans envoi mail de registre
tester l'existence des @ mail, DU,ACMO,... et que tab_destinataire contient au moins un destinataire pour l'envoi de mail

- cran.php -> database.php => modif dans _const_fonc
- database.php : enleve _cran des noms de var.
- _compare_bd.php
- const.php : ajout de $GLOBALS['smtplocalhost']="VM-WEB-CRAN.cran.uhp-nancy.fr"
- _const_fonc : verifier que feuille style/normal.css est toujours dans les messages, reste a corriger @mails de listes de diff. cran-direction
-_copie_de_commandes_entre_bd.php
- _ldiff.php
- renomme aide12plusbudget.html -> aide12plusbudget.php
- supprime _ul_cran.php, detailindividupublic, detailsujetpublic, listeindividupublic, listesujetpublic, listeevenementpublic
 renomme listeperscran.php->listeperslabo.php

gestioncommandes à faire (pas important):
Warning: mysql_fetch_assoc(): supplied argument is not a valid MySQL result resource in C:\Users\pgend\Documents\htdocs\crantest_php\gestioncommandes.php on line 1822
Warning: mysql_data_seek(): supplied argument is not a valid MySQL result resource in C:\Users\pgend\Documents\htdocs\crantest_php\gestioncommandes.php on line 1831



Attention !!! mysql ou php (L barré) augmente la longueur d'une valeur si elle n'est pas dans le jeu de caractères 


Manque htmlentities !!!


Débarasser les Dept des GT dans les consultations, les messages ind et sujets : vérifier d'abord qu'ils ont un dept

                                -----------
--------------------------------! GENERAL !------------------------- 
                                -----------
Ajout controle lors des creations que limites (compteurs, numordre,...) non atteintes : passage de 99 à 100 pas possible par ex. car codé sur 2 cars
-----------------------
changer version mysql comme sur pc local : passer de 5.5 en 5.6 (pas urgent). La version mysql-5.5.34 sur serveur permet plus de 8k
-----------------------
Système de validation par messagerie avec lien. Réponse avec messagerie sur @web_cran

----------------------- déselection élement d'une liste si pas d'intersection
Quand élément d'une liste ne devrait plus y figurer car 'passé' : sur déselection, mettre une alerte js précisant qu'à l'enregistrement
il disparaitra de la liste.
- edit_mission : missionnaire. A faire Secr.
- edit_commande : demandeur, contrat, eotp. A faire Secr., cc, cf. en fonction de la date de la commande et pas de la periode en cours
- edit_individu :
- edit_contrat : resp contrat, 
Attention : a verifier la presence de l'individu, structure, secr,...  
------------------------------
faire en sorte qu'12+ 'retienne' les 'préférences' d'une session à l'autre
------------------------------
Pouvoir mettre une personne en Cc dans les mails
------------------------------

                                 -------------
---------------------------------! COMMANDES !------------------------


CLK 30/06/2015 : la description pour Maryse disparait parfois

pbl duplication commandes : warning car credits, type,enveloppe, source n'est plus cohérent ?
-> expliquer comment s'en débarrasser en saisie : chgt choix listes select

Associer n° eotp à tous les contrats d'un projet (réunion MB, CC)
Message de batch pour limite dates fin contrat et justif

donner accès à _copie_de_commandes_entre_bd.php à CC et CLK

permettre de lier une commande à une mission
 
pbl warnings error ligne .... dans edit_eotp sur enregistrement

Limiter missionnaires avec critère de date ou mettre catégorie+ indication present ou parti
commande-mission enregistrée après le départ réel :
Au lieu de demander au SRH de modifier la date de départ pour pouvoir passer une commande : faire en sorte de lister les personnels partis depuis moins de 3 mois (cela me semble correct) en plus des personnels présents dans la liste des 'demandeurs' pour une commande 
Dates mission, sejour et emploi : dupliquer_mission, almecija pas dans liste (date sejour OK mais pas date emploi) alors qu'il l'est dans edit_mission
-> solution temporaire : fait apparaitre les partis.

---------------------------
bug non arrivé !!! A corriger !!!
dans edit_commande, compteur $nb_commandemigo+=nombre de migo ne tient pas compte d'une migo qui aurait pu être supprimée
 alors qu'il faudrait que le nouveau codemigo soit egal au dernier augmenté de 1 (ou alors que tous les codemigo soient modifiés avec un compteur qui effacerait les anciens codes)
 
---------------------------
pbl dans edit_contrateotp: eotp=a " a < non affiché => remplacer avec htmlspecialchars ou entities
" UNION".
" SELECT eotp.*,'' as estdansbudget from eotp where eotp.codeeotp=''".
par 
" UNION".
" SELECT eotp.*,'' as estdansbudget from eotp where eotp.codeeotp not in (select codeeotp from contrateotp)".

------------------------
Carole
case à cocher 1ere colonne pour copie de bd 2013 en 2014 pour certaines commandes
-----------------------
dans une cmde permettre duplication cde pour aller plus vite = enregistrer + dupliquer (3 commandes pour CWL par ex.)
-----------------------
gestioncommandes :A revoir $estrespcontrat au lieu de estcontrat pour droitwrite
--------------------------
eotp plusieurs contrats : supprimer contrat en doublon de eotp ?
BUG sans effet pour l'instant dans _const_fonc get_tab_cmd_acteurs :
  $rs=mysql_query("select codeindividu as coderesp,codelib from structureindividu,structure".
		" where structureindividu.codestructure=structure.codestructure".
		" and (codelib=".GetSQLValueString('sif', "text")." or codelib=".GetSQLValueString('admingestfin', "text").
		" or codelib=".GetSQLValueString('du', "text")." and structureindividu.estresp='oui')") or die(mysql_error());
mauvais parenthésage structureindividu.estresp='oui') : la ) devrait être après or codelib=".GetSQLValueString('du', "text")
Mais ca marche : voir ce que cela fait avec le 'bon parenthesage'

------------------------
faire en sorte que IEB puisse choisir de n'annuler qu'un, deux ou trois visas
                                 ----------------------
---------------------------------!     FSD            !------------------------
                                 ----------------------

Si sujet n'a pas domaine,... : sur visa référent, déverrouiller le sujet et demander au référent de compléter
Monique : nouvelle version à installer 06/04
Panneau attention :rajouter "sujet non saisi, incomplet pour domaine, activite,...
Mettre un commentaire pour dossier FSD :
- pas de visa : date 1/1/1980
- n° piece identite dans excel : nombre entier peut etre transforme => ="numero"

dates prévues du séjour non copiées pour un second séjour : Pereira ?
A corriger :
Controle sejours contigus : de date prevues en dates prevues !

interdire de modifier numdossierzrr apres envoi mail fsd : deverrouillage possible


Pbl des date sejours prevues differentes des dates reelles en declaration globale !
Modifier 16/06/2015 par 23/06/2015


cas refus FSD 

A FAIRE :
- non déclaré pour parti sans dde ou sans réponse
- ICL, autres : proposer un rattachement ZRR de l'encadrant
- suppression sejour => suppression decl. zrr => pas possible si present ou parti
Interdire la suppression d'un sejour parti comportant une date d'autorisation

- demande pour aller dans une autre zrr :
  - dans le labo
  - depuis ailleurs
Pas d'affichage des non valides srhue dans annuaire
calcul cumul des tailles des fichiers joints
Controler les champs obligatoires 
Attention dates deb de sejour prevu et dates deb sejour : les secr d'appui peuvent modifier dates deb sejour mais pas date de sejour prevu : probleme ?
initialiser datefin_sejour_prevu si non permanent pour les anciens avant controle, sinon msg erreur pour srhue ?
revoir detailindividu : date recrutement
Sur creation individu verifier que nom saisi n'existe pas et le proposer au user
Controle des champs obligatoires : à partir d'une certaine date ?



                                 -------------
---------------------------------! INDIVIDUS !-------------------------
                                 -------------

A faire : report dates prevues pour nouveau sejour
A voir : liste des individus qui auront le message sur visa fsd = enlever rep dept, ajouter srh+admingestfin
--------------------
12+ génèrera, 2 semaines avant, un mail à l'attention du référent (en général dir. thèse), de nuit, lui demandant si départ effectif ou non !
Est-ce qu'on étend aux postdocs, cdd non administratifs ? 

Envoyer un mail aux personnes quittant le labo. leur demandant si c'est correct
------------------
Dept. : SURFDIAG,CID,ISET ds msg nouvel arrivant. Enlever les GT (SURFDIAG,...)

cas décl. FSD sans visa. : pour l'instant, date = 1/1/1980
Pas de ZRR : pas de déclaration

Donner accès aux différentes listes aux secr. d'appui
si erreur controle form : le code envoyé contient des messages de warning php (en test a cause du display errors) et les scripts js ne fonctionnent plus
Mettre une icone si individu sans emploi 
pj rapport soutenance SH 
edit_fiche_dossier_pers : controle dates correctes dans un mois
suppr individu : Notice: Undefined index: prenomnom in C:\Users\pgend\Documents\htdocs\crantest_php\_const_fonc.php on line 1250
Envoyer mail auto. de nuit pour avertir la personne partie, son référent et secr. appui

rajouter PJ cotutelle
Pas de tel par defaut si exterieur < 5j, stagiaires.
interdire emploi sans date fin si non permanent à partir d'une certaine date pour eviter les problemes des anciens dossiers.
interdire emplois superposés ? à partir d'une certaine date pour eviter les problemes des anciens dossiers.
verif des dates fevrier, avril,... : calcul duree se fait mal
fermeture sejour : si parti on ne le voit pas forcement en sortant de edit_fiche_dossier_pers car bloc parti pas affiché => afficher bloc parti pour
  repositionner la ligne 
permettre d'associer un sujet à plusieurs étudiants pour thèse
- controler employeur permanent
nouveau sejour MCF => PR mais classe=1ere par defaut
Verifier qui n'a pas d'@ mail 
Pas d'affichage des non valides srhue dans annuaire
Liste sujet dans edit_fiche_dossier_pers : deux lignes vides parfois
Manque contole employeur pers permanent
numdossierzrr_propose='' 
Rendre dossiers supprimables (par ex. : suppression sejour postdoc pas possible si doctorant a sujet verrouille !)
Demander aux secr d'appui de bien verifier dates fin et debut sejour.
Nouveau Msg d'alerte si nom deja saisi

interdire saisie nouveau sejour si datefin_sejour='' FAIT
 
verifier que somme pj passe

comparaison labintel/12+ : rechercher les presents de labintel dans les partis de 12+

Parti (date de départ inférieure à aujourd’hui) sont affichés alors que pas coché



afficher durée sejour
table corps : ajouter numordre pour replacer "Adjoint technique principal"
Verifier sur creation qu'un individu n'a pas son nom deja enregistré et demander validation 
retrouver toutes les infos liées à un individu : contrat, sujet, commande/mission
permettre le changement de statut/corps
---------------------------

mettre emploi mode financement [financement obligatoire]
---------------------------
rendre oblig. l'ED
affecter le doctorant à l'ED de son directeur de thèse : sujet these et individuthese A faire
=>modif edit_fiche_dossier_pers pour encadrants et pour thèse suivie
----------------------------
Developper une interface de suppression de sejour S1 d'individu pour moi permettant de savoir si un autre sejour S2 peut 'remplacer' S1
ou dans gestionindividus, mettre un commentaire de plus dans l'info-bulle disant s'il y a un autre sejour S2 permettant de se passer de S1
----------------------------
referent D.WOLF pour les permanents
--------------------- GT et dept
datefin_theme='2012/12/31' a faire dans individutheme
update individutheme set datefin_theme ='2012/12/31' where codetheme>='01' and codetheme<='05' and datefin_theme=''
----------------------
Lier individu avec ldap intranet pour creation auto
----------------------
individu : 
- 2 emplois en cours ou 1 ppal et des secondaires
- chaque nuit vérifier fin emploi et fin sejour
- datefin_sejour non modifiable ou alors il faut un autre séjour si mission a venir !!
- individu : au moins un emploi en cours durant sejour => contrôle dans individu mais aussi dans mission
- si plus d'un emploi, la liste select des demandeurs contiendra des doublons ?
- individu : champs obligatoires (nom prenom date naiss courriel)
- ajouter case 'associé' dans edit_fiche_dossier_pers pour admingestfin et du
mission : si champ date naiss pas renseigné, bouton envoi message SRH ?
enlever GT d'appartenance ACOS, ... dans les nouveaux arrivants (nouveaux séjours) : enlever au moins dans les messages de validation.

----------------------
interdire navigation avec fleches et reload
enregistrement contrat en plus de l'eotp en reel :  pour identifier contrat choisi en réel quand plus d'un contrat sur un eotp  => sélection d'un contrat et d'un éotp dans la liste de choix source/eotp.
-----------------------
Attention verif champs : champ# ou champ mais pas champ_ pour ne pas confondre dans le traitement
des champs suivis ou non d'un indicateur (contrat#1##2 et contrat sont traites par comparaison substr(parametre,strlen(contrat)))

                                 -------------
---------------------------------! CONTRATS  !-------------------------
                                 -------------
 
Contrat multi financeur => pour chaque financeur, montant financement + ventilation
petit bug pbl cont_type codif sur 2 car au lieu de 3 (08 et 09)


Message erreur contrat : <br> dans le warning. A revoir en js aussi.
petit bug controle date : si aaaa=1 la date est mise a vide
pbl js : met des NaNa parfois
enleve code inutile pour enreg des pj dans edit_contrat FAIT  le 11/07/2014 dans crantest
                                 -------------
---------------------------------!   SUJETS  !-------------------------
                                 -------------
Affectation de sujet alors que validé : 
gestionindividus, image b_sujet_a_affecter_a_etudiant, _const_fonc : mail_affectation_sujet
en test sujet saisi et valide par encadrant : destinataire gesttheme (carole courrier) contient un espace

en cours :
gestionsujets_version_archivage_a_finaliser_20150227 : modifiable par admin_bd, srh, admingestfin, du
table statutsujet : rajouter A=Archivé

Possibilité d'avoir un directeur de thèse hors labo. ou permettre de mettre un non HDR en dir. thèse

                                 --------------
-------------------------------- ! ACTUALITES !-----------------------
                                 --------------

Interdire noms identiques de rep ou fichiers dans un rep
Sur couper, copier, supprimer : verifier tous les liens dans toutes les pages et proposer d'annuler, remplacer
Interdire dans un couper ou coller que la cible soit dans la sous-arborescence coupée OK
Controler les touches 'ENTREE' pour que le bon bouton soit envoyé
limiter nom fichier dans renomme ?
interdire actualiser = <input heure en ms a comparer avec heure courante
préfixer variables de session par actu#
A revoir :
browse.php : $nb_vignettes_a_afficher=count($liste_enfants); devrait etre $nb_vignettes_a_afficher=count(liste_enfants(noeud);) ?

Notice: Undefined index: descr in C:\Users\pgend\Documents\htdocs\crantest_php\browse.php on line 35 lors de la première connexion de panetto
install ckeditor (voir install dans installation_ckeditor_4.1_full_ckbuilder.txt)
browse.php



download_public.php
_const_fonc : controle_form_actu
alerts.js : function controle_form_actu
edit_actu.php
gestion_actus

table prog : rajout lien vers gestionactus

+ rep htdocs_upload\crantest_upload\rep_upload\uploadfichier = contient que les fichiers, pas les reps

descr_fr, datedeb_actu, datefin_actu, datedeb_actu_affiche, datefin_actu_affiche, codestatutactu
update actu set descr_fr=texte_fr, datedeb_actu=date
rajouter codelangue EN, FR

ajout lien gestionactus.php dans prog

-------------------------------------------- FAIT ------------------
EN EXPLOIT. 27/05/2017
sections :
serveur + local bd cran, crantest, demo12plus, imopatest, imopa, lemta, lemtatest
table commission, commissionsection OK
table individu : codecommission, codesection OK
update individu set codecommission='', codesection='';
update individu set codecommission='01' WHERE individu.codesectioncnu<>'';
update individu set codecommission='02' WHERE individu.codesectioncnrs<>''; 
update individu,commissionsection set individu.codesection=commissionsection.codesection
 WHERE individu.codesectioncnu=commissionsection.numsection and individu.codesectioncnu <>''; 
update individu,commissionsection set individu.codesection=commissionsection.codesection
 WHERE individu.codesectioncnrs=commissionsection.numsection and individu.codesectioncnrs <>''; 
alerts.js
_const_fonc_detail -> _const_fonc_detail20170526
_controle_form _> _controle_form20170526
edit_individu -> edit_individu20170521
gestioncodifications
listepresentpartifutur_emploi_college -> listepresentpartifutur_emploi_college20170526

site cran :
detailindividupublic

-------------------
EN EXPLOIT. 24/05/2017
batch_de_nuit : correction pour IMOPA pas de mail si pas de départ/arrivée
------------------- 
EN EXPLOIT. 21/05/2017
batch_de_nuit -> batch_de_nuit_20170521
- imopa mail aux ap+srh
- OK bd imopa : insert into individuaction (codeindividu, numsejour, codelibaction, datedeb_action,datefin_action,codeacteur) 
   select codeindividu, numsejour, 'msgsejourtermine' as codelibaction, '2017/05/21' as datedeb_action,'' as datefin_action,'' as codeacteur from individusejour
   where datefin_sejour <'2017/05/21' and datefin_sejour<>''
------------------- 
EN EXPLOIT. 20/05/2017
local+serveur : bd cran, crantest, demo12plus, imopa, imopatest, lemta, lemtatest
dates comité de suivi de thèse à 12 mois, à 30 mois 
table individuthese :
ALTER TABLE `individuthese` ADD `date_suivi_comite_selection_12_mois` VARCHAR( 10 ) NOT NULL AFTER `cotutelle_commentaire`; 
ALTER TABLE `individuthese` ADD `date_suivi_comite_selection_30_mois` VARCHAR( 10 ) NOT NULL AFTER `date_suivi_comite_selection_12_mois` 
edit_individu -> edit_individu20170519 
alerts.js -> alerts.js20170519
_const_fonc_detail -> _const_fonc_detail20170519
listepresentpartifutur_emploi_college -> listepresentpartifutur_emploi_college20170519
listeindividus
-------------------
EN EXPLOIT. 15/05/2017
ajout pj fiche_arrivant
edit_individu -> edit_individu20170515
_const_fonc_detail
bd local crantest, serveur cran, imopa, lemta, demo12plus
table typepjindividu -> typepjindividu20170515 pj fiche_arrivant, carnet_vaccin 

visa arrivée si pas estzrr
gestionindividus -> gestionindividus_20170515
serveur bd imopa :
table individustatutvisa -> individustatutvisa20170515`
delete from individustatutvisa WHERE codestatutvisa='02'
insert into individustatutvisa select `codeindividu`,`numsejour`,'02' as `codestatutvisa`,`codeacteur`,`datevisa` FROM individustatutvisa WHERE codestatutvisa='01'
---------------------
EN EXPLOIT. 13/05/2017
local + serveur labo_php, labotest_php, labotest_equipe_php
sujet sur visa : envoi mail à cran-rh, reply-to = acteur expéditeur du mail
_const_fonc_mail_popup - > _const_fonc_mail_popup_20170513
table listediffusion local+serveur cran, crantest, demo12plus: ajout cran-rh@univ-lorraine.fr 13
---------------------
EN EXPLOIT le 11/05/2017
bd imopa 22H30
Résidence administrative automatique : 
UMR 7365 CNRS-UL IMoPA
Biopôle de l'Université de Lorraine
9 avenue de la Forêt de Haye
54505 VANDOEUVRE Les NANCY
---------------------
EN EXPLOIT le 05/05/2017
local + serveur labo_php, labotest_php, labotest_equipe_php
acces en consultation pj stagiaire < bac + 5 ou nationalite non française :
_const_fonc_detail -> _const_fonc_detail20170510
modif // 20170510
---------------------
EN EXPLOIT le 05/05/2017
local + serveur labo_php, labotest_php, labotest_equipe_php
gestionindividus petit bug
detailindividu :
toutes les pièces jointes et champs qui existent dans la fiche en modification
---------------------
EN EXPLOIT le 04/05/2017
local + serveur labo_php, labotest_php, labotest_equipe_php
gestionindividus
images/b_fleche_haut.png = haut_page
------------------------
EN EXPLOIT le 02/05/2017
serveur : sauve labo_php -> labo_php20170502
local + serveur labo_php, labotest_php, labotest_equipe_php
edit_commande->edit_commande20170427
gestioncommandes -> gestioncommandes20170427
verifier peut_etre_admin dans cas 'du', 'admingestfin' : si admin, la validation totale est faite pour toutes les partielles des visas cmdes 
_const_fonc -> _const_fonc_20170427
confirmer_action_commande -> confirmer_action_commande20170427
tableau_bd.css : class avoir (deplace de gestioncommandes)
------------------------
EN EXPLOIT. 30042017
FAIT local et serveur labotest_php, labo_php, labotest_equipe_php
confirmer_action_commande : <table align="center">
------------------------
EN EXPLOIT. 28042017
site cran : detailevenementpublic
------------------------
EN EXPLOIT le 27/04/2017
FAIT local et serveur labotest_php, labo_php, labotest_equipe_php
const_defaut et const_defauttest : $GLOBALS['Serveur12+commande'] = array('nom'=>'serveur 12+','lien'=>'http://195.220.155.4/'.$GLOBALS['rep_racine_site12+'].'/formintranetpasswd.php?db='.$database_labo,'emailexpediteur'=>'Didier.Wolf@univ-lorraine.fr','emailretour'=>'Carole.Courrier@univ-lorraine.fr');
----------------------
EN EXPLOIT le 25/04/2017
FAIT local et serveur labotest_php, labo_php, labotest_equipe_php
'gestul' et 'gestcnrs' remplaces par 'sif' modif notees // 20170420 :
_const_fonc : get_tab_cmd_roleuser, get_tab_contrat_roleuser, get_tab_roleuser
edit_contrateotp (+ bug jjmmaaaa2date($datedeb_contrat) et jjmmaaaa2date($datefin_ieb)
listecontrats
listecontrats_latex
gestioncontrateotp

serveur : labo_php -> labo_php20170426
local labotest_equipe_php ->  labotest_equipe_php20170426

local et serveur :
toutes bd : table proj_typeprojet : codetypeprojet vc(2),codelibtypeprojet vc(20), libtypeprojet vc(50), numordre vc(2)
toutes bd structure (données uniquement dans cran et crantest) 
table listediffusion nomliste vc(100) decription vc(100) codestructure vc(2)
toutes bd : table statutvisa : INSERT INTO statutvisa (codestatutvisa, coderole, liblong) VALUES ('11', 'gestprojet', 'Gest. projets');
toutes bd : table projet : datelimite_depot_projet vc(10),  datedepot_projet vc(10), specificites text, codetypeprojet vc(2), detailtypeprojet vc(100),  demandeaccompagnement vc(3), mail_accompagnement_projet vc(3), traite_accompagnement_projet vc(3)
crantest, cran : 
- structure : 22 gestprojet Gest. projets
- structureindividu : 22 00244


Porteur, financeur(s), niveau d'implication, spécificités du contrat en français
type de contrat 
- recherche (collaboration, étude, cifre, .....)
+ détail : date prévue du contrat, durée
- appel à projet : type (ANR, région, peps, .....)
+ détail : date limite de dépot officielle
- Montant total, montant laboratoire, intitulé, partenaires, case à cocher projet déjà déposé + date

Visas : 
brouillon -> OK 
- mail Carole, Monique, porteur, saisi par
- ou mail direct DW, MB, CC si pas d'accompagnement requis 
- case à cocher pour personne qui accompagne + mail libre comme pour justificatif
- case à cocher OK mail direct DW, MB, CC

Modif. :
_const_fonc : get_tab_roleuser
gestionprojets
edit_projet
_const_fonc_detail : detailprojet
_const_fonc_mail_popup : popup_validation_projet, mail_validation_projet, mail_accompagnement_projet
confirmer_action_projet.php
_controle_form
alerts.js

_const_fonc_mail_popup -> _const_fonc_mail_popup20170328
modif. notées // 20170328
- Modif libelles destintaires pour enlever les specificites CRAN
- verif que mail a une liste $to d'@mail correctement formée
mail_validation_projet
- from=@mail du déposant du projet
- $to="cran-".$codelibtheme."@univ-lorraine.fr"; à modifier par liste generique du groupe/equipe A FAIRE
=> associe @mail generique dans structure
------------------------ 
EXPLOIT le 23042017
local labotest_php, labo_php, labotest_equipe_php
serveur labotest_php, labo_php
gestioncommandes : petite modif. $erreur="Op&eacute;ration de relance non effectu&eacute;e.";
confirmer_action_commande : petite correction manquait tags tableau
-------------------------
EXPLOIT le 17042017
el alaoui : doct puis postdoc => dem fsd
=> enleve date_autorisation = '2014/06/23' pour  datefin_sejour_prevu < '2014/06/23' AND datefin_sejour_prevu <> ''
update individusejour set date_autorisation = ''
WHERE datefin_sejour_prevu < '2014/06/23'
AND datefin_sejour_prevu <> ''
AND date_autorisation = '2014/06/23'

droits accès MB sur commandes : budget et liste cumul/montant
--------------------------------------
EXPLOIT le 16042017
aide_gestioncommandes, aide_gestionindividus, gestioncommandes
--------------------------------------
EXPLOIT le 15042015 cran, imopa, lemta + test
table commande : ajout champ estinventorie vc(3) oui/non = inventaire fini OK cran, imopa, lemta + test
exploit : labo_php -> labo_php20170415
constdefauttest : suppression $GLOBALS['seuilmontantinventaire']='800';OK labo_php, labotest_php
normal.css : champ_input_readonly
images : image/b_cmd_equipement.png, image/b_cmd_inventorie.png,image/b_cmd_voir_equipement_seul_oui.png,image/b_cmd_voir_equipement_seul_non.png  , i/eq, i/eq1.png, i/inv, i/inv1.png
edit_commande -> edit_commande20170412
gestioncommandes -> gestioncommandes20170412
gestionindividus : beneficiaire non supprimable
duplication : pas les champs inventaire mais pbl si la personne est partie = s'affiche dans demandeur mais pbl liste inventaire OK
modifs notées // 20170412
inventaire : pouvoir retourner sur les lignes d'inventaire à chaque moment pour les gestionnaires.
suppression de peut_etre_admin_lecteur
icone : commandes d'equipement, commandes inventoriées si ligne commandeinventaire renseignee
---------------------------------------
EN EXPLOIT le 09/04/2017 cran, imopa, lemta
edit_commande -> edit_commande20170405
gestioncommandes -> gestioncommandes20170405
_const_fonc_detail -> _const_fonc_detail20170405 : detailcommande
const_defauttest :
$GLOBALS['seuilmontantinventaire']='800';

modifs notées // 20170405
Inventaire > equipement 800 euros 
destinataire de l'equipement
n° bureau localisation 
n° inventaire ou plusieurs CK ou gestionnaire 

CREATE TABLE IF NOT EXISTS commandeinventaire (
  codecommande varchar(5) NOT NULL,
  codeinventaire varchar(2) NOT NULL,
  codedestinataire varchar(5) NOT NULL,
  codelieu varchar(2) NOT NULL,
  num_bureau varchar(30) NOT NULL,
  numinventaire varchar(100) NOT NULL,
  objetinventaire varchar(100) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

--------------------
EN EXPLOIT le 08/04/2017 cran, imopa, lemta
table cmd_nature : 05, 08, 10 Equipement, gros équipement non modifiables
menubudget : Gestion natures enlevé 
---------------------
EN EXPLOIT le 05/04/2017
edit_individu -> edit_individu20170404 
modifs notees // 20170404 A METTRE EXPPLOIT
Si referent plus là, il doit toujours être affecté OK
date fin sejour renseignee et prevue vide et inversement : warning OK
table individuemploi eotp vc(30) -> vc(100)
enleve liste select centrecout OK
update individuemploi,centrecout_pers set `autrecentrecout`= libcourt WHERE individuemploi.codecentrecout=centrecout_pers.codecentrecout
-> erreur ordre sql : manque  and autrecentrecout=''
=> recup table individuemploi de sauvebdcran_20170405_20h = individuemploi_20170405_20h
renomme individuemploi dans bd cran en individuemploi_20170405_23h_mal_maj
copie individuemploi_20170405_20h en individuemploi
update individuemploi,centrecout_pers set `autrecentrecout`= libcourt WHERE individuemploi.codecentrecout=centrecout_pers.codecentrecout and autrecentrecout=''
-------------------
EN EXPLOIT le 04/04/2017
n° tel supplémentaire: edit_individu, form_fiche_dossier _const_fonc_detail, detailindividupublic, listeindividupublic
-----------------
EN EXPLOIT le 02/04/2017
_controle_pj_bd_rep_upload.php
batch_de_nuit->batch_de_nuit20170329
lancement tâches programmées batch_de_nuit_12plus.bat : ajout imopa, lemta
_const_xxx : $GLOBALS['path_to_rep_sauve']='e:/sauvebdcran-vm-web-cran'
Sauvegardes : 
- bd supprime toutes les 2H de 7 jours avant
------------------
EN EXPLOIT le 30/03/2017
pbl retour ligne avec ancre commandes :
gestioncommandes -> gestioncommandes20170330
------------------
EN EXPLOIT le 27/03/2017
edit_individu : grade pour non permanents
------------------
le 26/03/2017
labotest : renomme const_defaut en const_defauttest
IMOPA : medecine-imopa-ap@univ-lorraine.fr
$GLOBALS['menuprincipal_ligne_sous_entete']
menuprincipal : if($GLOBALS['menuprincipal_ligne_sous_entete']!='')
impopa : sections CNU, sections CNRS
toutes bases : table sectioncnu libsectioncnu_fr vc(200), libsectioncnu_en vc(200)
_const_fonc.php : rajout dans entete : sans envoi mail
Sauvegardes : sauvebdcran : sauvebd.bat ajout bd imopa et lemta
edit_individu : 
- droit $est_admin à srh
- grade pour ITARF
table grade local crantest, serveur cran, imopa, lemta

-----------------
EXPLOIT le 20170325
edit_individu -> edit_individu20170322
edit_sujet -> edit_sujet20170322
modifs // 20170322
rajout dans const_xxxx : $GLOBALS['edit_sujet_dans_individu']= OK
sujet dans individu si $est_admin
interdire pas d'intersection de themes de l'individu dans edit_sujet
enlever "(Cette affectation ne sera effective qu’après validation)" OK
gestionsujet : enleve ED à l'affichage
------------------
EXPLOIT le 20170320
edit_individu : erreur corrigée $admin_bd pour acces login/password au lieu de $est_admin
lemta : const_lemtatest et lemta : $GLOBALS['avecvisathemesujet']=false
edit_individu : si estzrr=false, pas de domaine ni de discipline 
-------------------
EXPLOIT. le 19/03/2017
ajout champ hors effectif dans listepresentpartifutur_emploi_college
edit_individu -> edit_individu20170319
modif // 20170319
PJ hors bloc ZRR si estzrr=false

edit_sujet -> edit_individu20170319 : $GLOBALS['estzrr'] => version mini du sujet OK
-------------------
EXPLOIT. le 18/03/2017
copie local serveur labo_php, serveur labotest_php -> 20170318
sauve
labotest :
edit_individu -> edit_individu20170315 => modif _const_fonc_detail
modifs notées 20170315
bug : id="modefinancement_sur_budget_labo<?php echo $sufx_numemploi ?>
PJ contrat membre associé + les avenants
hors effectif si hors effectif ETPT=0

-----------------------
EXPLOIT. le 16/03/2017
carte étudiant, contrat membre associé + avenant, hors effectif
local, serveur bases cran, crantest, imopa, imopatest, lemtatest
INSERT INTO typepjindividu (codelibcatpj, codetypepj, codelibtypepj, libtypepj, numordre) VALUES
('sejour', '15', 'carte_etudiant', 'Carte étudiant', '15');
INSERT INTO typepjindividu (codelibcatpj, codetypepj, codelibtypepj, libtypepj, numordre) VALUES
('sejour', '16', 'contrat_associe', 'Contrat associé', '16');
INSERT INTO typepjindividu (codelibcatpj, codetypepj, codelibtypepj, libtypepj, numordre) VALUES
('sejour', '17', 'avenant_associe', 'Avenant associé', '17');
INSERT INTO typepjindividu (codelibcatpj, codetypepj, codelibtypepj, libtypepj, numordre) VALUES
('sejour', '18', 'fiche_inscr', 'Fiche inscription', '18');
-----------------------
ALTER TABLE individu ADD hors_effectif VARCHAR( 3 ) NOT NULL AFTER associe 
EXPLOIT. le 15/03/2017
site lemta : bd lemtatest, const_lemtatest, images/logo_lemta_100.jpg 
-----------------------
EXPLOIT. le 12/03/2017
local + serveur labo et labo_test
gestionindividus -> gestionindividus20170312
enleve case tous dept.
edit_individu.php -> edit_individu20170312
ETPT a la place de quotité unité
Modifs notées 20170312
Après 14H
table individu : quotite_admin, quotite_unite vc(3)

table corps cran, imopa
Modif numordre codecorps 24 adj tech ppal numordre=17
INSERT INTO corps (codecorps, date_deb, date_fin, liblongcorps_fr, liblongcorps_en, liblongcorpsafficheannuaire_fr, liblongcorpsafficheannuaire_en, codestatutpers, codecat, codecorps_suivant, codecollege, codecatmissionnaire, numordre) VALUES
('25', '1980/01/01', '', 'Directeur de recherche Emérite', 'Director of Research', 'Directeur de recherche Emérite', 'Director of Research', '01', '06', '', '1A', '01', '10'),
('26', '1980/01/01', '', 'Chef de clinique assistant', 'Chef de clinique assistant', 'Chef de clinique assistant', 'Chef de clinique assistant', '01', '06', '', '1A', '01', '06'),
('27', '1980/01/01', '', 'Professeur des universités - Praticien Hospitalier Emérite', 'Professor', 'Professeur des universités - Praticien Hospitalier Emérite', 'Professor', '01', '01', '', '1A', '01', '02');
suppression des séjours de PATP
suppression cat 09, 66 corps PATP
etab
INSERT INTO `etab` (`codeetab`, `date_deb`, `date_fin`, `libcourtetab_fr`, `libcourtetab_en`, `liblongetab_fr`, `liblongetab_en`, `numordre`) VALUES
('09', '2012/01/01', '', 'INSERM', 'INSERM', 'INSERM', 'INSERM', '09');
-----------------------
EXPLOIT. le 11/03/2017 info bd et rep_upload dans chaque page pour admin
 labotest, labo local et serveur
_const_fonc : entete_page //2017031 
-----------------------
EXPLOIT. le 11/03/2017 acces prolongation FSD pour Séverine srh
edit_individu labotest, labo local et serveur
-----------------------
--------------- PLUS DE MODIF. dans cran_php et crantest_php -----------------
-----------------------
EXPLOIT. le 11/03/2017 Passage de cran_php à labo_php et crantest_php à labotest.php
labotest_php : Différents de crantest_php : 
- fichiers de conn_const
-_const_fonc :
  session_start();
  si appel avec http://.../labotest_php?db=base&annee=, _const_fonc récupère le parametre pour fixer la bdannee
  if(isset($_REQUEST['db']))
  { $_SESSION['database_labo']=$_REQUEST['db']; 
  }
  include_once('conn_const/const_'.$_SESSION['database_labo'].'.php');
  if(strpos(realpath(getcwd()),$GLOBALS['rep_racine_site12+'])===false)
  function entetehtml_page pour déconnexion
  function f : 	if($GLOBALS['local_serveur']=="l:")
- formintranetpasswd
- menuprincipal
 
renomme const.php -> const_crantest.php FAIT
const_crantest.php, const_imopa.php : FAIT
- $GLOBALS['rep_racine_site12+']='labotest_php'
- ajout des constantes de labo.php
suppression de labo.php FAIT
_const_fonc : FAIT
- si accès d'une base à l'autre : appel avec http://.../labotest_php?db=base&annee=, _const_fonc récupère le parametre pour fixer la bdannee

- include_once('conn_const/const_'.$database_labo.'.php'); FAIT
- entetehtml_page : deconnexion avec param bd (20170228) FAIT
formintranetpasswd FAIT

menuprincipal : droits d'acces rajout admin_bd pour tout FAIT

comparaison labotest_php, cran_php (copie de cran_php serveur)
copie local cran_php -> cran20170311
copie serveur cran_php en local cran_php 
_const_fonc : #
_import_individus : #
formintranetpasswd : #

cran2013, ... 2016 font appel à cran_php
tests avec crantest2015_php, crantest2016_php
modifs crantest2015_php, crantest2016_php :
- _const_fonc.php  : ajout session_start()
- menuprincipal : retour à labotest_php/menuprincipal?db=crantest

Passage en EXPLOIT.
serveur renomme labotest_php en labotest_php20170311
copie local -> serveur labotest_php 
serveur labotest_php : remet labotest_php20170311/conn_const/* ->  labotest_php/conn_const/
local renomme labo_php -> labo_php20170311 
local copie labotest_php -> labo_php remet labo_php20170311/conn_const/* ->  labo_php/conn_const/
serveur renomme labo_php -> labo_php20170311
serveur copie labotest_php en labo_php : remet labo_php20170311/conn_const/* ->  labo_php/conn_const/
cran2013_php, ... cran2016_php : local+seveur
- cran2013_php : serveur renomme _const_fonc.php -> _const_fonc20170311.php, copie local -> serveur cran2013_php/_const_fonc.php : ajout session_start();// 20170311
- cran2014_php, cran2015_php, cran2016_php : ajout session_start();// 20170311
menuprincipal 
	<!--<span class="bleugrascalibri11"><a href="/cran_php/menuprincipal.php" target="_self">Retour au site courant en exploitation</a></span> 
            20170311 -->
	<span class="bleugrascalibri11"><a href="/labo_php/menuprincipal.php?db=cran" target="_self">Retour au site courant en exploitation</a></span>
        Pour cran2016_php, pas d'acces a 2015,...
copie cran_php -> cran_php20170311, crantest_php -> cran_php20170311 :  local+seveur
formintranetpasswd.php (-> formintranetpasswd20170311.php) http_redirect('/labo_php/formintranetpasswd.php?db=cran');
------------------------
EXPLOIT. le 10/03/2017
bd local et serveur crantest, cran, imopa, imopatest : OK
- table corps ajout : 05 Chercheur associé, cat 06 Chercheur
-------------------------
EXPLOIT. le 07/03/2017
modif mail FSD : local  labo_test, labo,  serveur labo_test, labo
- confirmer_mail_validation_declaration_fsd
- _const_fonc : fsd_xl_php
- _const_fonc_mail_popup : mail_validation_declaration_fsd
- const_defaut : prenomnom, @mail fsd

local et serveur copie cran_php,crantest_php -> cran20170307_php, crantest20170307_php
- confirmer_mail_validation_declaration_fsd
- _const_fonc : fsd_xl_php
- _const_fonc_mail_popup : mail_validation_declaration_fsd
- const : prenomnom, @mail fsd
--------------------------
EXPLOIT. le 04/03/2017
modifie sur local labotest_php
copie sur local : crantest_php, cran_php et serveur :  cran_php
gestionindividus, edit_individu -> gestionindividus20170304 edit_individu20170304
gestionindividus :
modif 20170228 pour sejourpartinonvalide si estzrr=false
correction de l'aide de la colonne FSD
gestionindividus, edit_individu :
rétablit ind_ancre, chercheur associé
edit_individu :
enlève delete de individuassocie, montant attestation pour stagiaire si pas zrr ou <M2
_recup_individu_de_bd, _import_individus 
suppression table individuassocie
---------------------------
01/03/2017 : APRES COPIE crantest_php -> labotest_php et cran_php->labo_php : toutes les modifs sont faites dans labotest_php et copiees
dans crantest_php et cran_php 
---------------------------
EXPLOIT. le 20/02/2017
accentues dans les noms de fichiers fsd
table _accent_sans_accent :  local crantest, cran, serveur cran et imopa
// 19022017 
_const_fonc_mail_popup, confirmer_mail_validation_declaration_fsd : OK local+server  cran, imopa,crantest
----------------------------
EXPLOIT. le 18/02/2017 local crantest, cran, serveur cran et imopa
edit_individu : adresse pers etoile rouge
----------------------------
EXPLOIT. le 14/02/2017  cran et imopa
gestionindividus : 
- si $GLOBALS['estzrr'] alors colonne FSD
- si $GLOBALS['estzrr']=false alors visa FSD pas utilisé pour accueil/present, parti/sejourpartinonvalide
-----------------------------
EXPLOIT. le 13/02/2017 
images/logo_imopa_150.jpg
const : $GLOBALS['estzrr']=true;
edit_individu : si $GLOBALS['estzrr'] : zones jaunes et roses 
-----------------------------
EXPLOIT. le 13/02/2017
edit_individu : 1 seul message js creation individu ou sejour
-----------------------------
EXPLOIT. le 12/02/2017

gestionindividus -> gestionindividus20170212
case à cocher traite_srh=est_admin ok pour envoi fsd

crantest_php -> crantest_php20170212, local et serveur cran_php -> cran_php20170212
nettoyage ", $cran" :
_ldiff
detailmission
detailsujet
dupliquer_mission
edit_actu
edit_commande
edit_contrat
edit_contrateotp
edit_fiche_dossier_pers_partiel
edit_individu
edit_individu_fsd_renouvellement20151029
edit_mission
edit_projet
edit_sujet
fsd_listeindividu
gestionactus
gestioncodifications
gestioncommandes
gestionindividus
gestionprojets
gestionsujets
listecahiervisite
listedoct
listedoct_latex
listedoct_table_contratlatex
listedoct_table_doctorantlatex
listehdr
listeperscran
listestagiaires
listesujet_dirthese
menuprincipal

remplace $cran par $labo
_const_fonc
justifiercontrat
justifiercontrat_eit
conn_const/cran

remplace cran.ico par 12plus.ico
_modif_bd_pour_demo
detailsujet
listesujet_dirthese

remplace images/logo_cran_160.png par logo_cran_160.png par $GLOBALS['logolabo']
_const_fonc : 
fsd_sujet_pdf_php

remplace modefinancement_sur_budget_cran par modefinancement_sur_budget_labo
edit_individu :
edit_individu_fsd_renouvellement20151029

remplace cran.php, hostname_labo, database_cran, username_cran, password_cran par labo
_const_fonc
_copie_de_missions_commandes_entre_bd
_modif_bd_pour_demo
_recup_individu_de_bd 
justifiercontrat
justifiercontrat_eit
menuprincipal

listeperscran.php -> listeperslabo.php

paramétrage menuprincipal :
const : $GLOBALS['menuprincipal_ligne_sous_entete']


suppression ist/tous les fichiers
suppression _copie_de_commandes_entre_bd
suppression _copie_de_missions_entre_bd
suppression edit_individu_partiel

--------------------------
EXPLOIT. le 11/02/2017
_const_fonc fsd_x_php et formulaire_2017.xls : ajout un espace dans nom onglet "Demande..."
suppression
- _individu_sejour_sans_dept.php
- _ul_cran
- batch_de_nuit_compress
- conn_const/hal.php
- confirmer.php
- suppression de detailattestationstage_orig
- suppression de detailindividupublic, detailsujetpublic, listeevenementpublic, listeindividupublic, listesujetpublic
- suppression de listeauteurhal
- suppression de listestagiairesenquete_ul
- suppression de ouvre_classeur.vbs
- suppression de suivideveloppement
-------------------------- 
EXPLOIT. le 07/02/2017
+ report dans labo_php
_copie_de_missions_commandes_entre_bd.php : 
  - remplace $codepj par $codetypepj
  - _const_fonc.php : funtion f() ajout global $password_cran et $password_cran=$p;
-------------------------- 
EXPLOIT. le 04/02/2017
local crantest_php et labo_php : _const_fonc_mail_popup.php
mime_message($tab_params) : 
- remplace "images/","http://vm-web-cran.cran.uhp-nancy.fr/cran_php/images/",$message par "images/",$GLOBALS['racine_site_web_labo']."images/",$message
- remplace <link rel="stylesheet" href="'http://vm-web-cran.cran.uhp-nancy.fr/cran_php/styles/normal.css"> par	<link rel="stylesheet" href="'.$GLOBALS['racine_site_web_labo'].'styles/normal.css">
--------------------------
EXPLOIT. le 02/02/2017
test sur conv_accueil_inutile (il y avait une erreur resp_civile_inutile mis deux fois)
if(($row_rs_individu['resp_civile_inutile']!='oui' && !isset($tab_individu_pj[$codeindividu][$numsejour]['resp_civile']))
  || ($row_rs_individu['conv_accueil_inutile']!='oui' && !isset($tab_individu_pj[$codeindividu][$numsejour]['conv_accueil'])))
---------------------------
EXPLOIT. le 01/02/2017
adresse personnelle plus obligatoire pour un séjour de moins de 5 jours
faire réapparaitre la partie pour renseigner l'organisme d'appartenance qui est une information obligatoire à renseigner. 
->edit_individu, alerts.js, _controle_form
---------------------------
EXPLOIT. le 29/01/2017
local et serveur cran et crantest
protection acces bd 
cran.php : faux pwd
_const_fonc : ajout fonction f()
---------------------------
EXPLOIT. le 28/01/2017
controle fichiers pdf
_const_fonc_upload_file.php ligne_txt_upload_pj_individu verif upload pdf pour fsd
gestionindividus note 20170128
------------------
EXPLOIT. le 20/01/2017
modifier l'intitulé adresse administrative par Résidence administrative OK
retour a liste individus sans ancre :
edit_individu OK
gestionindividus OK
confirmer_action_individu OK
interdire consultation accès pièce identité sauf SRH _const_fonc_detail OK
------------------
EXPLOIT. le 16/01/2017
table individu : ajout num_bureau vc(30)
edit_individu
limitation visu sujets :gestionsujets -> gestionsujets20170115

voila ce que j'ai retenu pour les sujets :
- sujets proposés depuis plus d'un an : suppression de la base 12+ (ce peut aussi être depuis plus de 2 ans : il suffit de me l'indiquer)
- sujets pourvus terminés ou abandonnés : pas d'affichage web, pas d'affichage dans la liste des sujets 12+. Pas de suppression de la base 12+ bien entendu.
- sujets pourvus en cours : affichage web, affichage dans la liste des sujets 12+.
Je peux rajouter des critères qui permettent de faciliter la visualisation dans la liste des sujets 12+ :
- tous les sujets ou uniquement les sujets proposés.
- tous les sujets ou uniquement d'un certain type (stage, thèse, postdoc, collaboration)
mettre tous les fichiers fsd en pdf sauf le fsd xlsx
Effectivement on a parlé de l'année N et N-1 : sujets âgés de plus de 2 ans et non pas 1 an, ce qui laisse de la marge.
Les suppressions seraient effectuées par un programme exécuté chaque nuit sur le critère :
"aujourdhui"-datedébutsujet > 2 ans. (datedébutsujet =date supposée du sujet)
On peut prévoir d'envoyer un mail automatique au directeur de thèse, lui indiquant qu'un sujet va être supprimé : par exemple, il serait prévenu un mois avant, puis 15 jours avant la suppression effective.
On peut aussi prévoir de t'envoyer un mail automatique de la liste des sujets supprimés un mois avant, puis 15 jours avant la suppression effective.
A noter : la base de données est sauvegardée toutes les 2 heures. Passée une semaine, seule une sauvegarde journalière est conservée. Passé un mois seule une sauvegarde hebdomadaire est conservée. Passés deux mois, seule une sauvegarde mensuelle est conservée. On peut remonter les sauvegardes mensuelles sur toutes les années passées.

-------------------------
EXPLOIT. 15/01/2017
site CRAN
limitation visu sujets :listesujetpublic -> listesujetpublic20170115
-------------------------
EXPLOIT. 15/01/2017
adresse_pers, ville_pers, pays_pers
table mission : codepostal_pers vc(20), ville_pers vc(50), codepays_pers vc(3) OK
edit_mission : duplique en 20170115 
alerts.js : duplique en 20170115
- controle_form_fiche_dossier_pers, controle_form_mission, controle_form_dupliquer_mission
dupliquer_mission : duplique en 20170115
_controle_form : duplique en 20170115
- controle_form_fiche_dossier_pers OK
- controle_form_mission OK
detailmission : duplique en 20170115
gestionindividus : duplique en 20170115
- appel de edit_fiche_dossier_pers_partiel OK
edit_commande : duplique en 20170115
-  $row_rs_commande['objet']=html_entity_decode('Frais de congr&egrave;s');
------------------------
EXPLOIT. 13/01/2017
edit_fiche_dossier_partiel : ajout cp, ville pays pers adresse
edit_individu civilite : choix obligatoire.
alerts.js, _controle_form
------------------------
EXPLOIT. 12/01/2017
change intitulé objet relance justificatifs frais mission
mail_relance_missionnaire _const_fonc_mail_popup

droit acces AR
Modif. _const_fonc (droit_acces), gestionindividus, editindividu, menuprincipal,ist,
gestionannonce, gestioncentrecout, gestioncentrecout_reel, gestioncentrecoutcontrat, gestioncentrefinancier, gestioncentrefinancier_reel, 
gestiondialoguegestion, gestioneotp_source_masse, gestionnature, gestiontypesource, menubudget, gestionrel_int
-------------------------
EXPLOIT. 10/01/2017
edit_individu : generation mission pdf pour un individu sans sujet OK
controle doublon nom prenom


const: sujet these ferme
eotp montant,note=vide

edit_individu :
"FAVORABLE" par défaut OK

_const_fonc : fsd_xl_php
une zrr en trop, nom (usuel) pour PJ, avis FAVORABLE a la generation OK

_const_fonc : fsd_sujet_pdf_php
nom usuel=marital et pas jf OK
enlever financement dans sujet fsd_sujet_pdf_php OK

gestionindividus
verif de ce qu'il manque pour envoi

-----------------------
EXPLOIT. 09/01/2017
_const_fonc_detail.php : accès pj gestionnaires.
-----------------------
EXPLOIT. 09/01/2017

install phpexcel-1.8.1.zip, tcpdf : tcpdf_5_9_202.zip sur pc local et serveur OK


table individu : ajout champ codepostal_naiss vc(20), codepostal_pers vc(20), ville_pers vc(50), codepays_pers vc(3) OK
table individusejour : note varchar(1000) -> text, ajout codepostal_etab_orig vc(20), codephysiquevirtuelzrr vc(2), OK
 codedomainescientifique1 vc(3), codedisciplinescientifique1 vc(3), avis_motive_resp_zrr vc(300) OK
 renomme codetypeaccesvirtuelzrr-> codetypeaccesvirtuelzrr_old, codetypeacceszrrglobal -> codetypeacceszrrglobal_old OK
table typepieceidentitie : change lib. carte d'identité -> carte d'identité (ID) OK
table lieu : ajout champ adresselieu text + valeurs champ adresselieu OK
table situationprofessionnelle : change libelles OK
table typeacceszrr : libtypeacceszrr vc(50 -> vc(70), change libelles + ajout CDD OK
table zrr_physiquevirtuel : codephysiquevirtuelzrr vc(2), libphysiquevirtuelzrr vc(50), numordre vc(2) OK
table typepjindividu : codelibtypepj sejour, 13, fsd_sujet, sejour 14 fsd_financement OK
table individuemploi : montant_mensuel_net vc(10) OK
table sujet : avis_motive_encadrant_zrr vc(300) 
table _car_speciaux : rajouter encore certains &#2..; equivalent &#6..;

formulaire_2017.xls=enregistrement de l'original au format 97-2003 de nouveau formulaire acces ZRR valable au 01-01-2017.xlsx sans images OK
image __fsd\logo_france.jpg, filigrane.gif et png OK
images images\b_ind_voir_mes_sujets_oui.png, non OK
 

gestionindividu suppression : verifier que pas createur, modifieur d'individu, commande, mission ou resp credits OK
droit accès personnels si - 5j EXTERIEUR/PRESTATAIRE : tout le monde peut créer, modifier, supprimer quelque soit le visa OK
consultation de tout hors PJ : tout le monde OK
consultation de tout avec PJ : gesttheme, srh, admin, du OK
creation +5j : gesttheme, srh, admin, du OK
modif +5j : gesttheme tant que visa pas apposé OK
modif fiche partielle : gesttheme apres visa apposé OK
individu toujours modifiable si - 5j OK
individu passe en parti sans les visas srh et theme si < 5j = desengorge sejours partis non valides OK
suppression impossible par gest après validation référent sauf si -5j  OK
notes affichées que pour gesttheme, srh, admin OK

programmes : modifs notées // 20161213
menuprincipal : acces c, ec, itarf à  personnels
gestionindividus -> gestionindividus20161213 = limitation creation - 5j
_const_fonc->_const_fonc20161213
ini_set('include_path', ini_get('include_path').';../tcpdf/');
require_once('tcpdf.php');
function fsd_sujet_pdf_php, fsd_xl_php modifée

edit_individu  -> edit_individu20161213 : nouveaux champs fsd, droit modif < 5j, champ note augmenté en taille
alerts.js -> alerts.js20161213 : duree <=5j si personnel sans droit, controles champs fsd

_controle_form -> _controle_form20161213 si personnel sans droit, controles champs fsd
edit_fiche_dossier_pers_partiel-> edit_fiche_dossier_pers_partiel20161213

_const_fonc_detail -> _const_fonc_detail20161213 : pj acces gestheme, srh, admin
Pas utile si on ne regenere pas de classeur pour d'anciens dossiers : const.php : $GLOBALS['date_zrr_2017_obligatoire']='2017/01/01';// champs zrr obligatoires a partir de date_zrr_2017_obligatoire
fsd_xl_php_modifie.php pour tests OK


edit_individu : initialisation libtypeacceszrr selon corps/statut, codephysiquevirtuel OK 
montant, nature obligatoire, domaine et discipline OK
montant_mensuel_net OK
si pas email alors email parti pour fsd OK
 
edit_sujet -> edit_sujet20161223 : enlever activité1, domaine2, discipline2, activité2 OK
Avis motivé OK
edit_individu : effacer avis_motive_encadrant_zrr de avis_motive_resp_zrr si changement sujet
 
confirmer_mail_validation_declaration_fsd.php
ajout des PJ format pdf OK

_const_fonc_mail_popup : mail_validation_declaration_fsd OK
-------------------------------------
EXPLOIT. 03/01/2017 : 
arrivées : ajout durée séjour pour agents prévention
-------------------------------------
EXPLOIT. 03/01/2017 : 
resp SBS 08 A.RICHARD 00186 à la place de W.BLONDEL 00081
listes de diffusion : A.RICHARD à la place de W.BLONDEL
-------------------------------------
EXPLOIT. 03/01/2017 : bascule 2017
- serveur : désactive la tâche planfiée batch_de_nuit.bat OK
- local et serveur cran_php : const.php $GLOBALS['siteouvert']=false; pour fermeture site OK
- serveur compresse cran_php -> cran_php20170101.zip, cran_upload20170101.zip, sauve bd cran -> sauvebdcran_20170101_17h.sql OK
- pc local : renomme cran_php -> cran_php20170101 OK
- pc local cran remplacée par version du serveur bd cran , cran_php , cran_upload  du serveur (E:\sauvebdcran-vm-web-cran\sauvebd_prog_upload_cran20170101\) OK
- pc local : crée version 2016 par duplication de version cran pc local -> cran2016 , cran2016_php, cran2016_upload OK
- pc local modif.
    dreamweaver : site cran2016_php OK
    cran2016 const.php, cran.php et menuprincipal.php : uniquement commandes/missions budget OK
    cran const.php (dates 2017, ['date_ouverture_saisie_commandes_secr_site']='2017/01/01'), cran.php, menuprincipal.php : accès à commandes 2016 OK
-- OK deb
delete FROM commande WHERE codecommande<>'';
delete FROM commandeimputationbudget;
delete FROM commandeimputationbudget_statutvisa;
delete FROM commandejustifiecontrat;
delete FROM commandemigo;
delete from commandemigoliquidation;
delete FROM commandepj;
delete FROM commandestatutvisa;
delete FROM mission WHERE codemission<>'';
delete FROM missionetape;
delete FROM missionpj;
delete from budg_aci where supprimable<>'non';
UPDATE `budg_aci` SET date_deb='2017/01/01',`date_fin`='2017/12/31';
delete from eotp_source_montant where codeeotp >='10000';
-- OK fin
suppression pj commande/mission de rep_upload OK

--- FAIT en 3H

- serveur : duplique bd cran -> cran2016, cran_php -> cran2016_php, cran_upload -> cran2016_upload OK
- pc local cran2016 et copie sur serveur :
  - modif const, cran.php OK
  - menuprincipal pour acces a commandes/missions uniquement OK

- pc local cran_php et copie sur serveur :
  - const.php, cran.php OK
  - menuprincipal.php : accès cran2016 OK

- serveur bd cran
-- OK deb
delete FROM commande WHERE codecommande<>'';
delete FROM commandeimputationbudget;
delete FROM commandeimputationbudget_statutvisa;
delete FROM commandejustifiecontrat;
delete FROM commandemigo;
delete from commandemigoliquidation;
delete FROM commandepj;
delete FROM commandestatutvisa;
delete FROM mission WHERE codemission<>'';
delete FROM missionetape;
delete FROM missionpj;
delete from budg_aci where supprimable<>'non';
UPDATE `budg_aci` SET date_deb='2017/01/01',`date_fin`='2017/12/31';
delete from eotp_source_montant where codeeotp >='10000';
-- OK fin
suppression pj commande/mission de rep_upload OK

rajout sauvebdcran2016 batch de nuit sur serveur OK

Relance exploitation

03/01 11H45 :
renomme budg_aci->budg_aci20170103, eotp_source_montant->eotp_source_montant20170103
recup budg_aci, eotp_source_montant de 2016
UPDATE `budg_aci` SET date_deb='2017/01/01',`date_fin`='2017/12/31';
10061 supprimable='non'

Modif annee de bd orig dans _copie_de_commandes_entre_bd.php
serveur sur pc local sauve bd cran -> sauvebdcran_20170101_22h.sql
 
Modif de _copie_de_missions_commandes_entre_bd.php et sur :
10793, 10842, 10794, 10790,10788, 10786, 10785, 10655, 10624, 10318, 10242, 9142, 8327, 3663-10902,
3661-10901, 3660-10900, 3659-10891, 3658-10897, 3652-10871, 3651-10865, 3650- 10864, 3649-10867, 3643-10850,
3633-10857, 3627-10804, 3626-10802, 3625-10800, 3622-10791, 3620-10777, 3491-10352, 3488-10337, 3487-10338,
3486-10335, 3485-10336, 3464-10289, 3460-10272

+pj associées 9142, 10867 dans commandepj et rep_upload/commande

3657-10895, 3611-10762, 3602-10704, 3594-10683, 3560-10591, 3415-10142, 3414-10139, 3400-10099,
3397-10087, 3396-10097, 3387-10051, 10886, 10868, 10844, 10194, 9252

-----------------
EXPLOIT. le 18/12/2016 - 22H30
suppression chakir, ferry de gesttheme, secr, secrsite
------------------------
EXPLOIT. le 16/12/2016
ist.php
menuprincipal : lien ist.php OK
const : ajout type fichier bib $GLOBALS['file_types_array'] et $GLOBALS['file_types_mime_array'] OK
download.php OK
_const_fonc.php get_tab_roleuser OK
htdocs_upload : nouveau dossier ist/original, echange et resultat OK
tables structure et structureindividu : role ist OK
-------------------------
EXPLOIT. le 03/12/2016
soutenances en provenance de 12+
site cran listeevenementpublic, detailevenementpublic
site cran_php :
table individu champs heure_hdr vc(5), lieu_hdr vc(100), titre_hdr vc(300), resume_hdr text
edit_individu : alertes ou interdiction sur checkbox hdr et associe
_const_fonc : affichage chemin accès
alerts.js
-------------------------
EXPLOIT. le 02/12/2016
edit_individu, edit_sujet : possible pas HDR pour 1er encadrant
possible mettre un non HDR 
edit_sujet
controle_form : 1er encadrant oblig.
edit_individu
--------------------------
EXPLOIT. le 01/12/2016
gestionindividus : correction de l'erreur du delete from individuassocie avec numsejour.
---------------------------
EXPLOIT. le 28/11/2016
confirmer_action_individu -> confirmer_action_individu20161126
accepte pas supp si non supprimable
---------------------------
EXPLOIT. le 26/11/2016
cran local = copie bd d'exploit +pj
modif edit_individu->edit_individu20161126
  suppression fiches recrutement
  transfert contrat travail des sejours en emplois
  => suppr codif sejour,09, contrat_travail et modif emploi, 01, ficherecrutement -> contrat_travail
  ajout emploi,02 avenant_contrat

'00418' = supprimé de secrsite
gestionindividus -> gestionindividus20161126
ne pas afficher non supprimable car undefined onMouseOver="affiche_note(
ne pas afficher non supprimable si postdoc a sejour doct avec sujet verrouille

----------------------------
EXPLOIT. le 26/11/2016
Ajout pays de l'employeur, enleve etab ex
copie bd cran serveur et local -> cran20161126
copie bd cran serveur -> cran local
copie serveur et local cran_php\edit_individu -> edit_individu20161126
- table individuemploi : codepays_autreetab vc(3)
- edit_individu
  ajout liste pays autre employeur
  enleve etab ex..
-----------------------------
EXPLOIT. le 18/10/2016
droit d'accés L.COLSON aux pj individu
-----------------------------
EXPLOIT. le 11/10/2016
droit suppression avec ou sans mail pour prévenir ou non pour admingestfin
suppr 00418 de secrsite
gestionindividus -> gestionindividus20161011
confirmer_action_individu->confirmer_action_individu20161011
-----------------------------
EXPLOIT. le 11/10/2016
bug cdes annulees font remonter les cdes/mission dans le visa de la cde annulée 
-----------------------------
EXPLOIT. le 10/10/2016
exploit sauve bdcran en cran.sql sur pc local 
reaffecte cmd-individus ferry, chakir -> huraux

changement propriétaire commandes/missions :
SH à la place de MF
update commande set codesecrsite='00003' where codesecrsite='00645';
update mission set codesecrsite='00003' where codesecrsite='00645';
update individusejour set codegesttheme='00003' where codegesttheme='00645';
SH à la place de AC
update commande set codesecrsite='00003' where codesecrsite='00965';
update mission set codesecrsite='00003' where codesecrsite='00965';
update individusejour set codegesttheme='00003' where codegesttheme='00965';
------------------------------
EXPLOIT. le 10/10/2016
exploit renomme gestioncommandes -> gestioncommandes_20161010.php
gestioncommandes -> gestioncommandes_20161009.php
pbl execution JS dans IE
correction pour que cde annulée apparaisse si une cde liee n'est pas annulee
modif notée 10/10/2016	
-------------------------------
EXPLOIT. le 09/10/2016
pbl warning sur commande saisie à 0 :
edit_commande -> edit_commande20161008
modif notée # 08/10/2016
-------------------------------
EXPLOIT. le 05/10/2016

serveur duplique cran_php -> cran_php20161005
acces Laurence à Sabine et reciproquement : fonction droit_acces 
Laurence colson role srh et srhue :
modifs notées 4/10/2016
_const_fonc -> _const_fonc_20161004
_const_fonc_mail_popup_20161004 -> _const_fonc_mail_popup_20161004
confirmer_mail_validation_declaration_fsd_20161004.php -> confirmer_mail_validation_declaration_fsd.php
INSERT INTO `crantest`.`structureindividu` (
`codestructure` ,
`codeindividu` ,
`datedeb_struct` ,
`datefin_struct` ,
`estresp`
)
VALUES (
'13', '01107', '2005/01/01', '', 'oui'
);
rajout M.COLSON à liste cran-rh

--------------------------------
EXPLOIT. 29/09/2016
mots de passe controlé dans formintranetpasswd avec !*!,
accès limité à gestion personnels pour array('bilon','chakir','colson','huraux','parant','kondratow','lejars','maquin','rumeau','wolf','pierson','gend','sassi')
-------------------------
EXPLOIT le 25/09/2016
mail h.garnier contrats
structure : ajout relint, structureindividu ajout relint-garnier OK EXPLOIT
const_fon_mail_popup mail_validation_contrat
EXPLOIT le 25092016
msg h.garnier extérieurs
en test, envoi des mails à "TEST <".$GLOBALS['emailTest'].">"
batch_de_nuit
-------------------------
EXPLOIT le 10/09/2016
Ajout AP dans batch de nuit.
batch_de_nuit->batch_de_nuit20160910
ajout table  lieuagentprevention
-------------------------
EXPLOIT le 11/06/2016
mettre date deb sejour= date inscr a la main dans bd en verifiant ou avec listing des changements
bd cran exploit duplique individusejour en individusejour20160611 :

SELECT nom, prenom, datedeb_sejour, datefin_sejour, date_preminscr
FROM individu, individusejour, individuthese
WHERE individusejour.codecorps = '51'
AND individu.codeindividu = individusejour.codeindividu
AND individusejour.codeindividu = individuthese.codeindividu
AND individusejour.numsejour = individuthese.numsejour
AND date_preminscr <> ''
AND date_preminscr <> datedeb_sejour
ORDER BY date_preminscr
-> 83 enregistrements

update individusejour,individuthese set datedeb_sejour=date_preminscr 
where individusejour.codecorps='51'
and individusejour.codeindividu=individuthese.codeindividu and individusejour.numsejour=individuthese.numsejour
and date_preminscr<>'' 
------------------------
EXPLOIT. le 11/06/2016
liste sans emploi moins d'un mois
batch_de_nuit->batch_de_nuit20160608
------------------------
EXPLOIT. le 08/06/2016
_const_fonc droit_acces()
Maryse et Sabine= accès Laurence
------------------------
EXPLOIT. le 08/06/2016
edit_individu -> edit_individu20160608
visibilité pj assurance,...
------------------------
EXPLOIT. le 06/06/2016
enlève dates dde prolongation si < master2
------------------------
EN EXPLOIT le 02/06/2016
edit_individu -> edit_individu20160602
assurance pour tout étanger

mail referent => mail gestionnaire
batch_de_nuit->batch_de_nuit20160529
-------------------------
EN EXPLOIT. le 31/05/2016
case à cocher resp_civile, conv_accueil
indiviusejour ALTER TABLE `individusejour` ADD `resp_civile_inutile` VARCHAR( 3 ) NOT NULL ,ADD `conv_accueil_inutile` VARCHAR( 3 ) NOT NULL  
edit_individu->edit_individu20160531
gestionindividus->gestionindividus20160531
_const_fonc_upload_file : enleve aide pour upload
b_manque_pj.png
--------------------------
EN EXPLOIT. le 30/05/2016
pj resp_civile, conv_accueil 
edit_individu->edit_individu20160530
typepjindividu INSERT INTO `typepjindividu` (`codelibcatpj` ,`codetypepj` ,`codelibtypepj` ,`libtypepj` ,`numordre`)
VALUES ('sejour', '11', 'resp_civile', 'Responsabilite civile', '11');
typepjindividu INSERT INTO `typepjindividu` (`codelibcatpj` ,`codetypepj` ,`codelibtypepj` ,`libtypepj` ,`numordre`)
VALUES ('sejour', '12', 'conv_accueil', 'Conention d'accueil', '12');

---------------------------
EN EXPLOIT. le 29/05/2016
ajout Autre financement pour doctorant
ajout INSERT INTO `cran`.`modefinancement` (`codemodefinancement` ,`libcourtmodefinancement` ,`liblongmodefinancement` ,`date_deb` ,`date_fin`)
VALUES ('11', 'Autre financement', 'Autre financement', '1980/01/01', '');
INSERT INTO `cran`.`corpsmodefinancement` (`codecorps` ,`codemodefinancement` ,`date_deb` ,`date_fin` ,`numordre`)
VALUES ('51', '11', '1980/01/01', '', '11');
---------------------------
EN EXPLOIT. le 23/05/2016
pj assurance pour tous les types d'extérieurs accueillis dès lors où ils sont étrangers
---------------------------
EN EXPLOIT. le 23/05/2016
pbl dates emploi/sejour
crantest
edit_individu->edit_individu20160519
cran local et exploit edit_individu->edit_individu20160523
-------------------
EN EXPLOIT. le 11/05/2016
ADEME 00535 ITE+ à la main dans bd datedeb : 25/04/16, datefin : 24/12/19 datefin ieb : 24/12/19
--------------------
EN EXPLOIT. le 11/05/2016 
edit_individu -> edit_individu20160510
date inscr modifiable que par cran-rh remplace date deb sejour = bloquée si date inscr


lien site déclaration hébergés gestionindividus
----------------------
EN EXPLOIT. le 26/04/2016
gestionindividus = droit création/modif/suppr/nouveau sejour pour gesttheme+theme, srh, du, admingestfin, admin   
site local et exploit 
gestionindividus -> gestionindividus20160426
commente avec //modif 20160426
----------------------
EN EXPLOIT. le 20/04/2016
cran_php copie edit_individu -> edit_individu20160420, _controle_form -> _controle_form20160420
crantest_php duplique edit_individu -> edit_individu20160329
individusejour ajout champ attestation_stage oui/non OK
images/b_attestation_stage_oui, _non OK
si creer ou ajout_sejour : rajout union dans select des nouvelles dates pour calcul demander_autorisation  OK
positionne champs fsd, emploi par defaut selon caterorie, type stagiaire, duree sejour, cdd OK
cadrage badge, cle correct OK
enleve lien attestation de stage si pas de rémunération OK
copie la date de fin de sejour en date fin emploi OK
fsd numdossier zrr n'apparait plus pour copie : généré automatiquement OK
date d'inscription doctorants sous des dates du séjour et calcul d'année à partir de cette date d'inscription OK
_controle_form.php : controle_form_fiche_dossier_pers remplace TAB dans champs numériques OK
-----------------------
EN EXPLOIT. le 18/04/2016
listecontrats.php : ajout sujet pour doctorant
duplication contrats
gestioncontrats -> gestioncontrats20160418
edit_contrat->edit_contrat20160313
007 - CPER 00-06 - A masquer (faute de ne pouvoir les supprimer)
08 - CPER 07-13 - A masquer
-----------------------
EN EXPLOIT. le 01/04/2016 : batch de nuit
verif. que referent present OK
-----------------------
EN EXPLOIT. le 23/03/2016
si pas de visa : copie total montant engage virtuel dans montant engage reel
edit_commande -> edit_commande20160323
-----------------------
EN EXPLOIT. le 20/03/2016 
mail referent sur arrivee batch nuit arrivees et departs + de 5j uniquement
const.php : $GLOBALS['emailRH']='cran-rh@univ-lorraine.fr';

batch_de_nuit -> batch_de_nuit20160313.php -> batch_incoherences_individus.php
_const_fonc_mail_popup : function mime_message(tab_params) pour regrouper le code de construction de mail au format html
------------------------
EN EXPLOIT. le 20/03/2016 
alerts.js : interdit imputation vide sur submit
-------------------------
EN EXPLOIT. le 19/03/2016
sauve bd exploit cran en local sauvebdcran_20160319_14h.sql
Ajout d'un champ réservation
edit_commande->edit_commande20160319.php
table commande : ajout champ numreservation vc(50)
-------------------------
EN EXPLOIT. le 15/03/2016 
gratification=affiche jours ouvrés+gratif
_const_fonc.php fonction get_nb_open_days, edit_individu affichage nb jours ouvres entre <!-- -->
-------------------------
EN EXPLOIT. le 14/03/2016
gestioncontrats : duree exacte comparee a duree en mois
---------------------
EN EXPLOIT. le 10/03/2016
Visu. details contrat dans edit_contrateotp
affichage edit_contrateotp.php -> edit_contrateotp20160310.php
_const_fonc_detail.php -> _const_fonc_detail20160310.php
---------------------
EN EXPLOIT. 07/03/2016
renomme _copie_de_commandes_entre_bd -> _copie_de_commandes_entre_bd20160307
copie commandes 07947,07721,07755,07754,07116,07131,07257,07201,07342,07341,08083,07601,05579
modif dans prog :
eotp 10022 source 2015 = codetypecredit 01 CNRS, codecentrefinancier 05 direction, codecentrecout 00057 CRAN CNRS
correspond à
eotp 10061 codetypecredit 01 CNRS, codecentrefinancier 05 direction, codecentrecout 00057 CRAN CNRS
les codeeotp de dotation ne peuvent pas etre les memes en 2016 qu'en 2015 car le dernier seq_number de 2015 = le premier de 2016
-------------------
EN EXPLOIT. 04/03/2016
edit_individu : Ajout aide prolongation FSD
-------------------
EN EXPLOIT. 26/02/2016 lenteur affichage
copie gestioncontrats -> gestioncontrats20160226 original
copie gestioncontrats -> gestioncontrats20160227 OK 3,2Mo au lieu de 3,8Mo
-------------------
EN EXPLOIT. 25/02/2016 22H55
gestioncontrats->gestioncontrats20160225
ajout colonne date_am2i
edit_contrat -> edit_contrat20160225
champ date_am2i, nb annees contrat =20
modif alerts.js controle date date_am2i
table contrat champ date_am2i
--------------------
EN EXPLOIT. 22/02/2016
change texte mail individu visa
_const_fonc_mail_popup -> _const_fonc_mail_popup20160222
--------------------
EN EXPLOIT. 13/02/2016
modif. cont_fonc, entete_page ajout <tr></tr> en debut et fin
--------------------
EN EXPLOIT. 01/02/2016
mail commande visa ieb : ajout de l'imputation demandeur
_const_fonc_mail_popup -> _const_fonc_mail_popup20160201
--------------------
EN EXPLOIT. 29/01/2016
table individu liste_nomprenom_ascii_bib_hal text
modif. edit_individu : champ text liste_nomprenom_ascii_bib_hal=liste des nom prenom d'un meme auteur
--------------------
EN EXPLOIT. 29/01/2016
_controle_form individu trim sur nom et prenom
--------------------
EN EXPLOIT. 25/01/2016
Possible modifier tout le texte du mail de relance missionnaire
confirmer_action_commande -> confirmer_action_commande 0160125 ,_const_fonc_mail_popup -> _const_fonc_mail_popup20160125
--------------------
EN EXPLOIT. 22/01/2016
FSD automatique :
modif fsd_detail_individu, fsd_xl_php
Rajout controles dans alerts.js -> alerts20160122.js : controle_form_fiche_dossier_pers OK
_const_fonc -> _const_fonc20160122 : entre les // PG 20160120 : fsd  fsd_xl_php($codeindividu,$numsejour)
_controle_form -> _controle_form20160120.php OK
copie edit_individu -> edit_individu20160122
b_generer_classeur_fsd.png
dossier __fsd
--------------------
EN EXPLOIT. 21/01/2016
bd cran exploit. : 
- sauvebdcran_20160121_20h.sql avant modifs 
- sauvebdcran_20160121_22h.sql après modifs :
tables commandepj, contratpj, individupj, missionpj : nomfichier 100 -> 255
edit_contrat, _controle_form function controle_form_contrat : 1000
-------------------
EN EXPLOIT. 16/01/2016
edit_mission -> edit_mission20160116, edit_commande -> edit_commande20160116,
gestioncommandes -> gestioncommandes20160116
edit_individu -> edit_individu20160116, gestionindividus -> gestionindividus20160116
edit_sujet, gestionsujets, dupliquer_commande, dupliquer_mission
champs input et texte affiché : rajout de htmlspecialchars() 
-------------------
EN EXPLOIT. 08/01/2016
_const_fonc.php : function hhmn2heure($hh,$mn) : efface heure, mn si heure = 0 pour horaire missionetape
MF <-> SH pas de mail pour leurs commandes : droit_acces($tab_contexte) = rajouter un param ds tab_contexte dans get_tab_cmd_acteurs pour que mail de commande pas envoyé 
_const_fonc : 
- get_tab_cmd_acteurs ajout de $tab_contexte['function']='get_tab_cmd_acteurs';
- droit_acces($tab_contexte) ajout controle sur $tab_contexte['function']
edit_sujet : possible d'affecter un EC CHERCHEUR ITARF et pas juste un permanent.
-------------------
EXPLOIT. 07/01/2016
modif _copie_de_missions_commandes_entre_bd.php pour copie de missions/commandes liées
-------------------
EXPLOIT. 03/01/2016
sauve bd cran serveur -> pc local sauvebdcran_20160104_20h.sql
update commande set datecommande='2016/01/04' where codecommande<='08128' and codecommande<>''
-------------------
EXPLOIT. 03/01/2016 : bascule 2016
- serveur : désactive la tâche planfiée batch_de_nuit.bat OK
- local et serveur cran_php : const.php $GLOBALS['siteouvert']=false; pour fermeture site OK 
- copie bd cran, cran_upload, cran_php serveur sur pc local sauvebdcran20160102 OK 
- serveur copie bd cran -> bd crantest, cran_php -> crantest_php
- serveur crantest_php : copie depuis crantest_php local de cran.php avec modif. config., const.php avec modif. 2016 au lieu de 2015
- serveur crantest :
delete FROM commande WHERE codecommande<>'';
delete FROM commandeimputationbudget;
delete FROM commandeimputationbudget_statutvisa;
delete FROM commandejustifiecontrat;
delete FROM commandemigo;
delete from commandemigoliquidation;
delete FROM commandepj;
delete FROM commandestatutvisa;
delete FROM mission WHERE codemission<>'';
delete FROM missionetape;
delete FROM missionpj;
delete from budg_aci where supprimable<>'non';
UPDATE `budg_aci` SET date_deb='2016/01/01',`date_fin`='2016/12/31';
delete from eotp_source_montant where codeeotp >='10000';
--- FAIT en 1H
- serveur compresse cran_php -> cran_php2016002.zip, cran_upload20160102.zip, sauve bd cran -> sauvebdcran_20160103_00h.sql
- pc local : renomme cran_php -> cran_php20160102 
- pc local cran remplacée par version du serveur bd cran , cran_php , cran_upload  du serveur (E:\sauvebdcran-vm-web-cran\sauvebdcran20160102\)
- pc local : crée version 2015 par duplication de version cran pc local -> cran2015 , cran2015_php, cran2015_upload
- pc local modif. 
    cran2015 const.php, cran.php et menuppal.php : uniquement commandes/missions budget, gestioncommandes : pas de création possible  
    cran const.php (dates 2016, ['date_ouverture_saisie_commandes_secr_site']='2016/01/10'), cran.php, menuppal.php : accès à commandes 2015
delete FROM commande WHERE codecommande<>'';
delete FROM commandeimputationbudget;
delete FROM commandeimputationbudget_statutvisa;
delete FROM commandejustifiecontrat;
delete FROM commandemigo;
delete from commandemigoliquidation;
delete FROM commandepj;
delete FROM commandestatutvisa;
delete FROM mission WHERE codemission<>'';
delete FROM missionetape;
delete FROM missionpj;
delete from budg_aci where supprimable<>'non';
UPDATE `budg_aci` SET date_deb='2016/01/01',`date_fin`='2016/12/31';
delete from eotp_source_montant where codeeotp >='10000';
suppression pj commande/mission de rep_upload
--- FAIT en 3H

- serveur : duplique bd cran -> cran2015, cran_php -> cran2015_php, cran_upload -> cran2015_upload
- pc local cran2015 et copie sur serveur :
  - modif const, cran.php
  - menuprincipal pour acces a commandes/missions uniquement
  - gestioncommandes : pas de création possible

- pc local cran_php et copie sur serveur :
  - copie prog de crantest_php
  - const.php, cran.php
  - menuprincipal.php : accès cran2015

- serveur bd cran
delete FROM commande WHERE codecommande<>'';
delete FROM commandeimputationbudget;
delete FROM commandeimputationbudget_statutvisa;
delete FROM commandejustifiecontrat;
delete FROM commandemigo;
delete from commandemigoliquidation;
delete FROM commandepj;
delete FROM commandestatutvisa;
delete FROM mission WHERE codemission<>'';
delete FROM missionetape;
delete FROM missionpj;
delete from budg_aci where supprimable<>'non';
UPDATE `budg_aci` SET date_deb='2016/01/01',`date_fin`='2016/12/31';
delete from eotp_source_montant where codeeotp >='10000';
suppression pj commande/mission de rep_upload

rajout sauvebdcran2015 batch de nuit sur serveur
Modif annee de bd orig dans _copie_de_commandes_entre_bd.php
serveur sur pc local sauve bd cran -> sauvebdcran_20160103_22h.sql 
Passage de _copie_de_commandes_missions_entre_bd.php
Relance exploitation

02/01/2015 : pc local : 
- pc local et serveur : crantest et crantest2015
-- sauve cran_php -> cran2015_php, sauve bd cran serveur -> cran2015 local, cran_upload serveur -> cran2015_upload
-- cran2015_php (copie du site exploit. bd + rep_upload) : modif const.php, cran.php menuppal.php pour site, bd, upload 2015


Message Carole :
A compter du 04/01/16 :
- fermeture de la base 2016 mais l'accès aux commandes/missions 2015, 2014 et 2013 sera possible.
- nouvelle base 2016 : seules toi et Christelle aurez accès à la base 12+ commandes/missions 2016.

A compter du 2016/01/10 :
- ouverture de 12+ commandes/missions aux secr. d'appui.

-----------------
EN EXPLOIT. cran le 20151221
mettre une alerte lors du choix du categorie/corps doctorant si duree<3 ans : prevenir que ce pourrait etre un visiteur doctorant.
-> alerts.js : duree_aaaammjj, modif controle_form_fiche_dossier_pers_choix_corps
-----------------
EN EXPLOIT. cran le 20151220
_const_fonc : duree_aaaammjj erreur nbjours (jourfinbissextile au lieu de jourdebbissextile)
fsd_detailindividu : calcul avec dates prevues
-----------------
EN EXPLOIT. cran le 20151218
_const_fonc_mail_popup : message_action_individu n'affiche plus que resp theme va recevoir un mail pour fsd
message validation sujet : ajout <p align="justify"> pour decr_fr et en
detailsujet, message validation sujet, detailsujetpublic : conditions_fr et en n'étaient pas affichés
-----------------
EN EXPLOIT. cran le 20151201
confirmer_mail_validation_autorisation_fsd : ajout destinataires srhue et admingestfin
_const_fonc_mail_popup : ajout destinataires srhue et admingestfin, suppression de la fonction popup_validation_individu 
-----------------
EXPLOIT cran le 20151130
destinataire M.BILON doit etre precisee admingestfin et pas resp dept.
Sabine HURAUX : Gestionnaire Dept., Gestionnaire Dept.

Vérif. que @mail pour destinataire dans le $to de chaque fonction d'envoi de mail
-> _const_fonc_mail_popup plus de precision des roles, ajout de admingestfin
-----------------
EXPLOIT cran le 20151129
mail SH, MF si polegestion
_const_fonc -> _const_fonc20151128
get_tab_cmd_acteurs() ->// PG 20151128

duplication_commande, duplication_mission : pas dateenvoi_etatfrais

Ajout d'une info. comp. dans le mail mail_relance_missionnaire
gestioncommandes, _const_fonc_mail_popup, confirmer_action_commande
-----------------
EXPLOIT cran le 20151125
suppression individu : Nous en sommes désolés et Vous remercions de bien vouloir envoyer un message à
en haut de page ">WebMaster précisant :
- en objet : problème d’envoi de messa
_const_fonc function entete_page
-----------------
EXPLOIT cran le 20151122
mail aux secr. de site pour nouveau sejour, preciser typestage pour gratif
_const_fonc -> _const_fonc20151122 modif get_tab_individu_acteurs
_const_fonc_mail_popup : ajout de admingestfin dans mail_validation_individu 
affectation des codelieu (codesite) dans table secrsite
gestioncodifications
-----------------
EXPLOIT cran2014 le 20151119
objet, n° commande, CNRS dotation, montants, migo, ....
extraction cdes CNRS dotation reelle :
copie cran2014_php -> crantest2014_php
recup bd cran2014 serveur dans crantest2014
nouveau prog. listecommandes.php
-----------------
EXPLOIT cran le 20151119
partenaires en horizontal
edit_contrat -> edit_contrat20151119
-----------------
EXPLOIT cran le 20151118
double clic sur ligne comm/miss acces aux missions des autres pour pole gestion
gestioncommandes -> gestioncommandes20151118
//PG 20151118
-----------------
EXPLOIT cran le 20151117
Protection contre les erreurs : action=modifier et codecommande='' ou codemission='' ou codesujet=''edit_commande, edit_mission, edit_sujet, edit_contrat, dupliquer_commande, dupliquer_mission
copie edit_commande.php -> edit_commande20151117.php OK
copie edit_mission -> edit_mission20151117.php OK
copie edit_sujet -> edit_sujet20151117.php OK
copie edit_contrat -> edit_contrat20151117.php OK
copie dupliquer_commande -> dupliquer_commande20151117.php OK
copie dupliquer_mission -> dupliquer_mission20151117.php OK
commente avec //PG 20151117
-----------------
EXPLOIT cran le 10/11/2015 :
Modif. _const_fonc -> _const_fonc20151110 : droit_acces
MF voit SH et réciproquement
-----------------
EXPLOIT le 07/11/2015 :
pbl MARTIN S. - PEPS MoMIS-S. MARTIN : récup bd serveur sauvebdcran_20151107_18h.sql avant manip. sur l'eotp 
et explications CC
detail gestion contrats/eotp : affiche deux fois succes
-----------------
EN EXPLOIT. 06/11/2015
acces aux resp contrats, theme au lien liste_cumul_montant_contrat.php meme si aucune imputation de commande
gestioncommandes->gestioncommandes20151106  modifs //PG 20151106
liste_cumul_montant_contrat.php : depuis 
------------------
EN EXPLOIT cran le 05/11/2015
bug : recherche martin  => warnings (pas de commande liees)
-> gestioncommandes // PG 20151105 : correction pour warning sans consequence
------------------
EXPLOIT cran le 01/11/2015
Droits d'acces pole gestion fst //PG 20151031
gestioncommandes -> gestioncommandes20151031
_const_fonc -> _const_fonc20151031 
function droit_acces($tab_contexte)
edit_commande -> edit_commande20151031
Mail commandes : subject = Validation ... à partir du visa IEB1

droits dans tables gesttheme, secr, secrsite : 00965 Abdellah CHAKIR
changement propriétaire commandes/missions :
MF à la place de CLG
update commande set codesecrsite='00645' where codesecrsite='00857';
update mission set codesecrsite='00645' where codesecrsite='00857';
update individusejour set codegesttheme='00645' where codegesttheme='00857';
CLG  à la place de SC
update commande set codesecrsite='00857' where codesecrsite='00679';
update mission set codesecrsite='00857' where codesecrsite='00679';
update individusejour set codegesttheme='00857' where codegesttheme='00679';
------------------
EXPLOIT cran le 31/10/2015
copie cran_php local et serveur -> cran_php20151031
modif. FSD noté  avec //PG 20151029
edit_individu.php 
gestionindividus qlqs controles dans l'icone de verification FSD 
_const_fonc.php : demander_autorisation (ajout de $pourquoi_pas_de_demande_fsd='FSD - de 5 ans';)
aide_fsd.php
--------------------	
en EXPLOIT site DEMO sur 195.220.155.24 :
- après copie de la bd, manuellement : individu gend admin/demo
- avant copie des programmes sauvegarder puis les remettre : 
  cran, const, menuppal, _const_fonc_labo_dependante oK
- menuppal : enlever Gestion de matériel - Salles - Vidéoprojecteur, 2013 et 2014 OK
- worflow : pas de mail sur visa (ou autre action) OK
- verifer que du a tous les droits OK
- brouiller OK
- pièces jointes OK
- creer site http sur collective-intelligence OK
--------------------
EN EXPLOIT. cran le 20/10/2015 
modif. aide_gestionsujets
aide_fsd.php
--------------------
EN EXPLOIT. cran le 19/10/2015 
permettre de rajouter un theme dans un sujet dont les themes de l'etudiant sont deja fixes
pbl si individu dans dept le sujet affecté ne peux plus etre modifié en dept
--------------------
EN EXPLOIT. cran le 18/10/2015 
warning si les depts des encadrants pour un sujet ne sont pas tous précisés.
sauve edit_sujet -> edit_sujet20151018
--------------------
lenteur 12+ commandes :
gestioncommandes_tps_rep, robot_tps_rep
//pbl temps reponse
if(isset($_GET['codeuser']))
{ $codeuser=$_GET['codeuser'];$_SESSION['b_cmd_version_mini']=true;
}
else
{ $codeuser=deconnecte_ou_connecte();
}
// fin pbl temps reponse
// Avant pbl temps reponse $codeuser=deconnecte_ou_connecte();
--------------------
EXPLOIT. cran le 17/10/2015
copie cran_php local et serveur -> cran_php20151017
1/ sujets multi-candidats qui doivent rester proposés : case à cocher pour encadrant OK
2/ Affectation possible d'un sujet par  createur même si déja validé
gestionsujets : 
images/b_afficher_sujet_propose_oui.png et non 
aidegestionsujets
images/b_affecter.png 
edit_sujet
table sujet mettre codetypestage='01' (master) si codetypesujet=stage OK
_const_fonc_mail_popup.php : mail_validation_sujet
--------------------
EXPLOIT cran le 08/10/2015 : 
gestion individus (aide FSD gestion individus)
aide_gestionindividus.php
---------------------
EXPLOIT cran et web cran le 08/10/2015 
sujets multi-candidats qui doivent rester proposés :
- table sujet ajout champ afficher_sujet_propose vc(3) oui/non apres afficher_sujet_web
- modif site web labo listesujetpublic.php : toujours afficher en propose et pas pourvu sujet afficher_sujet_propose
---------------------
EXPLOIT cran le 06/10/2015
aide12plusbudget.html
---------------------
EXPLOIT cran le 04/10/2015
batch de nuit : Suppression des sejours de presents qui ont eventuellement ete notes 'msgsejourtermine' mais dont le sejour est en cours car modif de date fin
--------------------
EXPLOIT cran le 04/10/2015
local cran et exploit. : copie _const_fonc -> _const_fonc20151004
_const_fonc demander_autorisation : prend en compte le fait qu'un sejour a fait l'objet d'une nouvelle declaration
 depuis t0 et que les 5 ans ne s'appliquent plus
---------------------
EXPLOIT cran le 03/10/2015
FEDER, AME "INNOVATICS-Dépendance", "Prendre votre coeur en main"
-> edit_contrat :htmlentities()
---------------------
EXPLOIT cran le 30/09/2015
copie cran_php local et serveur -> cran_php20150930
prolongation pour hors t0
pour visa srhue test cas ou pas de visa srhue ('autorise sans visa' ou ...) 
gestionindividus->gestionindividus_20150927
_const_fonc, gestionindividus
---------------------
EXPLOIT cran le 30/09/2015
Incoherences : 
cas d'une autorisation qui court du fait que date fin sejour prevue = '' alors que date fin de sejour remplie pour permanent
-> gestionindividus : alerte clignotante pour du, admingestfin
images/b_ind_incoherences.png et .gif
---------------------
EXPLOIT cran le 26/09/2015
pbl zrr ICL, campus sciences qui ont la même zrr
codelieu=obligatoire, autrelieu optionnel (faire un SELECT * FROM `individu`WHERE codelieu = '')
-> edit_individu, alerts.js, controle_form
(cifre : déclaration a faire)
_const_fonc demander_autorisation : enleve test autrelieu==''
controle_form : controle_form_fiche_dossier_pers controle libzrr dans numero existe
---------------------
EXPLOIT cran le 26/09/2015
UPDATE `individusejour` SET date_autorisation='2014/06/23'  WHERE date_autorisation='2014/06/16'
const : $GLOBALS['date_zrr_t0']='2014/06/23'
---------------------
EXPLOIT cran le 21/09/2015
Ajout typeindividupj 10, retour_fsd
edit_individu
---------------------
EXPLOIT cran le 21/09/2015
Rattachement des ICL à zrr fst 
-> table zrr ajout de 13, 03, 54F29ZRR1
correction de tous les individus sans codelieu 
----------------------
EXPLOIT.cran le 15/09/2015
modification FSD :
individusejour : ajout champ date_demande_modification_fsd, note_demande_modification_fsd
edit_individu -> edit_individu_20150911 
alerts.js->alerts_20150910.js : modif. controle_form_fiche_dossier_pers 
_const_fonc : comparaison datedeb_sejour_prevu et pas datefin_sejour_prevu
confirmer_mail_validation_prolongation_fsd.php
------------------------
EXPLOIT cran le 11/09/2015
accès champs suivi thèse tout le monde
edit_individu
------------------------
EXPLOIT cran le 17/08/2015
Prolongation FSD
_const_fonc.php -> _const_fonc_20150817
modif. demander_autorisation($row_rs_ind,$tab_dates_individu_sejours)
gestionindividus -> gestionindividus_20150817
edit_individu->edit_individu_20150817
const : $GLOBALS['date_zrr_t0']='2014/06/23'

-------------------------
EXPLOIT cran et lrgptest le 09/10/2015
edit_individu : ajout de la date de fin d'appartenance à équipe
---------------------
EXPLOIT cran et lrgptest 28/07/2015 (a mettre en local vw)
Cahier visites :
listecahiervisite -> listecahiervisite_20150728
EXPLOIT cran et lrgptest 23/07/2015 (a mettre en local vw)
corpsmodefinancement 68,'' et 68 03 pour chercheur cdd
-------------------------
EXPLOIT cran 23/07/2015 :
gesttheme 00645, 00000 pour droits ferry
-------------------------
EXPLOIT cran et lrgptest 16/07/2015
verif que nombd est dans nom du chemin
_const_fonc.php
sauvegarde pj automatique
cran.php
batch_de_nuit.php
-------------------
EXPLOIT cran et lrgptest 14/07/2015 OK
photo : 
typepjindividu INSERT INTO typepjindividu (codelibcatpj, codetypepj, codelibtypepj, libtypepj, numordre) VALUES('individu', '01', 'photo', 'Photo', '01');
edit_individu -> edit_individu_20150714
+ petite modif batch_de_nuit
-------------------
EXPLOIT cran et lrgptest 12/07/2015 FAIT :
table individu : badge_acces_estrendu vc(3),num_cle vc(30),  cle_estrendu vc(3)
edit_individu -> edit_individu_20150711
aidegestion_individus, gestionindividus
batch_de_nuit : plus d'emploi dans moins d'un mois
--------------------
EXPLOITATION 10/07/2015 :
edit_individu : lien ed(s)
table ed : ajout lienpghttped vc(100)
_const_fonc_mail_popup.php : plus de mail gestperscontrat EN EXPLOIT CRAN 08/07/2015
--------------------
EXPLOITATION 04/07/2015 :
serveur bd cran -> local : sauvebdcran_20150704_18h.sql
local et serveur : cran_php -> cran_php_20150704
stagiaires <=M1 : pas de sujet
const.php ecriture correcte de $GLOBALS['avecvisathemesujet'] et dans _const_fonc_mail_popup
edit_individu--> edit_individu_20150629.php OK
gestionindividus --> gestionindividus_20150629 OK
gestionsujets --> gestionsujets_20150701 OK
edit_sujet.php --> edit_sujet_20150701.php OK
_corrige_bd : suppression de sujets typestage<>MASTER,...OK
edit_individu --> edit_individu -> edit_individu_20150701.php OK

paramétrage avec ou sans colonne visa theme
const.php : $GLOBALS['avecvisathemesujet']
gestionsujets -> gestionsujets_20150622
_const_fonc_mail_popup -> _const_fonc_mail_popup_20150622
editsujet -> editsujets_20150622
dupliquer commande, dupliquer mission EN EXPLOIT le 27/06/2015
codevisaannulemax = ''
-----------------------
Accès toutes listes personnels à tous utilisateurs personnel EN EXPLOIT le 23/06/2015
-----------------------
fin stage Elève ingénieur EN EXPLOIT le 20/06/2015
renomme edit_individu_20150620 en edit_individu, edit_sujet en edit_sujet_20150620, gestionindividus en gestionindividus_20150620
typestage : libcourttypestage 15->25
plus de stage INGENIEUR à compter du 20/06/2015
-----------------------
edit_individu 20/06/2015
attestation stage : remis partie rose zrr du bas pour stagiaires.
-----------------------
edit_individu 18/06/2015
suppression n° INSEE
-----------------------
edit_individu, gestionindividus, _const_fonc EXPLOIT 17/06/2015
stagiaire <= M1 : pas de FSD.
-----------------------
edit_individu EXPLOIT 15/06/2015
pbl equipe cochee mais pas theme
table lieu : ajout Campus sciences - 2ème cycle (table zrr : associe 54F29ZRR2) 	
-----------------------
edit_individu EXPLOIT 14/06/2015
seul sur budget cran => visu cases contrat, eotp
-----------------------
EXPLOIT 11/06/2015
edit_individu : suppression de balises incorrectes lignes 3567 3569 </table></td></tr>
gestioncodifications : appel à entete_page
edit_actu : suppression d'un commentaire
const : 
- modif valeur de $GLOBALS['table_logo_attestationstage']
- if($GLOBALS['mode_exploit']=="test" || $GLOBALS['mode_exploit']=="demo")
batch_de_nuit envoie mail que si un depart ou une arrivee
------------------------
Paramétrage 12+ : EXPLOIT 07062015
local + exploit copie cran_php -> cran_php_avant_modifs20150607
suppr. ref a CRAN :
const.php :
$GLOBALS['acronymelabo']='CRAN';
$GLOBALS['liblonglabo']='Centre de Recherche en Automatique de Nancy';
$GLOBALS['adresselabo']='CRAN - Campus Sciences - BP 70239 - 54506 VANDOEUVRE Cedex';
$GLOBALS['denominationlabo_attestationstage']='Universit&eacute; de Lorraine - '.$GLOBALS['liblonglabo'];
$GLOBALS['table_logo_attestationstage']='<table border="0"><tr><td><img src="images/logo_ul_rvb_80x180.jpg"></td><td><img src="images/logo_'.strtolower($GLOBALS['acronymelabo']).'_160.png" width="160" height="64"></td></tr></table>';
$GLOBALS['acronymetutelle']=array('universite'=>array('ul'=>array('acronyme'=>'UL')),'recherche'=>array('cnrs'=>array('acronyme'=>'CNRS')));
$GLOBALS['num_umr']='7039';
_const_fonc, _const_fonc_mail_popup, _const_fonc_labo_dependante + autres progs
- images contiennent mot dept => modif contenu image pour personnaliser
-------------------------

EXPLOIT le 05/06/2015
dupliquer_mission : pbl certains ext. sont pas dans liste déroulante
=> ajout codecatmissionnaire=05 pour visiteurs
-------------------------
EXPLOIT le 03/06/2015
_const_fonc éclaté en _const_fonc_mail_popup, _const_fonc_file_upload
edit_commande :
les secr ne peuvent plus modifier le montant en demande dès que le visa IEB 1 a été apposé
--------------------------
EXPLOIT le 02/06/2015
copie cran_php -> cran_php_avant_modifs20150602
recup bd cran exploit -> local sauvebdcran_20150602_22h.sql
duplic. OM, cde : manque extérieurs ds liste
aide_gestionindividus, sujets, _const_fonc,_const_fonc_detail, confirmer_action_commande, alerts.js

edit_commande copie avant modifs : edit_commande_02052015 
const.php : $GLOBALS['prefixe_commande_etat_avec_frais']
table commande champ dateenvoi_etatfrais vc(10), numfournisseur vc(50), groupemarchandise vc(100)
icone mail : va chercher les commandes L ou OM
vous etes partis du au, veuillez me retourner les originaux de vos factures. OM ul, L0... CNRS
date envoi EF à l'AC. Etat de frais à l'Ag. compt. dans chaque commande de mission UL ul, ou L0... CNRS
colonne en fin tableau avec date envoi
Case n° fournisseur en + ds la commande.
groupe de marchandises : zone libre à part
dans cde : visibilité imputations IEB pour gest.
---------------------
EXPLOIT le 31/05/2015
cran_php_avant_modifs20150531
démo : pas de mail
=> _const_fonc if($GLOBALS['mode_exploit']=="test") pour le retour de fonctions de mail : pas en demo
entetehtml_page, entete_page revoir
Mail après visa IEB1 : mettre libellé en normal et l'info en gras. 
---------------------- 
const.php : $GLOBALS['mode_exploit']="demo"
aide_gestionindividus, 
EN EXPLOIT. 20/05/2015
batchdenuit ; sejours debutes
----------------------
EN EXPLOIT. 20/05/2015
pbl verrouillage sujet vide !!!
choix equipe=> choix theme :  edit_fiche_dossier_pers-->edit_fiche_dossier_pers20150517
----------------------
EN EXPLOIT. 17/05/2015
get_info_user($codeuser) renvoie login en plus pour tester sur login et pas nom
correction de tous les progs qui utilisent if(strtolower($tab_infouser['nom'])==....)
----------------------
EN EXPLOIT. 10/05/2015
mission : nom de la gestionnaire par defaut
----------------------
attestation stage  EN EXPLOIT. 09/05/2015 
individusejour : ajout dureestage_mois 2 dureestage_semaine 1
modif edit_fiche_dossier_pers, detailattestationstage.php
images : telephone_attestation.png
----------------------
contrat travail en pj : contrat_travail rajouté dans typepjindividu
----------------------
EXPLOIT FAIT LE 29/04/2015 : 
Modifier dupliquer_mission suite au modifs de demande d'OM
----------------------
EXPLOIT FAIT LE 26/04/2015 : 
copie de edit_form_dossier_pers en edit_fiche_dossier_pers_20150426_ok_avant_equipe
const.php : $GLOBALS['avecequipe']=false; OK crantest 25/04/2015
table individuequipe (copie struct table de crantest_equipe) OK crantest 25/04/2015
table structure : codepere vc(2),estequipe vc(3)
edit_fiche_dossier_pers : les references faites a la notion d'equipe sont dans un if($GLOBALS['avecequipe'] OK 
-----------------------
EXPLOIT. 09/04/2015
sauve 12+ -> owncloud UL 
rep E:\sauvebdcran-vm-web-cran\cran_sauve_rep_upload -> owncloud UL
batch_de_nuit_copie_upload.php
------------------------
EXPLOIT. 06/04/2015 
EXPLOIT et local : copie cran_php -> cran_php_avant_prestataire_20150406
sauve EXPLOIT sauvebdcran_20150406_16h.sql sur pc local
pour affichage ordonné corps dans creation pers FAIT
table corps ajout numordre vc(2)
UPDATE `corps` SET `numordre`=`codecorps`, modif. corps 68 : numordre=61

interdire nouveau sejour dans le meme corps si dates contigues FAIT
-> _controle_form : controle_form_fiche_dossier_pers_choix_corps 


table cat PRESTATAIRE 99, corps 99 PRESTATAIRE EXTERNE SERVICE :
edit_fiche_dossier_pers OK
liste_individus, listepresentpartifutur_emploi_college
site cran : listeindividupublic
------------------
05/04/2015 EXPLOIT.
Pbl theme CID affiché par défaut : individutheme contient codeindividu='', codetheme='06' en exploit.
=> suppr. de cet enregistrement dans individutheme
--------------------
01/04/2015 EXPLOIT.
controle dates correctes dans un mois : _const_fonc.php estdate OK
--------------------
31/03/2015 EXPLOIT.
detailindividu : affiche dates demande et autorisation
listesujetpublic : si autorisé mais en préaccueil, affichage nom sans lien annuaire
--------------------
30/03/2015 EXPLOIT.
detailsujet : domaine, discipline, activite
--------------------
29/03/2015 EXPLOIT.
remplace $_FILES par $FICHIERS dans _const_fonc.php
--------------------
28/03/2015 EXPLOIT.
fusion listedocts et listepresentpartifutur_emploi_college.php
--------------------
25/03/2015 EXPLOIT. 
table individu : 
ajout date_hdr vc(10) update individu set date_hdr=concat(hdr_annee,'/01/01') where hdr_annee<>''
ajout num_badge_acces vc(30)
--------------------
edit_fich_dossier_pers, alerts.js, _controle_form
Accès suivi thèse si role 'theme'
--------------------
24/03/2015 EXPLOIT. :

detailmission.php, edit_mission,  controle_form_mission (_controle_form, alerts.js)
table mission OK EXPLOIT
- codeciv vc(1)
- telport vc(10)
- avecpriseenchargetotale vc(3)
- avecpriseenchargepartielle vc(3)
- avecpriseenchargeautre_ul vc(3)
- numcarteabonnetrain vc(20)
- numcarteabonneavion vc(20)
- dateabonnetrainexpire vc(10)
- dateabonneavionexpire vc(10)
- numcartefidelitetrain vc(20)
- zonegeoabonnetrain vc(50)
- zonegeoabonneavion vc(50)
- avectrain vc(3)
- hoteldates vc(30)
- vehiculepersonnelnomspersonnes vc(100)
- infocompmission vc(100)
- organismepriseencharge vc(50)
- libpays vc(50)
- montantestimemission vc(12)
- centrecout vc(100)
- eotp vc(100)

table missionetape OK EXPLOIT
- moyentransport vc(30) default '' pour que prog edit_mission actuel fonctionne

table individu OK EXPLOIT
- numcarteabonnetrain vc(20)
- numcarteabonneavion vc(20)
- dateabonnetrainexpire vc(10)
- dateabonneavionexpire vc(10)
- numcartefidelitetrain vc(20)
- zonegeoabonnetrain vc(50)
- zonegeoabonneavion vc(50)


11/03/2015 EXPLOIT. :
descr sujet >=800 car. 
edit_sujet, controle_form_sujet, alert.js
09/03/2015 EXPLOIT.:
table rel_int_continent
table pays : ajout colonne libpays_rel_int_fr, libpays_rel_int_en, codecontinent
table rel_int_organisme codeorganisme 5, codepays 3, liblieu, liborganisme_court,liborganisme_long
table rel_int_type codetype 2,libtype_fr,libtype_en
table rel_int_partenariat codepartenariat 5,codeorganisme 5,codetype 2
table rel_int_partenariatcontact codepartenariat 5,nom,prenom
table rel_int_partenariatindividu codepartenariat 5,codeindividu 5 -> rajouter dans verif. supprimer individu
modif carte.php, normal.css
---------------------------
08/03/2015 EXPLOIT :
controles alerts.js et controle_form_fiche_dossier_pers
07/03/2015 EXPLOIT :
en cours urgent car _const_fonc et const copies par erreur dans systeme exploit !!! (possible de retrouver _const_fonc et const dans sauvegarde Documents20150218.zip?) 
sauve cran_php20150307 pc local

const.php : 
$GLOBALS['logolabo']='images/logo_cran_160.png';
$GLOBALS['acronymelabo']='CRAN';
$GLOBALS['racine_site_web_cran']->$GLOBALS['racine_site_web_labo']
$racine_site_web_cran->$racine_site_web_labo
$GLOBALS['rep_racine_monsite'] -> $GLOBALS['rep_racine_site12+']
supprime $GLOBALS['ServeurCRAN'] (remplacement préalable par $GLOBALS['Serveur12+'] dans les progs)
remplace $emailDU par $GLOBALS['emailDU'],$emailACMO par $GLOBALS['emailACMO'], 
supprime var. $webMasterMail inutile
ajout $GLOBALS['emailTest'] : @mail pour tests
remplace adresse pascal.gend@univ-lorraine.fr, didier.wolf,.., avec les $GLOBALS dans tous les progs
--------------------------
EXPLOIT. le 17/02/2015
Pbl contrat 419 dans la bd sans dates deb et fin depuis mai 2014, avec dates en février (vu dans les sauvegardes)
=> suppression
nettoyage de contrateotp : l'erreur s'est peut-être produite à l'enregistrement contrat-eotp
--------------------
EXPLOIT. le 14/02/2015
plusieurs personnes pour un sujet de these
modif edit_fiche_dossier_pers : affectation possible d'un sujet a plusieurs doctorants 
gestionsujets : affichage de tous les candidats

site crantest (copie de cran):
listeindividupublic, _const_fonc, const ($GLOBALS['nb_jours_du_mois']=array(1=>31,2=>28,3=>31,4=>30,5=>31,6=>30,7=>31,8=>31,9=>30,10=>31,11=>30,12=>31);	
listesujetpublic
--------------------
EXPLOIT. le 12/02/2015
table cont_type : ajout Location matériels ou locaux
modif gestioncontrateotp : affichage icones et download contrat
---------------------
EXPLOIT. le 10/02/2015
doctorant : doc joint convention these co-tutelle, ajout conv_cotutelle dans typepjindividu
---------------------
EXPLOIT. le 08/02/2015
correction bug edit_commande : choix incohérent de type credit, enveloppe, source en dotation
-> suppression des order by centrefinancier.numordre et centrecout.numordre dans chaque select d'union centrecout, centrefinancier
-> remplaces par order by cf_numordre, cc_numordre dans select centrefinancier et centrecout
=> marche par hasard du fait de l'ordre des contrats = les premiers sont ceux du 1er cc du 1er cf
Le bug est là !!! :
-> if(firstcentrecout)// bug edit_commande car etait en commentaire !!!	

_const_fonc : formatage correct dans msg des imputations de validation commande

lien linkedin : ajout champ lienlinkedin dans 12+, modif edit_individu, detailindividu (site cran)

bug dossier saisi par C. SIMON: 02/02 vers 15H
correction manuelle :
-> n° dossier = '' :  => n° inutilisé 00011
-> sejour non enregistre
-> pj = dans sejour de E:\www_upload\cran_upload\rep_upload\individu\n° dossier=''\sejour
=> cree dossier E:\www_upload\cran_upload\rep_upload\individu\00011\sejour\01 et copie des fichiers dedans  

controle edit_fiche_dossier_pers : verif que codeindividu!='', numsejour!=''									
----------------------
EXPLOIT. le 30/01/2015
individu : notes=1000 au lieu de 400 car.

-----------------------
EXPLOIT. le 29/01/2015
bug : cdes 5523 et 5524 : mail envoyé a un autre resp de credit (dept iset au lieu de iset)
-> incoherence dans commandeimputatiobudget : centrecout n'est pas celui de la source en demande !
=> modif edit_commande : affecte codetypecredit, codecentrefinancier, codecentrecout de la source selectionnee et pas les codes envoyes dans le POST
 + modif  _const_fonc (ajout de mail_adminbd($level,$programme,$message))

Pour retrouver incohérences dans commandeimputationbudget :
SELECT * FROM `commandeimputationbudget` WHERE (codecontrat,codecentrecout) not in (select codecontrat,codecentrecout from budg_contrat_source_vue) and virtuel_ou_reel='0'
union
SELECT * FROM `commandeimputationbudget` WHERE (codeeotp,codecentrecout) not in (select codeeotp,codecentrecout from budg_eotp_source_vue) and virtuel_ou_reel='1'
------------------------
EXPLOIT 25/01/2015
modif _copie_de_commandes_entre_bd.php
05247,04547,05277,05266,05191,05166,04046->05499-05505
insert into commande (codecommande,codecreateur,date_creation,codemodifieur,date_modif,codereferent,codesecrsite,codegestsif,codetypefournisseur,libfournisseur,codemission,codeoperation,codeinventaire,codetypecredit,numcommande,datecommande,rubriquecomptable,codenature,codedialoguegestion,objet,description,datepaye_old,nummigo_old,numliquidation_old,montantpaye_automatique,estannule,note,estavoir,traite_ieb,codevisaannulemax) values ('05499','00419','2015/01/25','00244','2015/01/25','00419','00679','00012','','Carb&Diam','','','','','L06647','2015/01/25','','09','','Microscope digital + support','','','','','oui','non','','non','','')
imputation orig non trouvee en dest : contrat 10007 substitue par dotation CNRS : 10003
01 : insert into commandeimputationbudget (codecommande,codetypecredit,codecentrefinancier,codecentrecout,codecontrat,codeeotp,virtuel_ou_reel,montantengage,montantpaye,numordre) values ('05499','02','04','00055','10003','','0','768','753','01')
01 : insert into commandeimputationbudget (codecommande,codetypecredit,codecentrefinancier,codecentrecout,codecontrat,codeeotp,virtuel_ou_reel,montantengage,montantpaye,numordre) values ('05499','01','05','00057','','10022','1','768','753','01')
modif edit_commande.php : enveloppe direction dans type credits recherche de UL-CNRS
modif _const_fonc,confirmer_mail_validation_declaration_fsd : copie gesttheme lorsqu'une demande FSD part
enleve sujet collaboration :
- du site web site cran liste, detail sujet et individu
- de 12+ _const_fonc mail_validation_sujet "le sujet .....visible sur CRAN"
--------------------------
EXPLOIT 14/01/2015
Enlever labo accueil dans l'export fsd_detail si pas de sujet
financement sujet obligatoire :
- edit_sujet, controle_form, alerts.js

200 car. pour titre du poste
6000 caractères pour description de la mission.
-> table individusejour : 
edit_fiche_dossier_pers, controle_form 
--------------------------
EXPLOIT 13/01/2015
role gestperscontrat CCT 
table structure 19, gestperscontrat
table structureindividu 19,00009 (CCT)
table statutvisa : 10, gestperscontrat
const_fonc : modif get_tab_roleuser, mail_validation_commande
edit_fiche_dossier_pers : codelabintel, droit accès pj recrutement
--------------------------
EXPLOIT 12/01/2015
Perte de la description si changement de crédits
--------------------------
EXPLOIT 06/01/2015
_copie_de_commandes_entre_bd.php

--------------------------
EXPLOIT. 31/12/2014

1/ EXPLOITATION A FAIRE POUR TESTS :
- serveur copie bd cran -> bd crantest OK
- serveur bd crantest : budg_aci : ajout champ supprimable oui/non pour préserver les sources de dotation CNRS-UL
10000, 10001, 10002, 10003 (à remplir à la main dans la table budg_aci) OK
- tester envoi mails OK
- nettoyer la base OK
- tester ajout CF, CC et voir saisie commande OK

2/ A FAIRE pour bascule 2015 OK
- arrêt exploitation le 31/12/2014 OK
- serveur -> pc local : cran,cran_php, cran_upload OK (E:\sauvebd-cran_cran_php_cran_upload20141231 -> E:\sauvebdcran-vm-web-cran\sauvebdcran20141231\)
- pc local : renomme cran -> cran_php20141231 OK
- pc local supprime version cran remplacée par cran OK, cran_php OK, cran_upload OK du serveur (E:\sauvebdcran-vm-web-cran\sauvebdcran20141231\)
- pc local : crée version 2014 à partir de version cran pc local -> cran2014 OK, cran2014_php OK, cran2014_upload OK
- serveur : copie bd cran -> cran2014 OK, cran_php -> cran2014_php OK, cran_upload -> cran2014_upload OK
- pc local cran2014 et copie sur serveur : OK
  - modif const, cran.php OK
  - menuprincipal pour acces a commandes/missions uniquement OK

- pc local cran_php et copie sur serveur : OK
  - copie prog de crantest_php + images/b_aide_dotation_ul_cnrs_2015.png OK 
  - const.php OK, cran.php OK

- serveur et local : nettoyage bd cran pour 2015 OK
budg_aci : ajout champ supprimable oui/non pour préserver les sources de dotation CNRS-UL
10000, 10001, 10002, 10003 (à remplir à la main dans la table budg_aci)
base cran courante (2015) : UPDATE `budg_aci` SET date_deb='2015/01/01',`date_fin`='2015/12/31'

delete FROM commande WHERE codecommande<>'';
delete FROM commandeimputationbudget;
delete FROM commandeimputationbudget_statutvisa;
delete FROM commandejustifiecontrat;
delete FROM commandemigo;
delete from commandemigoliquidation;
delete FROM commandepj;
delete FROM commandestatutvisa;
delete FROM mission WHERE codemission<>'';
delete FROM missionetape;
delete FROM missionpj;
suppression des pj commande/mission de cran_upload
3/ rajout sauvebdcran2014 batch de nuit sur serveur
4/ Relance exploitation

29/12/2014 : pc local : Modifs programmes, ajout champ supprimable, nettoyage bd cran_test
- pc local et serveur : crantest et crantest2014
-- sauve crantest_php -> crantest2014_php, sauve bd crantest -> crantest2014, crantest_upload -> crantest2014_upload 
-- crantest2014_php : modif const.php et cran.php pour site, bd, upload 2014
-- sauve cran_php -> cran2014_php, sauve bd cran serveur -> cran2014 local, cran_upload serveur -> cran2014_upload
-- cran2014_php (copie du site exploit. bd + rep_upload) : modif const.php et cran.php pour site, bd, upload 2014

accès à 2014 et 2013 menupprincipal /<?php echo $database_cran ?>2014_php et 2013_php


CNRS a typesource-enveloppe inutile ? '00056' CNRS > Admin/rech - Direction (voir typecredit_enveloppe_typesource.png)

FAIT
---> construitlibsource($tab_construitsource) : pas de "-" si $tab_construitsource['libcentrecout_reel']=='' OK
- edit_commande.php
--> partout ailleurs, afficher Dotation (UL+CNRS) là où c'est nécessaire:
   - _const_fonc_detail : detailcommande OK
   - _const_fonc : mail_validation_commande OK
   - gestioncommandes OK
   - confirmer_action_commande OK

possibilite de credit CNRS/UL-CNRS-UL par ligne d'imputation en dde
-> en secr site, une ligne de trop de credit CNRS à l'affichage en modif et que les imputations ne sont plus modifiables OK
A verifier que correct : les types credits et enveloppes ont une affectation source/contrat dans la boucle contrat OK
=> si pas de contrat de ce type : on ne voit pas credit ou enveloppe OK
Vérifier ce que voient secr. appui quand peuvent plus modifier imputation OK

jusqu'au 29/12/2014 :
travail sur site crantest_ulcnrs_php, bd crantest_ulcnrs
->modif edit_commande.php


Message Carole :
A compter du 01/01/15 :
- fermeture de la base 2014 mais l'accès aux commandes/missions 2014 et 2013 sera possible.
- nouvelle base 2015 et programmes modifiés ("fusionner" les dotations UL et CNRS en demande) : seules toi et Christelle aurez accès à la base 12+ commandes/missions 2015.

A compter du 05/01/15 :
- ouverture de 12+ commandes/missions aux secr. d'appui.

Concernant le point "fusionner" les dotations UL et CNRS en demande, donc avoir la liste Dotation (UL+CNRS), CNRS, UL, le plus simple serait de fonctionner exactement comme en 2014 en modifiant simplement les affichages :
- dans la commande, en virtuel, la liste des "Source/Contrat"  serait scindée en deux :
  - soit il s'agit d'une source et elle est regroupée avec toutes les sources dans Dotation (UL+CNRS) :
  --> Serait affiché : UL+CNRS,  type de crédit : dotation , enveloppe : dotation , source : l'une des sources
  - soit il s'agit d'un contrat et il se trouve en UL ou en CNRS
 --> affichage habituel

Message à secr site : enlever rsa--lddir comme pour resp

-------------------------
EXPLOIT 18/12/2014
modif _const pour pouvoir creer commande :
$GLOBALS['date_fermeture_saisie_commandes_secr_site']='2014/12/31'

-------------------------
EXPLOIT 16/12/2014
Modif batch de nuit = ajout sii + Corinne _const_fonc mail_validation_commande( + Corinne
Renommer CV en : nom prenom CV numdossierzrr (comme classeur fsd voir mail husson)
webmastermail : mettre le même que user gend = Maj/min pour comparaison tab_mail_unique
--------------------------
EXPLOIT 15/12/2014
Change resp srh : moi au lieu de corinne. 
Modif batch de nuit = ajout sii + Corinne
const_fonc (mail_validation_commande) : Corinne
bug corrigé _const_fonc : la fonction periodeencours ne prend pas en compte la période infini à gauche.
fsd
- sauve serveur bd,upload,progs cran sur pc local  E:\sauvebdcran-vm-web-cran\sauvebdcran20141214 -> sauvebdcran20141214_10h.sql, cran_upload -> cran_upload20141214.zip, cran_php -> cran_php20141214.zip
_const_fonc sujet_saisi_valide : Enleve controle $row_rs_individu['datedeb_sejour']>=$GLOBALS['date_zrr_obligatoire'] OK
Saisie date autorisation au moment du visa OK
date de la dde en information sur bouton orange d'attente de retour de mail pour secr appui OK
Me mettre en copie des messages dde, autorisation,...=retester tous les envois de mails OK
petit bug calcul durée OK
Commandes
correction petit bug : affiche warning pour avoir => modif mail_validation_commande_avoir()
mail au choix sur validation de visa annulé
gestioncommandes, confirmer_action_commande, _const_fonc, aide12plusbudget.html
pbl affichage mini pour secr appui => enlevé pour l'instant
----------------------
EXPLOIT 07/12/2014
sauve gestioncommandes.php->gestioncommandes20141207.php
La recherche textuelle s'effectue sans tenir compte des autres critères : demande, engagé, service fait, payé, annulé, commandes et les missions, UL et CNRS : toutes les cases sont cochées après une recherche de ce type.
La recherche sur le "demandeur" d'OM est effectuée sur tous les demandeurs y compris ceux qui ne sont pas dans 12+ pers

contrats : date_limite_justification
sauve bd cran sur pc local : sauvebdcran20141207_20h.sql
table contrat :
- date_limite_justification
edit_contrat, edit_eotpcontrat, _const_fonc, _controle_form ->sauves en ...20141207
alerts.js
-----------------------
EXPLOIT 06/12/2014
icone dans colonne fsd si manque un champ pour construire classeur
-----------------------
EXPLOIT 05/12/2014
fsd_detailindividu.php + modif generation classeur_fsd
tables sujet_domaine, discipline, objectif
------------------------
EXPLOIT 03/12/2014
sujets : systeme d'ancre et ligne surlignee + icones de visus tous depts, mes sujets, ...
individus : colonne FSD renseignée pour srhue et autres users
renseigne les sujets des exterieurs avant la date de mise en exploit. de l'obligation d'un sujet
------------------------
EXPLOIT 30/11/2014
copie rep cran_php -> cran_php20141130, bd cran -> cran20141130, cran_upload -> cran_upload20141130
+ recup cran_php20141130.zip, cran_upload20141130.zip + bd sauvebdcran20141130_12h.sql sur pc local
+ sauve cran2013_php20141130.zip, cran2013_upload20141130.zip + bd sauvebdcran201320141130_00h.sql sur pc local

PC LOCAL - EXPLOIT :
sauvebdcran20141130_12h.sql -> bd cran, cran -> cran20141130 EXPLOIT
Mofif tables :
sujet : titre_fr, titre_en  200 -> 300 FAIT EXPLOIT
individuthese : titre_these 200 -> 300 FAIT EXPLOIT

copie des tables corps,typesujet,sujet_domainescientifique, sujet_disciplinescientifique, sujet_objectifscientifique de bd crantest  FAIT EXPLOIT
typesujet ajout : 05, Stage de recherche (copie de la table de bd crantest) FAIT EXPLOIT
corps modif CDD chercheur -> codecollege=02, codecatmissionnaire=02 FAIT EXPLOIT
sujet_domainescientifique, sujet_disciplinescientifique, sujet_objectifscientifique code 999 FAIT EXPLOIT

En prevision actus
table individu : ajout de code_rep_ou_fichier vc(5) FAIT EXPLOIT
table uploadfichier FAIT EXPLOIT
INSERT INTO uploadfichier (code_rep_ou_fichier, codepere, type_rep_ou_fichier, codeproprietaire, nom, descr) VALUES('00000', '', 'R', '', '/', '');
INSERT INTO uploadfichier (code_rep_ou_fichier, codepere, type_rep_ou_fichier, codeproprietaire, nom, descr) VALUES('00001', '00000', 'R', '', 'users', '');

table actu + enreg '' manuel FAIT EXPLOIT

copie de crantest_php -> cran_php : FAIT EXPLOIT
_java_script, i, images, tous les fichiers de crantest_php FAIT EXPLOIT
Modif cran_php de conn_const\const.php manuelle FAIT EXPLOIT


FAIT
suppression sujet actualisé dans edit_individu
message sur visa fsd : visa srh-fsd : référent + gestionnaire + MB +CCT
nouveau séjour => date fin séjour précédent obligatoire => pas de création possible si pas renseigné
ne pas valider visa srhue si pbl envoi
un sujet pour tout stagiaire (hors collège, lycée) dans une liste
5 ans de validité autorisation FSD si sejour contigus
Personnes pour lesquelles autoriation FSD ne doit pas être faite : nouveau sejour en prolongation du precedent
cahier de visite : personnels cran (+ les hors cran qui n'y sont pas encore enregistres ?) FAIT
Nom, Prénom, Date de naissance, Lieu de naissance, Nationalité, Organisme d'appartenance, Identification de l'accueillant, Date et objet de la visite
fsd_contact_ul : @ husson
acces virtuel : oui par defaut et renseigner le type
renseigner type d'accès en fonction de la cat/corps de l'individu
changement de lieu fait par secr appui, changement de ZRR : rien n'est fait
modif edit_mission select des agents
- pour avoir les ext. enleve codecatmissionnaire <>'' dans les requêtes agent : codecatmissionnaire est choisi par user.
- rajout de intituleposte (objet) de individusejour pour renseigner motif mission si EXTERIEUR
Nouveau séjour : ne pas reporter les dates de demande, d'autorisation !
- Type d'accès ZRR : renseigner en fonction du type de pers
- Postdoc : enlever Mode de financement ATER par defaut
- renseigner les champs de listes déroulantes par défaut
- initialiser les individus pour que sur les anciens dossiers
  - les sujets de stage hors master ne soient pas obligatoires OK
  - les nouveaux controles sur d'anciens dossiers ou sujets (avant le 15/09) ne soient pas effectués
  - verifier les stagiaires non master sans sujets à partir du 15/09 : 
    gestionsujets OK, gestionindividus  (sujet_saisi_valide() dans _const_fonc) OK 
- positionner champ_zrr_obligatoire=true a partir du 15/09 dans controle_form_sujet (controle_form.php et alert.js)
verifier que si erreur les valeurs sont reaffichees
Permettre de mettre une date autorisation sans visa srhue et faire comme si dde faite=validation srhue
supprimer ce qui est en lien avec visa srh et du

controle sur le chevauchement des sejours.
- n° de ZRR en plus du NOM + PRENOM à l'envoi du mail ZRR
---------------------
EN EXPLOIT le 14/11/2014
Nouveau sejour : pbl si nouvel emploi dans nouveau sejour d'un non permanent OK
Interdire 2 sejours en cours OK
gestionindividus : 
- Détail d'un personnel : les séjours ne sont pas toujours dans les bons blocs (present, parti,...)

- sur clic nouveau sejour preciser que date fin doit etre positionnée
- permettre de modifier un dossier aux secr site
---------------------
EN EXPLOIT le 14/11/2014
confirmer_mail_validation_assurance.php : crantest_php + copie cran_php
_const_fonc.php et const.php : crantest_php et cran_php indépendament
---------------------
EN EXPLOIT
Plusieurs sejours pre-accueil
---------------------
EXPLOIT le 25/10/2014
edit_fiche_dossier_pers, _const_fonc
doctorants : calcul annee inscr
-------------------------
EXPLOIT le 21/10/2014
bug correction liste_cumul_montant
bug classeur fsd : correction date inversees jj/mm par excel
-------------------------
EXPLOIT le 19/10/2014
autorisation de modif des dossiers pers par secr appui
-------------------------
EXPLOIT : le 15/10/2014
confirmer_mail_validation_fsd, confirmer_mail_validation_assurance, const.php, _const_fonc
EXPLOIT : le 13/10/2014
execution manuelle script _init_fsd_declares_avant_16062014.php
genere_classeur_fsd.xlsm : enleve - entre non et prenom, ne quitte pas le fichier enregistré
confirmer_mail_validation_fsd, const.php, _const_fonc
gestionindividus : sur recherche, décoche les autres critères
decoche auto de presents sur recherche avec ENTREE!!
recherche sur nom : pas visible si deja en detail sur recherche
const_fonc, const : corrige @mail uhp -> univ, racine_site_web
edit_sujet : trim(titre_fr) pour bug liste select des sujets des dossiers individu
--------------------------
EXPLOIT : le 12/10/2014
edit_fiche_dossier_pers :
pj : convention stage
-> ajout typepjindividu : conv_stage
enleve case a cocher assurance
déplace case code labintel, en haut visible que par srh, admingestfin, du
---------------------------
EXPLOIT : le 05/10/2014
sauve edit_eopt_source_masse.php, gestioneotp_source_masse, gestioncommandes, edit_commande _const_fonc.php en 20141005
Affichage centre cout reel a la fin d'une source :
- sauve edit_eopt_source_masse.php, gestioneotp_source_masse, gestioncommandes, edit_commande _const_fonc.php en 20140929
bug edit_eopt_source_masse.php OK
 Undefined index: datedeb_eotp_jj in C:\Users\pgend\Documents\htdocs\crantest_php\edit_eotp_source_masse.php on line 99
---------------------------
EN EXPLOIT le 28/09/2014
recherche sur n° dossier
---------------------------
EN EXPLOIT le 22/09/2014
invalidation de visas et possible valider sans message
copie gestioncommandes.php en gestioncommandes20140921.php
table commande ajout champ codevisaannulemax vc(2)
---------------------------
EXPLOIT le 20/09/2014
cas d'une commande/mission dupliquee : montantengage reel mis a '' puis sur visa dept/contrat mis a montantengage virtuel
dupliquer_commande, dupliquer_mission, gestioncommandes

individu : 
modif edit_fiche_dossier_pers, gestionindividus _const_fonc, controle_form, alerts.js :
- warning si pas d'@ mail
- positionne typepieceidentite=passeport si etranger
- positionne pays_etab_origine=pays_naiss
- aide colonne fsd

-----------------------
EXPLOIT le 16/09/2014 :
generation numdossierzrr
table individusejour
ajout champ date_demande_fsd vc(10)
-----------------------
EXPLOIT le 14/09/2014 :
- copie serveur : sauvebdcran20140914_18h.sql sur PC local
- pc local copie de cran_php -> cran_php20140914
- serveur : copie de cran_php -> cran_php20140914
- serveur : zip de cran_upload -> cran_upload20140914.zip sur PC local

0/ tables renommées
typepjindividu->typepjindividu_20140914
typestage->typestage20140914 
1/ Tables supplémentaires :
table situationprofessionnelle codesituationprofessionnelle vc(2), libsituationprofessionnelle vc(50), numordre vc(2)
table sujet_disciplinescientifique
table sujet_domainescientifique
table sujet_objectifscientifique
table typeacceszrr codetypeacceszrr vc(2), libtypeacceszrr vc(50), numordre vc(2)
table typepieceidentite codetypepieceidentite vc(2),libcourttypepieceidentite vc(50), numordre vc(2)
table typepjindividu = remplacée par celle de cran_test avec nouvelles codifs. : (sejour,05,fsd, Demande FSD,05), (sejour,06,piece_identite, Pièce d'identité,06)
table typestage  : ajout sujetstageobligatoire (oui/non)
table zrr codezrr vc(2), codelieu vc(2), libzrr vc(20), numordre vc(2)
table zrr_naturefinancement codenaturefinancement vc(2), libnaturefinancement vc(50), numordre vc(2)
table zrr_originefinancement codeoriginefinancement vc(2), liboriginefinancement vc(50), numordre vc(2)
table zrr_sourcefinancement codesourcefinancement vc(2), libsourcefinancement vc(50), numordre vc(2)
table _car_speciaux (pour conversion de certains caractères comme quote gauche dans fsd_detailindividu.php)

2/ Modification tables :
table individusejour 
-> ajout champ numdossierzrr vc(20), codetypeacceszrr vc(2),codetypeaccesvirtuelzrr vc(3), codetypeacceszrrglobal vc(3)
codetypepieceidentite vc(2), autretypepieceidentite vc(50), numeropieceidentite vc(50), adresse_etab_orig vc(100),
 codesituationprofessionnelle vc(2), autresituationprofessionnelle vc(50), intituleposte vc(100), descriptionmission vc(200),
 codestageformationremunere vc(3), codenaturefinancement vc(2), autrenaturefinancement vc(50), montantfinancement vc(12),
 codeoriginefinancement vc(2), codesourcefinancement vc(2)


table sujet :
 codedomainescientifique1, codedisciplinescientifique1, codeobjectifscientifique1, codeobjectifscientifiqueautre1, autreobjectifscientifique1
 codedomainescientifique2, codedisciplinescientifique2, codeobjectifscientifique2, codeobjectifscientifiqueautre2, autreobjectifscientifique2
ajout type stage
table sujet :
 ajout champ codetypestage vc(2)
 update sujet set codetypestage='01' where codetypesujet='02'
table typesujet : modif libelles pour Master -> Stage
table statutvisa  modif liblong SRH UE -> SRH - FSD

progs php, images, i/fsd_dwnld.png, i/cv_dwnld.png

const.php :
$GLOBALS['file_types_mime_array']=array('pdf'=>'application/pdf','doc'=>'application/msword','docx'=>'application/vnd.openxmlformats-officedocument.wordprocessingml.document','txt'=>'application/text','xls'=>'application/vnd.ms-excel',
					'xlsx'=>'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet','pptx'=>'application/vnd.openxmlformats-officedocument.presentationml.presentation',
					'csv'=>'application/vnd.ms-excel','gif'=>'image/gif','jpeg'=>'image/jpeg','jpg'=>'image/jpeg','png'=>'image/png');
$GLOBALS['nb_jours_du_mois']=array(31,28,31,30,31,30,31,31,30,31,30,31);
$GLOBALS['fsd_contact_ul'] (A corriger en exploit. : husson)
$GLOBALS['date_zrr_obligatoire']

modif edit_fiche_dossier_pers
enleve  sujet initial, niveau, forme mention
enleve case a cocher cv


dossier PC local zrr avec fichiers Formulaire_vierge_zrr_Corinne.xlsx, genere_classeur_fsd.xlsm
---------------------
EN EXPLOIT
Projets de contrats pour chaque dept.
suppression de la table projet inutile
table projet avec un enr vide,  projetpj
proj_implication, statut_projet, typepjprojet avec contenus
_const_fonc, _controle_form.php
edit_projet, gestionprojets
modif. menuppal, download.php
alerts.js
rep crantest_upload : projet
---------------------------
EN EXPLOIT
Sur visa IEB1 :
- faire apparaitre fournisseur et centre de cout réel dans le message secr. appui (Carole)
- ajout n° mission lors de l'envoi du visa ieb (Sabine)
--> _const_fonc : mail validation commande version 2014
---------------------------
CLK
- Ajout bouton effacer sur la meme ligne que dupliquer dans edit_commande
- Ajout case Calcul auto. au niveau des liquidations
---------------------------
Carole
certains contrats doivent figurer  (cadre 1) mais eotp qui ne doivent pas figurer (cadre 3) et réciproquement
=> date de fin eotp : edit_contrateotp, edit_eotp_source_masse, edit_commande (pas toujours de réel par défaut, listes cadre1 et cadre3)
---------------------------
Carole
plus d'une ligne cadre 1
---------------------------
EN EXPLOIT le 09/01 soir  (cran et cran2014)
bouton traite pour ieb
sauve bd cran sauvebdcran20140109_18h_avant_traite_ieb.sql sur pc local
crantest, reporte dans crantest2014 et cran2014 local
table commande ajout champ traite_ieb vc(3)
images : i/oui.png, i/non.png
gestioncommandes.php
---------------------------
EN EXPLOIT : version 2014
nature : enleve ptt equipement, equipemt, prest de service, mission
------------------------
En EXPLOIT :
- Rétablissement de la version mini.
                                 -------------------------
---------------------------------! COMMANDES version 2014!------------------------
                                 -------------------------
copie BD test -> crantest2014
copie crantest_php -> crantest2014_php
En test :
_const_fonc : messages non envoyes =>erreur
gestioncommandes : commentaire 12/2013 a remettre if($erreur_envoimail!="") pour permettre validation visa

Faire une sauvegarde bd toutes les 1/2heures au début de l'exploit.
A voir avec Carole :
- date ouverture Carole : cran2014 08/01
- date fermeture 2013 pour ecriture secr. appui : vendredi 10/01
- date ouverture 2014 : le 13 (transfert we du 11-12/01) 
- accès 2013 en consult. pour secr. appui par la suite
- suffixes RSA --, Centre cout pour RSA0xxx et construction du libelle en creation de source : à ajuster plus tard
- 2 contrats dans un eotp => resp, dept, (date fin ieb egales = non!!!!!) identiques. Un contrat pourrait etre noté principal => facilite programmation 
- 2 eotp pour 1 contrat : eotp completement dans le contrat ?
- nature et dialogue gestion changent si credits virtuel ou reel changent
- justif contrats apparaissent apres 1er enregistrement, le changement de type de crédit devrait modifier la liste des contrats a justifier
- OK libcourt eotp obligatoire sauf si typesource <>''

- un eotp est lie a un contrat
- detail de la liste des cumuls montants : par masse si distinguermasse ?
- cumul par contrat :
  - annule => non pris en compte
  - avoir  => cumul depenses + cumul avoirs
  - nature (UL / CNRS) => fonct, invest, salaire ?
  - visa ieb2 => montantpaye
  - visa non ieb2 => montantengage
  - distinguermasse non => cumul FIS en un seul
- export des commandes de salaire => creation de commandes a une date donnee, montant, contrat, eotp, credits,... 

A corriger :
- validation mail IEB1 pour SRH sur salaire sauf cas part.
- demandes par secr. appui
- 2 ou + virtuel
- mail_validation_commande_avoir apres clic sur 'avoir': Undefined index: eotp_ou_source in C:\Users\pgend\Documents\htdocs\crantest2014_php\_const_fonc.php on line 2534
- prendre le contrat de codecontrat mini si deux contrats dans un eotp ?
- retrier les contrats par libcontrat
- reunir contrats d'un meme eotp
- longueurs des champs dans les controles pour eviter erreur insert ou update
- nature ne doit pas changer en fonction du choix credit cadre 1 mais cadre 3
- libellé de contratjustifiecommande 
- OK libelles dans gestioncommandes
- OK petit bug pas gênant : gestioncommandes : indique c1 garnier au lieu de c2 blondel choisi dans commande pour E2
- OK gestioneotp_source_masse, edit_commande, gestioncommandes, detail_commande : libellés sources/eotp/contrats et contratjustifiecommande affichés
- OK petit bug : un resp de credits, secr. peut modifier en double cliquant la ligne de commande alors qu'il a appose son visa !!!
- OK dans edit_commande : la liste des contrats justifiés est vide en creation
- OK verifier que centrecouttheme contient tout ce qu'il faut : un codestructure par centrecout de type direction ou dept (én 2013, il n'y avait que 21-24, 52-54) OK
- OK edit_commande : au moins une source dans une enveloppe, credit, centre financier et de cout avec filtrage de ceux qui sont ans budg_contrat_source_vue ou budg_eotp_source_vue
- OK edit_commande : enregistrer contrat pour virtuel, eotp pour reel
- OK intersectionperiodes dans gestioncommandes, edit_commande,...pour commande au lieu de periodeencours

A voir dans liste_cumul_montant_contrat : $clause_where=" and find_in_set(codecentrecout,".GetSQLValueString($set, "text").")";

A verifier :
- edit_commande : Indiquer dans gestioneotp_source_masse quel contrat sera presente. Idem pour commande justifie contrat. 
- edit_contrateotp : ne pas permettre de dissocier un eotp d'un contrat qui n'a pas d'autre eotp et qui est imputé et réciproquement
- eotp pour 2 contrats => meme resp, meme dept, meme datefin_ieb : les contrats sont 'regroupés', seul l'un d'entre eux apparait dans la liste source/contrat OK
- eotp pour 2 contrats => seul l'un d'entre eux apparait dans la liste contratjustifie_commande
- gestioncommandes : cumuls sur 1 eotp à 2 contrats
- OK gestioncontrat : pas de suppression d'un contrat associé a un eotp

edit_mission :
- liste des agents y compris ABBOUD Toufik partis. S'il y en a besoin :
  - mettre un bouton : tous les agents ?
  - limiter aux personnes presentes durant l'exercice comptable ?
  Probleme vient de intersectionperiode a la creation de la mission ou de manque maj du SRH
- OK select des contrats dans commandeimputationbudget doivent etre faits sur virtuel (idem pour eotp sur reel) 
- OK gestioncontrateotp : la liste ne doit pas comporter de doublons si un contrat est dans 2 eotp - 
- un eotp peut etre associe a plus d'un contrat s'ils ont le meme dept et le meme resp scientifique, memes fin ieb
- OK un contrat qui a au moins une imputation est toujours dans la liste select des contrats de la commande correspondante
- OK un eotp qui a au moins une imputation est toujours dans la liste select des contrats de la commande correspondante
- OK contrat et eotp si 1 contrat dans 2 eotp et 1 eotp dans 2 contrats.  
- OK visibilité par resp. crédits, dept, directeur, secr, sif, srh 

A faire :

 
A faire :
- deux imputations en virtuel.
- regrouper les contrats d'un eotp en un seul en cumul

Fait
- OK table centrecout_pers utilisee par edit_fiche_dossier_pers,....
- OK faire en sorte que deux contrats du même eotp n'apparaissent qu'une fois dans liste contrats
- OK enlever nature mission => modif gestioncommandes et edit_commande
- OK Proposer de typer les sources (ACI, secr appui,...) au lieu de faire des enveloppes specifiques => regroupement possible
- OK Afficher le resp de crédits à cote de la liste select des resp credits si ''
- OK Compléter libellé source par suffixe_dotation_ dans edit_commande

Modif :
- ajout icones dans images
- menuppal
- edit_contrateotp : datefin_ieb
- gestioncontrateotp
- _const_fonc : controle_form_eotp_source_masse, mail_validation_commande, get_tab_cmd_acteurs
- _const
- edit_commande : sources,..., datefin_ieb
- gestioncommandes 
- _const_fonc_detail
- genereimages et gestioncommandes pour versionmini (reporté dans crantest_php et cran_php)
- edit_contrat laisse la datefin_ieb vide => toujours visible par IEB pour modif. éventuelle

Ajout prog :
- gestioncentrefinancier
- gestioncentrecout
- gestioncentrefinancier_reel
- gestioncentrecout_reel
- gestioneotp_source_masse
- edit_eotp_source_masse
- gestioneotp_source_masse
- menubudget
- gestionnature
- gestiondialoguegestion
- gestionannonce
- gestiontypesource

seq_number : ajout budg_aci debute a dernier utilisé =>init a 09999 si aucun
table eotp : ajout distinguermasse vc(3), codecentrecout_reel vc(3)
table budg_aci : ajout distinguermasse vc(3), codecentrecout_reel vc(3), codetypesource  vc(2)
table centrecout : ajout modifiable (cran-cnrs, direction et les depts ne le sont pas)
table commandeimputation : suppression champ codeenveloppe
table centrefinancier : renomme les libelles
table commande : ajout codedialoguegestion
table cmd_nature : ajout champ modifiable
table cmd_nature : suppr. ptt équip, prest serv. UL, renomme op. int. en commande int., suppr. '04'= mission pour UL, ajout '', salaire non modifiable UL et CNRS
table contrat : ajout datefin_ieb, update contrat set datefin_ieb=datefin_contrat
centrecouttheme : ajout 00047,00 cran-cnrs->direction
table contrat : suppression champ centrecout
tables centrecout, centrecouttheme, budg_aci, centrecouteotpbudgetmasse,centrecouttheme,commandeimputationbudget,eotp
 modif taille (2->5) codecentrecout dans la structure de table (+numordre taille 2->5 pour table centrecout)
 update ... set codecentrecout=concat('000',codecentrecout) where codecentrecout<>''

vue budg_contrat_source_vue, budg_eotp_source_vue, budg_contrateotp_source_vue
suppression table enveloppe, typeenveloppe

nouveau table eotp_source_montant : champs codeeotp_source, codeoperation, montantfonctionnement, montantinvestissement,montantsalaire,dateoperation, note
nouveau table centrecout_reel avec un enreg ''
nouveau table centrefinancier_reel avec un enreg ''
nouveau table cont_orggesttypecredit : lien cont_orggest typecredit
nouveau table annonce
nouveau table cmd_dialoguegestion avec un enreg ''
nouveau table cmd_typesource avec un enreg '' (regroupement ACI, Missions,...)
nouveau table budg_aci : delete FROM budg_aci

Sauve centrecout en centrecout07122013
Suppression dans centrecout de tout sauf les dept par source de credit, CRAN-CNRS cf du cnrs, Direction centrefinancier de l'UL
delete FROM commande WHERE codecommande<>''
delete FROM commandeimputationbudget
delete FROM commandejustifiecontrat
delete FROM commandemigo
delete from commandemigoliquidation
delete FROM commandepj
delete FROM commandestatutvisa
delete FROM mission WHERE codemission<>''
delete FROM missionetape
delete FROM missionpj
delete FROM budg_aci


duplique rep cran_upload en cran2013_upload + suppression des pj de commande dans cran_upload
il faudra aussi copier le rep crantest_upload en crantest2013_upload 
supprimer les pj des commandes de 2013 en 2014 ?

-- Local et exploitation 07/01/2014 --
local : 
bd cran2014
rep htdocs/cran2014_php
copie de htdocs/crantest2014_php/*.* dans htdocs/cran2014_php
copie de htdocs_upload/cran_upload dans htdocs_upload/cran2014_upload
Nouveau site dreamweaver : cran2014_php
Modif. cran2014/conn_const/const.php :
- $mode_exploit="normal";
- $display_errors=false;
- $GLOBALS['rep_racine_monsite']='cran2014_php';
Modif. cran2014/conn_const/cran.php
Exporte bd cran exploit -> bd cran2014 local : mysql -u root -proot cran2014<C:\Users\pgend\Documents\sauvebdcran-vm-web-cran\sauvebdcran20140107_20h.sql

site en exploitation :
- menuppal.php : enlève liens vers gestion individus, contrats et sujets
- gestioncommandes.php : commente boutons créer, ajout commande, dupliquer commande
- pour les commandes, des suppressions, modifs peuvent etre faites : les tables seront vidées dans la version 2014

site local :
cran2014 :
seq_number : ajout budg_aci debute a dernier utilisé =>init a 09999 
table eotp : ajout distinguermasse vc(3), centrecout_reel vc(3)
table budg_aci :  ecrasee par copie de la structure de celle de crantest2014 qui est OK
sauve table centrecout en centrecout07122013 
table centrecout : ecrasee par copie de celle de crantest2014 qui est OK
table commandeimputation :  ecrasee par celle de crantest2014 qui est OK
table centrefinancier :  ecrasee par copie de la structure de celle de crantest2014 qui est OK
table commande :  ecrasee par copie de la structure de celle de crantest2014 qui est OK
table cmd_nature : ecrasee par copie de celle de crantest2014 qui est OK
table contrat : ajout datefin_ieb, update contrat set datefin_ieb=datefin_contrat. Suppression champ centrecout
table centrecouttheme : ecrasee par copie de celle de crantest2014 qui est OK
table centrecout : ecrasee par copie de celle de crantest2014 qui est OK
suppression (renomme en _old) table enveloppe, typeenveloppe
nouveau table eotp_source_montant : copie de la structure de celle de crantest2014 qui est OK
nouveau table centrecout_reel avec un enreg '' : copie de celle de crantest2014 qui est OK (enreg '' et 3 lignes OK)
nouveau table centrefinancier_reel avec un enreg ' : copie de celle de crantest2014 qui est OK (enreg '' et 3 lignes OK)
nouveau table cont_orggesttypecredit : copie de la structure de celle de crantest2014 qui est OK
nouveau table annonce : copie de celle de crantest2014 qui est OK
nouveau table cmd_dialoguegestion avec un enreg '' : copie de celle de crantest2014 qui est OK avec export du 1er enreg
nouveau table cmd_typesource avec un enreg '' : copie de celle de crantest2014 qui est OK avec les enreg
suppression table enveloppe, typeenveloppe

table eotp 
- duplique en eotp20140108
- modif taille (2->5) codecentrecout dans la structure de table
- update eotp set codecentrecout=concat('000',codecentrecout) where codecentrecout<>''

vues :
- table vues : ecrase avec celle de crantest2014 qui est OK avec les enreg
- execute vue budg_contrat_source_vue, budg_eotp_source_vue, budg_contrateotp_source_vue

delete FROM commande WHERE codecommande<>'';
delete FROM commandeimputationbudget;
delete FROM commandejustifiecontrat;
delete FROM commandemigo;
delete from commandemigoliquidation;
delete FROM commandepj;
delete FROM commandestatutvisa;
delete FROM mission WHERE codemission<>'';
delete FROM missionetape;
delete FROM missionpj;
delete FROM budg_aci;

seq_number :
compare celle  en local de bd cran2014 avec celle en exploit. de bd cran : OK

MISE EN EXPLOITATION cran2014 :
sauvegardes :
- sauve cran_upload en cran_upload20140108
- lance sauvebdcran : sauvebdcran20140108_11h.sql
mise en oeuvre :
- duplique www_upload\cran_upload en www_upload\cran2014_upload (les pj des commandes et missions 2013 y sont mais ne seront plus utilisées)
- creation www\cran2014_php : copie du site local
- Modif. cran2014/conn_const/cran.php exploit
- creation bd cran2014 EXPLOIT et copie du contenu de cran2014 base locale

restrictions accès local et exploit.
- menuppal.php : enlève liens vers gestion individus, contrats et sujets
- pour les commandes, des suppressions, modifs peuvent etre faites : les tables seront vidées dans la version 2014

crantest2014_php, cran2014_php local et EXPLOIT : 
_const_fonc : remet messages envoyes pour validation (au lieu de erreur test et en exploit
gestioncommandes : remet if($erreur_envoimail!="") pour permettre validation visa (mis en commentaire pour les tests en test et en exploit 12/2013 a remettre 

bd crantest2014 serveur update individu set email='pascal.gend@univ-lorraine.fr' where codeindividu<>'' : OK
gestioncommandes : enleve lien vers Dépenses/recettes/solde 2014 /*  A remettre quand recettes saisies 01/2014


---------------------------------------------------
A FAIRE ce week-end pour basculement 2013/2014 :


EXPLOIT.:
Exporte bd cran exploit cran (sauvebdcran20140112_08h_avant_passage_v2014.sql) (XX) et
  cran2014 (sauvebdcran2014_20140112_08h_avant_passage_v2014.sql en local manuellement) (XX)
- Ferme les site cran_php et cran2014_php : message de fermeture dans const.php de chaque site directement sur serveur (XX)
- DUPLIQUE rep www\cran_php en www\cran2013_php (XX)
- DUPLIQUE rep www_upload\cran_upload en www_upload\cran2013_upload et en www_upload\cran_upload_20140112_08h (XX)
- zip cran_upload en cran_upload_20140112_10h.zip  (XX)
  et transfert sur site local (sauvegarde)  (XX)

sauvegarde de cran serveur dans nouvelle bd cran2013
- creation bd cran2013  (NE PAS UTILISER RENOMME BD SOUS PHPMYADMIN!!)  (XX)
- import bd cran fichier sql : mysql -u root -pXXXX cran2013< E:\...\sauvebdcran20140112_08h_avant_passage_v2014.sql  (XX)

LOCAL : travail sur base cran locale et données à copier de cran2014 de l'exploit.
sauvegarde de cran local dans nouvelle bd cran2013 (NE PAS UTILISER RENOMME BD SOUS PHPMYADMIN : pbl avec les vues !!)  (XX)
sauvegarde cran et crantest local dans C:\Users\pgend\Documents\sauvebd_janvier_2014\locales\cran.sql et crantest.sql 
sous phpmyadmin
- creation bd cran2013  (XX)
- suppression puis creation bd cran  (XX)

Importe bd cran exploit -> bd cran local : mysql -u root -proot cran<C:\Users\pgend\Documents\sauvebdcran-vm-web-cran\sauvebdcran20140112_08h_avant_passage_v2014.sql (XX)
Importe bd cran exploit -> bd cran2013 local : mysql -u root -proot cran2013<C:\Users\pgend\Documents\sauvebdcran-vm-web-cran\sauvebdcran20140112_08h_avant_passage_v2014.sql (XX)

bd cran locale :
seq_number : ajout budg_aci debute à valeur provenant de cran2014 (XX)
table budg_aci :  renomme en budg_aci20140112 puis creee  par copie de celle de cran2014 (XX)
table centrecout : renomme en centrecout_pers puis creee par copie de celle de cran2014 (XX)
table commande :  renomme en commande20140112 puis creee par copie de celle de cran2014 (normalement que enreg '') (XX)
table commandeimputation :  renomme en commandeimputation20140112 puis creee par copie de celle de cran2014 (XX)
table centrefinancier :  renomme en centrefinancier20140112 puis creee par copie de celle de cran2014 (XX)
table cmd_nature : renomme en cmd_nature20140112 puis creee par copie de celle de cran2014 (XX)
table centrecouttheme : renomme en centrecouttheme20140112 puis creee par copie de celle de cran2014 (XX)

table contrat (modifs mais pas de creation de contrat FC et CC dans les 2 bases cran et cran2014)
- duplique en contrat20140112 (XX)
- Ajout datefin_ieb vc(10), Suppression champ centrecout et eotp (XX)
- duplique contrat en contrat2014 dans bd cran2014 et copie de contrat2014 dans bd cran (XX)
- compare contrat et contrat2014 dans bd cran :
  - SELECT * FROM `contrat2014` WHERE codecontrat not in (select codecontrat from contrat) (XX)
  - SELECT * FROM `contrat` WHERE codecontrat not in (select codecontrat from contrat2014) (XX)
- update contrat,contrat2014 set contrat.datefin_ieb=contrat2014.datefin_ieb where contrat.codecontrat=contrat2014.codecontrat (XX)

table eotp (suppose que CC n'a pas modifié eotp dans cran)
- duplique en eotp20140112
- duplique eotp en eotp2014 dans bd cran2014 et copie de eotp2014 dans bd cran (XX)
- compare eotp et eotp2014 dans bd cran
  - SELECT * FROM `eotp2014` WHERE codeeotp not in (select codeeotp from eotp) (XX)
  - SELECT * FROM `eotp` WHERE codeeotp not in (select codeeotp from eotp2014) (XX)
--> 2 lignes de plus dans eotp2014 : 00105,00106 (normal = rajout CC)
- si OK, supprime eotp et creee eotp par copie de celle de cran2014 (XX)

table contrateotp 
- duplique en contrateotp20140112 (XX)
- duplique contrateotp en contrateotp2014 dans bd cran2014 et copie de contrateotp2014 dans bd cran (XX)
- compare contrateotp et contrateotp2014 dans bd cran (X)
  - SELECT * FROM `contrateotp2014` WHERE codecontrat not in (select codecontrat from contrateotp) (XX)
--> 2 lignes de plus dans contrateotp2014 : (00105,00393), (00106,00411) (normal = rajout CC)
  - SELECT * FROM `contrateotp` WHERE codecontrat not in (select codecontrat from contrateotp2014) (XX)
  - SELECT * FROM `contrateotp2014` WHERE codeeotp not in (select codeeotp from contrateotp) (XX)
--> 2 lignes de plus dans contrateotp2014 : (00105,00393), (00106,00411) (normal = rajout CC)
  - SELECT * FROM `contrateotp` WHERE codeeotp not in (select codeeotp from contrateotp2014) (XX)
  - SELECT * FROM `contrateotp2014` WHERE (codecontrat,codeeotp) not in (select codecontrat,codeeotp from contrateotp) (XX)
--> 2 lignes de plus dans contrateotp2014 : (00105,00393), (00106,00411) (normal = rajout CC)
  - SELECT * FROM `contrateotp` WHERE (codecontrat,codeeotp) not in (select codecontrat,codeeotp from contrateotp2014) (XX)
- si OK supprime contrateotp et creee contrateotp par copie de celle de cran2014 (XX)

nouveau table annonce : copie de celle de cran2014 (XX)
nouveau table centrecout_reel : copie de celle de cran2014 (XX)
nouveau table centrefinancier_reel : copie de celle de cran2014 (XX)
nouveau table cmd_dialoguegestion : copie de celle de cran2014 (XX)
nouveau table cmd_typesource : copie de celle de cran2014 (XX)
nouveau table cont_orggesttypecredit : copie de la structure de celle de cran2014 (XX)
nouveau table eotp_source_montant : copie de celle de cran2014 (XX)
suppression (renomme en _old) table enveloppe, typeenveloppe (XX)

vues :
- table vues : renomme en vues20140112 puis creee par copie de celle de cran2014 (XX)
- execute vue budg_contrat_source_vue, budg_eotp_source_vue, budg_contrateotp_source_vue (XX)

 (XX)
delete FROM commande WHERE codecommande<>'';
delete FROM commandeimputationbudget;
delete FROM commandejustifiecontrat;
delete FROM commandemigo;
delete from commandemigoliquidation;
delete FROM commandepj;
delete FROM commandestatutvisa;
delete FROM mission WHERE codemission<>'';
delete FROM missionetape;
delete FROM missionpj;
 (XX)
- pj commandes : supprimees de cran_upload\commande\ et cran_upload\mission (laissees dans cran2013_upload) (XX)


LOCAL : modif. reps.
- duplique rep htdocs\cran_php en htdocs\cran2013_php (XX)
- Renomme rep htdocs\cran_php en htdocs\cran_php_old_20140110 (XX)
- duplique rep htdocs\crantest_php en htdocs\crantest2013_php (XX)
- Renomme rep htdocs\crantest_php en htdocs\crantest_php_old_20140110 (XX)  
- Duplique htdocs\crantest2014_php\ en htdocs\cran_php\ et htdocs\crantest_php\: contient les modifs 2014 et centrecout_pers edit_individu, _const_fonc_detail.php (function detailindividu), listepresentpartifutur_emploi_college.php (XX)
- renomme rep htdocs_upload\cran_upload en htdocs_upload\cran2013_upload (XX)

- cree htdocs_upload\cran_upload : dezip de cran_serveur_upload_AAAAMMJJ.zip dans htdocs_upload\cran_upload et htdocs_upload\cran2013_upload (XX)
- nouveau site dreamweaver cran2013_php (XX)

compare cran_php exploit (avec bd avant modifs) et cran_php local (avec nouvelle bd maj) :
dernier individu : OK (00594 validé par mail) (XX)
dernier sujet : OK (00791 validé par mail) (XX)

TESTS LOCAL :
export de cran local dans C:\Users\pgend\Documents\sauvebd_janvier_2014\locales\cran_apres_recup_exploit_et_modifs.sql (XX)
export de crantest exploit dans C:\Users\pgend\Documents\sauvebd_janvier_2014\locales\crantest_serveur_avant_copie_cran_pc_local_20140112.sql (XX)
copie de cran local dans crantest local (XX)
crantest local : 
- config cran.php et const.php (XX)
- modif. _const_fonc ($erreur=$message;) et gestioncommandes /*if($erreur_envoimail!="") (XX)
- update individu set email='pascal.gend@cran.univ-lorraine.fr' where codeindividu<>'' (XX)
- test doctorant : modif centrecout_pers correcte OK (XX)
- test commande (y compris salaire) : OK (XX)
- test individu : OK (XX)

Préparation exploit. : copie de bd cran (cran_apres_recup_exploit_et_modifs.sql sur serveur e:\) sur cran serveur en EXPLOIT (XX)

TESTS site crantest serveur
- copie crantest_php en crantest_php_old (XX)
- efface contenu de crantest_php serveur et copie contenu de cran2014_php serveur (XX)
- recup local cran_php\menuppal.php dans serveur crantest_php (liens vers contrats, ...) (XX)
- configure crantest_php\cran.php et const.php (XX)
- supprime et recrée crantest sur serveur import dans bd crantest serveur avec copie de bd cran local (cran_apres_recup_exploit_et_modifs.sql sur serveur e:\) :
  mysql -u root -pxxxxxxx e:\cran_apres_recup_exploit_et_modifs.sql (XX)
- tests : OK (XX)

Local : modif. progs.(vérifier que les dernieres modifs de crantest_php local ont été reportées sur serveur cran_php et celles de crantest2014_php sur serveur cran2014_php)
- crantest_php, cran_php : const.php,cran.php, menuppal.php : lien vers gestion commandes 2013  (XX)
  

serveur en EXPLOIT :
- copie cran_php en cran_php_old (XX)
- efface contenu de cran_php serveur et copie contenu de cran2014_php serveur (XX)
- configure cran_php\cran.php et const.php (XX)
- recup local cran_php\menuppal.php dans serveur crantest_php (liens vers contrats, ...) et ajout lien cran2013_php\formintranetpasswd.php
- supprime et recrée cran sur serveur import dans bd cran serveur avec copie de bd cran local (cran_apres_recup_exploit_et_modifs.sql sur serveur e:\) :
  mysql -u root -pxxxxxxx e:\cran_apres_recup_exploit_et_modifs.sql (XX)
- vérif. de visu. OK (XX)
- Vérif. pj => consultation OK (XX)
- pj commandes : supprimees de cran_upload\commande\ et cran_upload\mission (laissees dans cran2013_upload)

Local et serveur :
- cran2013_php : cran.php const.php,menuppal.php pour ne pas accéder à individus, sujets, contrats.
 => recup du dernier export d'exploit de bd cran dans cran2013 =  mysql -u root -proot cran2013<C:\Users\pgend\Documents\sauvebdcran-vm-web-cran\sauvebdcran20140112_08h_avant_passage_v2014.sql (XX)
Test sur cran2013_php et cran2013_upload : OK

Modif. www\cran2013_php\cran.php pour acces bd, rep upload cran2013_upload 
Sauvegardes bdcran2013 à mettre en place
Les sauvegardes de bd cran sont celles en cours deja programmees
Local : prog et bd les plus recents pour les actus = crantest_php_old_ et C:\Users\pgend\Documents\sauvebd_janvier_2014\locales\crantest.sql
Supprimer les bases et rep 2014
 ------------------------

en EXPLOIT le 06/12/2013 (et dans crantest2014)
- édite pers. : touche entrée implique suppr. PJ . Champ submit invisible
---------------------------
en EXPLOIT le 05/12/2013 (et dans crantest2014)
Pbl touche entree dans commande = clic sur "supprimer pj"
---------------------------
en EXPLOIT le 25/11/2013
la zone de saisie acronyme ne réaffiche pas ce qui est entre guillemets (FEDER "Prendre votre coeur en main") 
alors que l'on voit correctement ce qui a été saisi : FAIT
-----------------------
en EXPLOIT le 23/11/2013
sauve avant suppr individu 00537 : sauvebdcran20131123_10h_avant_suppr_individu_00537.sql
-----------------------
En EXPLOIT. le 14/11/2013
Erreur suppression mission : supprime commande de même n°
-->petit bug corrigé dans gestioncommandes
-----------------------
En EXPLOIT. le 24/10/2013
section cnu ou section cnrs possibles (ou exclusif)
En EXPLOIT. le 22/10/2013
dupliquer_commande.php : montant engagé 'réel'=''
------------------------
EN EXPLOIT le 17/10/2013
ordre alpha. par chercheur sera le bienvenu : est-ce que je laisse RSA--LDDir en premier dans la liste, et les ACI tout en bas ?
Christelle : un bouton duplication en face d'une ligne de liquidation pour que n° facture et date puisse être dupliqués par un simple clic
Après enregistrement d'une liquidation bouton dupliquer sur la nouvelle liquidation : identique à la ligne précédente
edit_commande.php
alerts.js : controle_form_commande rajout de (la valeur 0 convient)
----------------------
EN EXPLOIT : mysql-5.5.34-winx64.msi
sauve toutes les bases : mysqldumpall05102013.sql
--------------------------
EN EXPLOIT. le 25/09/2013
ISC spécialité S&TIC (Systèmes & Technologies de l'Information et de la Communication)
ISC spécialité MPC (Mesure, Certification, Performance)
ISC spécialité ISP (Ingénierie Système par la Pratique)
--------------------------
EN EXPLOIT. le 19/09/2013
gestioncommandes : petit bug d'affichage d'une colonne supplémentaire si pas sif
--------------------------
EN EXPLOIT. le 16/09/2013 
sauve bd cran sauvebdcran20130916_18h.sql sur pc local
BUG : titre_fr de sujet et titre_fr d'individu dans edit_fiche_dossier_pers
table individu : titre_fr->titrepers_fr, titre_en->titrepers_en
Modif edit_fiche_dossier_pers, fiche_dossier_pers_partiel, listeindividupublic, detailsujetpublic
--------------------------
EXPLOIT 15/09/2013
individus : prévenir srh, afmingestfin si fin de séjour
batch_de_nuit.php 
--------------------------
Modifs : EXPLOIT 10/09/2013
- listestagiairesenquete_ul : annee de datefin_sejour=annee en cours, listestagiaires=petit bug dans le prog., listehdr=bug 2 fois le même Dept., listedoct=bug missioncomp
Modif. suivantes pour éliminer le bug de la version mini. : EXPLOIT 10092013
- $mini=false;//$_SESSION['b_cmd_version_mini'];
- suppression de la case mini à l'affichage.
--------------------------
EN EXPLOIT 8/9 : correction petit bug gestioncommandes. Affichage d'autant d'images d'espace dans une ligne avant les commandes. OK
--------------------------
EN EXPLOIT : 7/9/2013
sauvebdcran20130907_12h.sql, gestioncommandes20130907.php, _const_fonc20130907.php

TEST
Avoir : copie de gestioncommandes en gestioncommandes02092013

table commande : ajout champ estavoir vc(3)
images j, k,j1,k1
- gestioncommandes
- _const_fonc : mail_validation_commande_avoir

- ajout d'une icone 'Avoir' - OK
- les secr. d'appui peuvent cocher cette case à partir du moment où le 1er visa IEB a été apposé et jusqu'à ce que le visa MIGO  ait été apposé 
(et si possible même s'il est apposé ou trouvé un moyen pour que je sois prévenu en cas d'avoir après MIGO). 
Si 'Avoir' est cochée, la ligne de la commande concernée passe dans une couleur bien visible à l'écran et un message est envoyé à l'IEB 
Sur visa MIGO, le message à l'IEB précisera qu'il s'agit d'un avoir. OK
- une commande constituant un avoir ne peut se trouver que dans les blocs 'service fait' ou 'Payé' (à moins qu'elle ne soit liée à une mission dont une autre commande est en engagé par ex.) OUI
- l'IEB pourra décocher l'avoir quand il le souhaite : la ligne de commande reprendra une couleur 'normale' OK
- l'avoir porte sur l'ensemble de la commande et pas seulement sur un élément de la commande - Il porte sur le montant total de la commande mais ne peut concerner qu'un article de la commande
- faudra-t-il intégrer cette notion d'avoir dans les cumuls des dépenses sous une forme particulière ? Ex. : dépenses : 10000 (dont avoir : 1000) ? Je ne pense pas


gestioncommandes --> gestioncommandes20130906OK_avant_case_a_cocher_avoir OK pour mise en exploitation.

Ajout d'une case permettant de ne lister que les avoirs : 
Je pourrais peut-être rajouter une case à cocher 'Avoir' dans le bloc de sélection comportant 'demande', 'engagé', 'service fait', 'payé' ou annulé pour afficher les lignes d'avoir ? Cela pourrait être bien en effet...
------------------------
EN EXPLOIT : 5/9/2013
Donner droits à 'du' sur l'accès aux pj des individus.
----------------------- le 28/08/2013 Probleme validation sujet 740 : message pas parti.
Probleme validation sujet 740 : message pas parti.
=> _const_fonc mail_validation_sujet message : 
$erreur=envoimail($headers, $message); etait en commentaire

----------------------- le 19/08/2013
Correction pour cde 1411 visa IEB1 : crédits UL, Source : Dotation CNRS !! au lieu de RSA--LDDIR. Contrôle sur typecrédit=01 ou 02 et pas centrefinancier
----------------------- AUTORISATION D’ABSENCE en France ou à l’étranger
exploit : FAIT le 27/04/2013 
sauvebdcran20130427_10h_avant_autorisation_absence.sql
progs cran_php20130427_10h
upload cran_upload20130427_10h 

sauve table mission : mission20130427_10h 
avecautorisationcongres vc(10), composanteenseignement vc(100), gradecongres vc(100), emploicongres vc(100), intitulecongres vc(200)
datedeb_congres vc(10), datefin_congres vc(10), villecongres vc(50),payscongres vc(50), organisateurcongres vc(100),
datedepartcongres vc(10), heuredepartcongres vc(2),datearriveecongres vc(10), heurearriveecongres vc(2),hotelcongres vc(100),
centrecoutcongres vc(100), eotpcongres vc(100), destinationcongres vc(100),rubriquecongres vc(10)
sanspriseenchargecongres vc(3), avecpriseenchargetotalecongres vc(3), avecpriseenchargepartiellecongres vc(3),
avectraincongres vc(3), avecavioncongres vc(3), avecvehiculeperscongres vc(3), avechebergementcongres vc(3),
avecrepascongres vc(3), avecautrecongres vc(3), avecpriseenchargeautre_ulcongres vc(3), organismepriseenchargeautrecongres vc(100)
table individu : composanteenseignement vc(100)
pas de lien entre cde et congres : moins difficile techniquement.
edit_mission (edit_mission20130427_10h)+ detailmission_autorisation_congres + alerts.js (alerts20130427_10h.js) et _const_fonc (_const_fonc20130427_10h.php) (controle formulaire) : FAIT
+ modif. edit_commande (edit_commande20130427_10h) pour recup objet=intitule de congres : FAIT
=> Necessite un copier/coller dans le congres a la main ou fait par IEB
Vérifier que longueur objet commande <= 200 en mettant intitulé de congrès
***************
Autre possibilité : Liaison de la commande de congres : (non mis en oeuvre = trop lourd en modifs de programmes)
edit_mission, edit_commande, gestioncommande pour suppression commande de congres, centrecout + eotp dans mission, alerts.js, _const_fonc.php (controle form mission)
ajout table mission : codecommandecongres vc(5)
Cas :
- (Annulé : renomme edit_commande en edit_commande20130424_avec_cde_de_congres) creation cde pour congres (edit_commande) => initialise codecommandecongres, CC et EOTP de la mission
- (Annulé : renomme edit_commande en gestioncommande20130424_avec_cde_de_congres) suppression cde pour congres (gestioncommande) => met à '' codecommandecongres, CC et EOTP
- (pas fait) annulation cde pour congres (gestioncommande) => met à '' codecommandecongres, CC et EOTP (si cde retablie elle ne sera plus cde de congres : il faudrait un menu de plus)
si mission avec cde pour congres => autotisation abscence obligatoire
- (Annulé : renomme dupliquer_mission en dupliquer_mission20130424_avec_cde_de_congres) duplication om : reste a mettre cc et eotp de la cde dupliquee dans table mission, mettre champ composanteenseignement...
- duplication cde : si liee a mission et que cde de congres alors mettre cde de congres dans la mission liee
La dde d'autorisation d'abscence est imprimable avec CC et EOTP fixé par n'importe qui ou alors l'autorisation n'est imprimable que si visa ieb
Attention : duplication OM, annulation commande, comment lier une commande deja creee au congres

-----------------------
cran r enlever rsa--lddir (48) en centre de cout et mettre dotation - rsa--lddir : 38 cdes attachees FAIT le 16/04/2013
-----------------------
sauve sauvebdcran20130414_18h_avant_suppr_cc_cran_dir_cid_iset_sbs.sql FAIT le 14/04/2013
Cran dir (cf=01) enlever :
cc cid=35 cde 626 cran dir cid passee en cran r cid
iset=36 
sbs=37
copie de centrecout en centrecout20130414
laisser direction, mettre source dotation - rsa--lddir
------------------------ bug d'un jour sur fonction periodepassee, periodeencours et periodefuture FAIT le 14/04/2013
=> modif _const_fonc.php
------------------------ intersectionperiodes contrat et date commande FAIT le 14/04/2013
edit_commande (sauve en edit_commande20130414)
------------------------ enlever icone duplication pour demandeur si n'a pas de role secrcite, ieb ou du
gestioncommandes : referent, resptheme, respcontrat ne peuvent dupliquer estrole('sif',$tab_roleuser) || estrole('du',$tab_roleuser) || estrole('secrsite',$tab_roleuser)
-------------------- Annuler commande  : annulation IEB seulement. FAIT le 13/04/2013
Exploit. :
- sauvebdcran20130413_18h_avant_annulation_cmd.sql FAIT le 13/04/2013
- copie de commande en commande20130413_18h_avant_annulation_cmd FAIT le 13/04/2013
- gestioncommandes20130413_18h_avant_annulation_cmd.php FAIT le 13/04/2013
commande champ estannule vc(3) FAIT le 13/04/2013

gestioncommandes : bloc supplémentaire "commandes annulées" FAIT le 13/04/2013
Calcul des cumuls : ne compte pas les commandes annulées
--------------------- suppr. email a creer FAIT le 13/04/2013
modif. edit_fiche_dossier_pers.php , edit_fiche_dossier_pers_partiel.php, _const_fonc.php
--------------------- ED, EC Associe, liste hdr FAIT le 13/04/2013
individu : rajout champ codeed vc(2) FAIT le 13/04/2013
recup de l'info de individued : update individu,individued set individu.codeed=individued.codeed where individu.codeindividu=individued.codeindividu
modif edit_fiche_dossier_pers.php FAIT le 13/04/2013
individu ajout champ associe vc(3), le 13/04/2013
recup de l'info de individuassocie : update individu set associe='oui' where codeindividu in (select codeindividu from individuassocie) le 13/04/2013
modif. edit_fiche_dossier_pers.php  le 13/04/2013
modif. listeperscran,listepresentpartifutur_emploi_college,listehdr, detailindividupublic, _const_fonc_detail le 13/04/2013
listes_individus
_const_fonc_detail.php detailindividu : referent que si doct, postdoc ou exterieur FAIT
--------------------- Lieu
lieu : changement cav->icl, lien http FAIT
---------------------
bug : suppression commande : suppression commandejustifiecontrat FAIT le 07/04/2013
-----------------------
Cumul virtuel par contrat au dessus du bloc 'Demande' FAIT le 07/04/2013
---------------------- cadre 3 : liste des contrats qui peuvent être justifiés par la commande
EXPLOIT : FAIT le 04/04/2013 
- sauvebdcran20130404_20h_avant_justif_contrat.sql
- edit_commande, gestioncontrats conservés avec suffixe 20130404
commandejustifiecontrat codecommande vc(5), codecontrat vc(5), numordre vc(2)
edit_commande, gestioncontrats
mettre un indicateur dans contrat : ajustifier ?
si deux contrats dans un eotp : lequel ?
liste des commandes : colonne pour CC avec liste des contrats justifiés grâce à cette commande
----------------------- verif que tous champs migo facture sont vides si vide numigo ou numfacture
alerts.js FAIT le 04042013
-----------------------
touche ENTREE contrat : message voulez-vous supprimer ...? FAIT le 29/03/2013
=> modif edit_contrat
--------------------- contrats modif orggest UL ou CNRS que si pas d'eotp FAIT le 29/03/2013
=> modif edit_contrat  
---------------------- contrat : choix calculdate_automatique FAIT le 29/03/2013
envoi serveur => actualisation des colonnes détail 
contrat champ calculdate_automatique vc(3)
update contrat set montantpaye_automatique='oui' where codecontrat<>''
edit_contrat
images b_calculdate_automatique_oui/non.png
---------------------- FAIT le 29/03/2013
edit_contrateotp : ne lister que les eotp UL pour un contrat UL, idem CNRS FAIT
---------------------
---------------------BUG js : problème calcul dates/durée contrat 00366 FAIT le 28/03/2013
=> modif edit_contrat
---------------------Listes par eotp OU contrat pour recherche (pour IEB)
=> modif gestioncommandes.php FAIT le 27/03/2013
---------------------
mettre nom prenom du missionnaire FAIT le 25/03/2013
=> gestioncommandes
---------------------
visa dept/contrat = title="Resp" pour ne pas avoir le confusion dept et contrat d'un autre FAIT le 25/03/2013
=> table cmd_statutvisa modif texte_cmd_statutvisa_title
---------------------
recalage sur la dernière ligne dupliquée  FAIT le 25/03/2013
=> dupliquer_commande, dupliquer_mission 
-----------------------
Il manque encore le calcul automatique du montant payé directement durant la saisie : encore un truc à faire NON (CC)
---------------- formulaire commande : modifs du 24/03/2013
Visa MIGO au lieu de secrétariat de site FAIT le 24/03/2013
engage reel force a 1 : permettre 0 FAIT le 24/03/2013
=> edit_commande, _const_fonc (controle_form_commande), alerts.js
renseigner date_creation codemodifieur date_modif FAIT le 24/03/2013
=> modif edit_commande
modifier le demandeur pour une commande de mission IEB FAIT le 24/03/2013
=> modif edit_commande
correction bug saisie commande montantengage 0 : blocage saisie
=> modif edit_commande
Enlever date payé réel  le 24/03/2013
commande : renomme datepaye en datepaye_old, edit_commande, alerts.js FAIT  le 24/03/2013
correction bug désactivation montant payé automatique FAIT  le 24/03/2013
=> modif edit_commande
---------------------- 
Présenter commandes/missions triées par imputation sans bloc=$tab_etat_commande=array('tout') NON (CC)
----------------------
Afficher fact date migo ... dans gestioncommandes ? NON (CC)
----------------------
contrat : tri par GT, par resp. FAIT le 21/03/2013
---------------------
contrats : visu = piece jointe (CC) FAIT
----------------------
Individus : liste gt present parti futur : ajout email_parti FAIT le 20/03/2013
----------------------
Donner la possibilité sur recherche textuelle avec un seul résultat de permettre la visu par toute secrétaire : NON (CC)
----------------------
Tri sur imputation virtuelle pour tout le monde. FAIT le 17/03/2013
----------------------
Problème recherche : sur entrée, déselectionne 'commandes' corrigé FAIT le 14/03/2013 
----------------------
rechercher les cdes d'AP qui sont visées IEB mais qu'elle ne peut plus accéder codecreateur<>codesecrsite FAIT le 15/03/2013
----------------------
Mettre 'Admin' par défaut  FAIT le 14/03/2013
---------------------- Ajout icône annuler mission FAIT le 14/03/2013
mission : champ estannule varchar(3)
modif gestioncommandes
----------------------
recherche sur nom ou prénom et pas nom/prénom : chgt libellé FAIT le 14/03/2013
----------------------------
Recherche sur n° interne : gestioncommandes FAIT le 14/03/2013
---------------------------- systeme affichage modif de la veille et modif semaine
table cmd_suivi_developpement_info
modif gestioncommandes
----------------------------
ouverture fenetre impression dans detailmission (javascript:window.print()) FAIT le 11/03/2013
---------------------------- duplication commande : date du jour de duplication dans une zone modifiable FAIT le 11/03/2013
dupliquer_commande, _const_fonc_ (controle_form_dupliquer_commande), alerts.js
----------------------------

--------------- Commandes de missionnaire parti FAIT le 11/03/2013
Si parti et déselection du missionnaire : les commandes seront celles du missionnaire choisi ou par défaut la secr site
----------------------

----------------------- Missions : "secrétariat de site" obligatoire FAIT le 11/03/2013
modif _const_fonc.php et alerts.js
-----------------------
----------------------
missionnaire changé => changer demandeur de commande FAIT le 11/03/2013
----------------------
BUG : codecreateur et codemodifieur ecrases par '' et affichage de createur et modifieur = user codeuser ! FAIT
----------------------
Commande de mission créée : par défaut le codeuser, mais laisser liste déroulante (AP, CLK) FAIT
imposer secretaire pour OM sinon elle risque de ne plus voir la mission (idem pour commande) FAIT
--------------- plus de verrouillage de type agent FAIT EN EXPLOIT
                + prise en compte d'un individu plus là ou sans emploi à la date du depart de la mission
Pbl postdoc : ater=>ec, autre=ita ?
table corps : postdoc  => codecatemissionnaire='01' EC (par defaut) FAIT EN EXPLOIT
modefinancement<>ater => '02' BIATOSS OK
edit_mission, detailmission
alerts.js : controle codecatmissionnaire !='' OK
missionnaire parti :
- précisé avec un panneau attention dans la liste.
- verif de ses infos a la date de la mission OK
- tester le cas erreur pour voir si les infos sont toujours la : une seule ligne depart-arrivee par ex.
Pbl mission a venir d'un agent considere comme parti a cette date OK
=> Notice: Undefined index: 00189 in C:\Users\pgend\Documents\htdocs\crantest_php\edit_mission.php on line 829
DEMANDE D'ORDRE DE MISSION valant autorisation d’absence 
= N'est plus dans liste des presents
copie bd cran serveur : sauvebdcran20130310_22h_avant_deverrouille_type_agent.sql
copie edit_mission, detailmission avec suffixe 20130310
---------------
--------- contrats inpl codeorggest='010' (inpl) non listés FAIT
vue budg_contrat_source_vue prête dans table vues : l'executer en SQL.
modif gestioncontrats, gestioncontrateotp, gestioncommandes, edit_commande, editcontrateotp
EXPLOIT :
sauve bd cran serveur : sauvebdcran20130310_10h_avant_contrats_inpl.sql
copie gestioncontrats, gestioncontrateotp, gestioncommandes, edit_commande, editcontrateotp avec suffixe 20130310_10h_avant_contrats_inpl
copie vue budg_contrat_source_vue avec suffixe 20130310_10h_avant_contrats_inpl
Mise en place
- budg_contrat_source_vue 
- gestioncontrats, gestioncontrateotp, gestioncommandes, edit_commande, editcontrateotp
--------
---------------------- Ajout title="Visa demandeur, secr, IEB" pour chaque icone de visa FAIT
cmd_statut_visa : colonne texte_cmd_statutvisa_title
gestioncommandes, _const_fonc get_cmd_statutvisa_texte_visa_title()
-----------
table contrat : mettre estvalide='oui' FAIT
----------- contrats msg IEB sur création FAIT
contrat : ajout champ estvalide vc(3)
gestioncontrats, _const_fonc (popup_validation_contrat, mail_validation_contrat)
-------------------------
Pbl de ce que voit une secr site si mission est d'elle mais pas une commande ? NON
----------------- visa dept => annulation visas possible FAIT
visa dept => annulation visas possible
_const_fonc, _const_fonc_detail, detailcommande, confirmer_action_commande
-------------
Contrats : double-clic FAIT
recalage sortie edit_contrat sur ligne créée FAIT
------------- champs carteabonne,... à rappeler FAIT
individu : ajout champs
numcarteabonneairfrance, dateabonneairfranceexpire, numcartefideliteavion,
compagniecartefideliteavion, codepuissfiscale, numimmatriculation
edit_mission
MISE EN EXPLOIT :
bd cran serveur sauvegarde sauvebdcran20130306_14h.sql
individu : ajout champs
--------------
Ajouter un message js le temps de chargement de la page FAIT
annulation visas pour IEB => rend suppression possible FAIT
Possibilité de ne pas afficher certaines colonnes dans gestioncommandes FAIT
Message assurance : si ville-pays = déplacement effectué, ne mettre qu'un des deux dans le mail LAISSER COMME CELA
Interdire suppression de contrats qui font l'objet d'une imputation FAIT
MISE EN EXPLOITATION FAIT
-------------------------
Enlever payé virtuel.
Ajout par MIGO par liquidation de : num facture + date facture
commande : ajout champ montantpaye_automatique varchar(3), 
Total de toutes les liquidations dans payé réel automatique : Icone cadena ouvert. Saisie CLK ou CCT retenue si cadena fermé
commandemigo : ajout champ datemigo varchar(10)
commandemigoliquidation : ajout champs numfacture (20) datefacture(10)
suppression de migo : nummigo=''
suppression fact/liquidation numfacture=''
mettre une etoile rouge apres nummigo et numfacture ou icone de suppression
idem pour imputation
calcul auto effectif si montantpaye != cumul des liquidations (historique des migo non saisies)
edit_commande, alerts.js, _const_fonc
montant payé total=mettre le verrou pour que le cumul ne se fasse pas
vérifier que montant engagé virtuel est toujours egal a reel ou cumul reels :
- a la suppression d'une reelle la virtuelle est encore egale au cumul des reelles avant suppression
verifier que reel et virtuel=cumulmontantliquidation quand on passe en calcul auto
- au passage calcul auto, si reel != cumulmontantliquidation, le reel affiche = cumulmontantliquidation mais bd contient reel precedentMessage js le temps du chargement d'une page FAIT
--------------- 
sauve bd cran serveur : sauvebdcran20130304_00h_avant_migo_numfacture_date.sql
recup de bd cran serveur dans bd cran locale
renomme :
alerts.js : alerts20130304.js
_const_fonc.phb en _const_fonc20130304.phb
edit_commande.php en edit_commande20130304.php
commande : ajout champ montantpaye_automatique varchar(3)
commandemigo : ajout champ datemigo varchar(10)
commandemigoliquidation : ajout champs numfacture (20) datefacture(10)
-------------------------
Suite à création de commande ou mission se positionner dans la liste : gestioncommandes, edit_commande, edit_mission FAIT
commandes finies : proposer case recherche n° commande ou OM (le n° reel et pas interne) (CLK) FAIT
Mettre tableau des migo-liquidations à 100% pour cadrage FAIT
Blocs. FAIT
demande 
engagé : 1er visa ieb apposé et n° cmde saisi engagé
MIGO oblig. = case service fait obligatoire pour apposer visa secr.
service fait : visa secr. et MIGO
payé : 2eme ieb visa
classement 4 blocs (une commande part dans un autre bloc si toute la mission avec ses commandes y passe)
Recherche texte dans blocs affichés ou non
bd  cran serveur : FAIT
- duplique commande en commande20130227 avant renommage nummigo et numliquidation FAIT
- renomme nummigo en nummigi_old et numliquidation en numliquidation_old FAIT
sauve bd cran serveur en sauvebdcran20130227_14h_avant_nummigo_old.sql FAIT
gestioncommandes.php copié en gestioncommandes20130227_avant_suppr_migo_liquidation.php FAIT
RSA--LDDIR - Dotation pour CRAN R  modif edit_commande, _const_foncFAIT
Corrigé en test dans gestioncommandes : FAIT
pbl AP: cde 207 dupliquée en 285 = non visible CORRIGE
Carole : mission 138, crée commande 282 (et 283, 284)= non visible si case Mission cochée. Visible si on ne voit pas les missions. CORRIGE
Remet sur serveur et local cran gestioncommandes20130224.php et renomme champs nummigo_old et numliquidation_old en nummigo et numliquidation FAIT
demande, engage, servicefait, payé : cases à cocher au lieu d'images = la recherche textuelle peut se faire sur tous les blocs sans avoir à cliquer sur tous les blocs FAIT
copie de bd cran serveur commande en commande20130224 renomme champs nummigo_old et numliquidation_old FAIT
Sur double clic : modif commande FAIT
tri par imputation : copie de gestioncommandes en gestioncommandes_20130222 avant mise en exploit FAIT
creation vues budg_contrat_source_vue et budg_eotp_source_vue FAIT
correction ordre sql de selection des contrats (2000 lignes au lieu de 40) FAIT
Mettre RSA -- LDDIR dans gestioncommandes au lieu de dotation FAIT
BUG : certains demndeurs apparaissent en rouge dans edit_commande après enregistrement ! FAIT
dates liquidations sous la forme j m aa : edit_commande, _const_fonc, alerts.js 19/02/2013 22h FAIT
dates eotp différente de dates contrat => modifiable par CC et CLK PAS FAIT
virtuel : au lieu de dotation pour cran recherche, mettre rsa -- lddir FAIT
Possibilité de modif virtuel tout le temps pour IEB FAIT (copie de sauvebdcran20130218_22h.sql sur pc local avant utilisation)
contrats : ligne verte de sélection. FAIT
Manque des contrats CNRS !!! Mme CAMBRESY !!! FAIT
revenir sur la ligne selectionnee à garder verte apres passage par edit_commande ou edit_mission FAIT
Modifs 20130217 => renomme edit_commande, edit_mission, gestioncommandes, dupliquer_commande, dupliquer_mission, _const_fonc_avant_compile
 en suffixant par 20130217 dans rep local et serveur.
sauvegarde de bdcran exploit en sauvebdcran20130217_22h.sql
 Puis copie de crantest_php des fichiers dans cran_php FAIT
duplication mission : ajout case fournisseur pour chaque commande FAIT
contrat expiré => plus visible dans imputations FAIT
orggest non modifiable si imputation FAIT
commande de mission : missionnaire est demandeur de commande sauf si missionnaire non CRAN alors secr site à la place FAIT
cadrage montants à droite
si membre quitte unité : il n'est plus dans la liste des demandeurs commande sauf les siennes => panneau attention si déselection FAIT
si membre n'a pas d'emploi ou quitte unité : il n'est plus dans la liste des demandeurs mission sauf les siennes FAIT
--> il disparait des listes select de demandeurs/missionnaires FAIT
duplication cmde : tester version navigateur firefox pour liste select FAIT
virtuel : resp. + acronyme contrat FAIT
reel : resp + acronyme + eotp FAIT
pbl navigateur pour data list (versions de Firefox) : FAIT
le tri des colonnes : demandeur, fournisseur, date, num commande, num int commande (Anne) FAIT
colonne demandeur en début (Sabine) FAIT
Ajout case fournisseur dans duplication commande FAIT
duplication commande doit être possible quelquesoit le visa FAIT
Erreur de saisie de commande test sur cran exploit. : FAIT
récup de sauvebdcran20130210_02h_avant_saisie_par_erreur.sql
sur pc bd locale cran. Commande 00167 en plus sur serveur => suppression et remise à 00166 de commande dans seq_number
Mail pour mission étranger FAIT
Ajout ligne sélectionnée dans gestioncommandes FAIT
Duplication commande FAIT
des mails ne partent pas => pas de visa apposé FAIT
afficher credits ul+cnrs dans gestioncommandes : resp dept et commandes connaissent pas la différence FAIT
interdire desaffectation d'un eotp à un contrat si deja imputation FAIT
interdire suppression d'un individu si lié à une commande FAIT
visa dept => imputation virtuelle non modifiable ! FAIT 
gestioncontrateotp : interdire la dissiociation eotp/contrat si il existe une imputation budget FAIT
erreur cc contrat siatbraun : FAIT
update `commandeimputationbudget` set codecentrecout='23' WHERE codecontrat='00265' or codeeotp='00016'
desassocie et associe eotp 00016 du contrat 00265 
modif eotp cc=23 pour eotp=00016
Déplacements Longwy à représenter par : FAIT
--> centre de coût : CID
--> source/contrat : Missions Longwy
--> resp. M. Zasadzinsky
cadre3 : typecredit en + FAIT
Duplication mission+commandes pour plusieurs missionnaires FAIT
plusieurs nummigo et numliquidation : tables commandemigo et commandemigoliquidation FAIT
Modif commandes : toutes les natures (et pas seulement mission pour les commandes de mission) FAIT
Adresse administrative apparait pas sur l'OM à l'impression pour un membre CRAN FAIT
Lenteur de l'affichage FAIT
Rajout "Dotation" à l'affichage FAIT
CC CNRS FAIT
tant que pas visa ieb, pas le réel dans liste FAIT
icone sans frais pour missions FAIT
bloquer champs des contrats selectionnes dans contrat FAIT
listes deroulantes cadre 1 : 1ère case vide FAIT
suppression cde-mission FAIT